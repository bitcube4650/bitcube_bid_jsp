var UnisignWebEngine=function(x,pa){function Na(){if(!(q.Mode&4))return null;eval(H({eval:!1,intergrity:!1,name:"nimservice",url:"unisignweb/js/nimservice.js"}));return eval("__nimservice")(a)}function Oa(){if(!(q.Mode&2))return null;eval(H({eval:!1,intergrity:!1,name:"sharestorage",url:"unisignweb/js/sharestorage.js"}));return eval("__crosscertlocalstorage")(a)}function H(a){var c=null,c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",q.SRCPath+a.url+"?version="+Z,!1);c.send(null);if(200==c.status){if(!0===a.intergrity){var b={};b.name=a.name+".js";b.data=c.responseText;O[Ba++]=b}return null==a.eval||!0==a.eval?eval(c.responseText):c.responseText}I=!1;return null}function Pa(){D&&V.log("Do retry to initialize module.");VerifyPFLicense()&&(__ForgeryUtil=new E.FORGERY)}function Qa(d){var c;if(!d||0>=d.length)return null;var b=d+".js";c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");a.uiUtil().isItPortableDevice()?"gridlist"!=d?(b="m_"+b,c.open("GET",q.SRCPath+"unisignweb/js/mobile/m_"+d+".js?version="+Z,!1)):c.open("GET",q.SRCPath+"unisignweb/js/"+d+".js?version="+Z,!1):c.open("GET",q.SRCPath+"unisignweb/js/"+d+".js?version="+Z,!1);c.send(null);var e=c.responseText,g=null;"certprocessing.js"!=b&&(g=a.forgeryUtil().verify(b,e),"success"!=g&&null!=g&&(a.uiUtil().flagAlert(g),I=!1));eval(c.responseText);return eval("__"+d)(a)}function k(d,c){var b={};b.resultCode=d?d:0;b.resultMessage=c?c:"";b.jsonSignedData="";b.certAttrs="";b.certIndex="";b.b64RValue="";b.hashValue="";b.encryptedData="";b.decryptedData="";b.signedData="";b.theCert="";b.theDN="";b.thePri="";b.kmCert="";b.kmPri="";b.pfx="";b.curDrive="";b.curDevice="";b.tokenLabel="";b.password="";b.pin="";b.mac="";a.ERROR.Code=d;a.ERROR.Message=c;return b}function ea(d,c,b,e,g,f,h,l){if(d)Ca(0,d,c,b,e,g,f,h,l);else{var m=a.loadUI("ssn")({type:null,onConfirm:function(a){Ca(1,a,c,b,e,g,f,h,l);m.dispose()},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message));m.dispose();ClearAllUserCertList()}});m.show()}}function Ca(d,c,b,e,g,f,h,l,m){a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE);var n=k();n.certAttrs=f;n.curDevice=h;n.tokenLabel=l;if("undefined"!==typeof b&&"undefined"!==typeof e)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(h))a.nimservice()?a.nimservice().VerifyVID(b,e,d,c,function(d,b){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==d?(n.signedData=g,m(n)):(4305E4==d&&(d=14208),a.ERROR.Code=d,a.ERROR.Message=b,m(k(d,a.uiUtil().getErrorMessageLang().IDS_ERROR_VERIFY_ID)))}):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_NIM_ERROR_UNLOAD,a.uiUtil().createLoadingBox("hide","us-div-loading-dialog"),m(k(a.ERROR.Code,a.ERROR.Message)),ClearAllUserCertList());else{a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");try{var s=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[b].signcert),p=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[b].signpri),r=a.usWebToolkit.pkcs8.verifyVID(p,e,c,s);e=c="";r?(n.signedData=g,m(n)):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_ERROR_VERIFICATION,m(k(a.ERROR.Code,a.ERROR.Message)))}catch(t){e=c="",a.ERROR.Code=t.code,a.ERROR.Message=t.message,m(k(t.code,t.message))}e=c=""}}function Da(d){try{var c=a.PFSH.GetP12ForBuToPc(1,d,"binary"),b=c.p12,e=a.certUtil().getCN(c.dn),e=e+".p12";a.fileUtil().save(e,b)}catch(g){alert("failure\nerr code : "+g.code+"\nerr msg : "+g.message)}}function Ea(){var d=null,c=null,b=null;try{d=a.PFSH.GetP12ForBuToMo(1,"hex"),c=d.key,b=d.p12}catch(e){c=window.console||{log:function(){}};D&&(c.log("***** GetP12ForBuToMo error *****"),c.log("e.code : ",e.code,"e.message : ",e.message,"e.detail : ",e.detail));alert("failure\nerr code : "+e.code+"\nerr msg : "+e.message);return}try{d="default";"android"===a.osName?"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName?d="default":"android chrome"===a.browserName&&(d="chrome"):"ios"==a.osName&&("ios safari"===a.browserName?d="default":"ios chrome"===a.browserName&&(d="googlechrome"));var g=window.location.href.split(/[?#]/)[0],f=g.lastIndexOf("/"),g=g.substr(0,f+1)+a.ESVS.SRCPath+"unisignweb/rsrc/layout/mobile/w2a/m_exportcertresult.html";UniSignW2A.backupStore(g,d,b,c,"0","recall")}catch(h){alert("failure\ne : "+h)}}function Fa(d){try{a.CCPFSH().GetP12ForBuToPc(1,d,"base64",function(d,c,g,f){d=a.usWebToolkit.util.decode64(f);c=Array(d.length);for(f=0;f<d.length;f++)c[f]=d.charCodeAt(f);d=new Uint8Array(c);g=a.certUtil().getCN(g);g+=".p12";a.fileUtil().save(g,d)})}catch(c){alert("failure\nerr code : "+c.code+"\nerr msg : "+c.message)}}function Ga(){var d=null,c=null;a.CCPFSH().GetP12ForBuToMo(1,"base64",function(b,e,g,f){if(0==b){d=g;b=a.usWebToolkit.util.decode64(f);c=crosscert.util.bytesToHex(b);try{b="default";"android"===a.osName?"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName?b="default":"android chrome"===a.browserName&&(b="chrome"):"ios"==a.osName&&("ios safari"===a.browserName?b="default":"ios chrome"===a.browserName&&(b="googlechrome"));var h=window.location.href.split(/[?#]/)[0],l=h.lastIndexOf("/"),h=h.substr(0,l+1)+a.ESVS.SRCPath+"unisignweb/rsrc/layout/mobile/w2a/m_exportcertresult.html";UniSignW2A.backupStore(h,b,c,d,"0","recall")}catch(m){alert("failure\ne : "+m)}}else h=window.console||{log:function(){}},D&&(h.log("***** GetP12ForBuToMo error *****"),h.log("rv : ",b,"msg : ",e)),alert("failure\nerr code : "+b+"\nerr msg : "+e)})}function B(d,c,b,e,g){a.SELECTINFO={index:d,pw:c,curdevice:b,cert:e,certattrs:g}}function qa(d,c,b,e,g,f,h,l,m,n){var s={},p=k();if("undefined"!==typeof e&&"undefined"!==typeof g)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(f))if(a.nimservice()){var r=0,t=[];if(d)for(var u in d)t[r]=d[u],r++;m=!0==m?1:0;a.nimservice().GetSignDataP7WithHash(e,g,c,t,"utf8",!1,h,!1,m,function(c,h,r,m,t,u){if(0!=c)a.ERROR.Code=c,a.ERROR.Message=h,a.uiUtil().errMsgBox(h,a.ERROR.Code),n(k(a.ERROR.Code,a.ERROR.Message));else{c=0;if("object"==typeof r)for(var $ in d)s[$]=r[c++];else s=r;r=null;r=a.CONST.__USFB_M_MOBILETOKEN.device==f?a.certUtil().getTheCertAttributes(t,"Base64"):a.certUtil().getTheCertAttributes(b,"Base64");p.jsonSignedData=s;p.b64RValue=m;p.tokenLabel=u;p.certAttrs=r;n(p)}e=g=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l&&l.dispose()},10)})}else n(null),setTimeout(function(){l&&l.dispose(!0)},10);else setTimeout(function(){l&&l.dispose(!0)},10);else n(null),setTimeout(function(){l&&l.dispose(!0)},10)}function S(){4&a.ESVS.Mode&&a.nimservice()&&a.nimservice().ClearAllUserCertList(function(a,c){})}function ga(){2>=R||a.nimservice().checkInstall(function(d){q.chkEXESetup=d;a.ESVS.chkEXESetup=d})}if(x&&pa){var R=x.Mode,z=x.EncAlgo,P=x.HashAlgo,Q=x.UniCRS,W=x.SecureKeyboardType,A=x.PKI,ra=x.SRCPath,aa=x.Language,U=x.TargetObj,ca=x.TabIndex,da=x.Embedded,ba=x.LimitNumOfTimesToTryToInputPW,sa=x.CMPIP,ha=x.CMPPort,ta=x.CMPURL,ua=x.SHARESTORAGE,X=x.NimCheckURL,F=x.Media,va=x.Organization,ia=x.Policy,ja=x.ShowExpiredCerts,M=x.LimitMinNewPWLen,N=x.LimitMaxNewPWLen,Y=x.LimitNewPWPattern,wa=x.ChangePWByNPKINewPattern,ka=x.CertRequestPageEnable,xa=x.SDInstallURL,ya=x.IssueCertInBIOToken,Ra=x.License,la=!1,Ha=!1,ma=1E4,D=!1,G=function(a){!1!=D&&window.console&&window.console.log&&window.console.log(a)};x.ShowGuide&&(Ha=!0);1E4<x.zIndex&&(ma=x.zIndex);var I=null,Z="1.0.1.1",za=null,q={};q.zIndex=ma;q.CertforKeyboard="MIIDZzCCAk+gAwIBAgIBATANBgkqhkiG9w0BAQsFADBKMQswCQYDVQQGEwJLUjESMBAGA1UEChMJQ3Jvc3NDZXJ0MQ4wDAYDVQQLEwVTVExhYjEXMBUGA1UEAxMOQ3Jvc3NDZXJ0V2ViVjMwHhcNMTQwNjI1MDAwMDAwWhcNMjkxMjMxMjM1OTAwWjBKMQswCQYDVQQGEwJLUjESMBAGA1UEChMJQ3Jvc3NDZXJ0MQ4wDAYDVQQLEwVTVExhYjEXMBUGA1UEAxMOQ3Jvc3NDZXJ0V2ViVjMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDIm9p0HiCrpFVSfRVdnC3V4kEC75F8bUWV/Ewa7TmuirbVOYsdtSpz+Yceh+Tindducrf6zGNlhhNpyhFQ6+4/f0qLdwALapojECOUQg/lISRD2FO88hEhBj/rOjZiVzHYyHm8K2bTtBJXNauBBCb1yUKNdHuAvw4xub/jcgZ2PRtWORrQwuStcGBSSnqCIHZcGb5KKdHtY15ppcZoZBXB75kKKdK8qJm/6A/bBW0S+o3ooN+oaGrFFEVH61AHi45sBHGO4e1oyRT8dfIgKUzUQOKSZ1r3Wln4CSqQR8tZOd/T+LzzSB7r4N/rzNo3T4oO5O6lkQBw3NZg25nMXBj7AgMBAAGjWDBWMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFJ7NboZBgBMwRmav8MSGpsMab+NjMA4GA1UdDwEB/wQEAwIGwDAXBgNVHSAEEDAOMAwGCiqDGoyaRAUEAQEwDQYJKoZIhvcNAQELBQADggEBAIU2d1CH6vsZaTAeSCdBM1tKcl/8YpnUSqt3w6DB45E9akGCODgEI1K/KPtRIhrjBBYopQJN9Z3F411xiw2Te0LJQKA9snAtRZCEbL/1FzjyUXKEv5QB9Zgch4KvbqhOdVb1bJsztJH1kV/lbeNbil2TI1NntWbKyPWDKlzdPsGbSAgaFkUtbt7fxcGJBoXAEsaohtNiDM3chfJWv4d0dlDito5isOMIMDN+bfLcBp745T+wEpig6bfbVZnDjzGbXhJJjVvFKydQrZfrLBnVLCpElD1xN1Ipw+6UGJXEuxqXS51drnG9jVU1FL9JDtDE7BNByXV2V9y9b1/6PSeSYMw=";if(!R||"undefined"===typeof R||1>R||6<R)R=4;q.Mode=R;z&&"undefined"!==typeof z||(z="3des");q.EncAlgo=z;P&&"undefined"!==typeof P||(P="sha256");q.HashAlgo=P;ra||(ra="");q.SRCPath=ra;q.ShowGuide=Ha;W?"ahnlab"==W&&(eval(H({eval:!1,intergrity:!1,name:"astx2.min.js",url:"unisignweb/framework/keyboard/astx2.min.js"})),eval(H({eval:!1,intergrity:!1,name:"astx2_custom.js",url:"unisignweb/framework/keyboard/astx2_custom.js"}))):W="";q.SecureKeyboardType=W;A||(A="NPKI");q.PKI=A;aa=aa?"ko-kr"==aa.toLowerCase()?"ko_kr":"en_us":!navigator.browserLanguage||"ko"!=navigator.browserLanguage.toLowerCase()&&"kr"!=navigator.browserLanguage.toLowerCase()&&"ko-kr"!=navigator.browserLanguage.toLowerCase()?!document.documentElement.lang||"ko"!=document.documentElement.lang.toLowerCase()&&"kr"!=document.documentElement.lang.toLowerCase()&&"ko-kr"!=document.documentElement.lang.toLowerCase()?!navigator.language||"ko"!=navigator.language.toLowerCase()&&"kr"!=navigator.language.toLowerCase()&&"ko-kr"!=navigator.language.toLowerCase()?"en_us":"ko_kr":"ko_kr":"ko_kr";q.Language=aa;X||(X="../install/Obj_check.html");q._NimCheckURL=X;if(!1==da||!da){var Ia=function(){!U&&document.body&&(U=document.createElement("div"),U.style.width="0px",U.style.height="0px",document.body.insertBefore(U,document.body.firstChild));U?q.TargetObj=U:setTimeout(Ia,500)};setTimeout(Ia,300)}q.TargetObj=U;if(0>ca||!ca)ca=0;q.TabIndex=ca;da||(da=!1);q.Embedded=da;if(0>=ba||10<ba||!ba)ba=3;q.LimitNumOfTimesToTryToInputPW=ba;sa||(sa="211.192.169.70");q.CMPIP=sa;if(0>ha||!ha)ha=4502;q.CMPPort=ha;ta||(ta="http://ca.crosscert.com:9992/webcmp/");q.CMPURL=ta;ua||(ua="http://testca.crosscert.com/pftest/");q.SHARESTORAGE=ua;F?(F.list=F.list?F.list.toLowerCase():null,F.defaultdevice?(F.defaultdevice=F.defaultdevice.toLowerCase(),null!=F.list&&(F.defaultdevice=0>F.list.indexOf(F.defaultdevice)?F.list.split("|")[0]:F.defaultdevice)):F.defaultdevice=null):F={defaultdevice:null,list:"removable|sectoken|savetoken|mobilephone|harddisk|mobiletoken|securedisk|webstorage|cloudsign|sharestorage|touchsign|smartsign|websectoken|websofttoken"};if(void 0==F.defaultdevice||null==F.defaultdevice)F.defaultdevice=2==R?"webstorage":"harddisk";q.Media=F;va||(va=null);q.Organization=va;ia||(ia=null);q.Policy=ia;"boolean"!==typeof ja&&(ja=!0);q.ShowExpiredCerts=ja;if("NPKI"===q.PKI){if(10>M||64<M||!M)M=10;q.LimitMinNewPWLen=M;if(10>N||64<N||!N||M>N)N=64;q.LimitMaxNewPWLen=N;Y=2}else{if(8>M||64<M||!M)M=8;q.LimitMinNewPWLen=M;if(8>N||64<N||!N||M>N)N=64;q.LimitMaxNewPWLen=N;if(0>Y||2<Y||!Y)Y=0}q.LimitNewPWPattern=Y;wa||(wa=!1);q.ChangePWByNPKINewPattern=wa;"undefined"===typeof ka&&(ka=1);q.CertRequestPageEnable=ka;"undefined"===typeof xa&&(xa="");q.SDInstallURL=xa;"undefined"===typeof ya&&(ya=!1);q.IssueCertInBIOToken=ya;q.License=Ra;la&&"undefined"!==typeof la||(la=!1);q.multiuse=la;if(0>Q||!Q)Q="disabled";q.UniCRS=Q;window.ESVS=q;var na=null,O=[],Ba=0,z={};z.name=pa.NAME;z.data=pa.DATA;O[Ba++]=z;var T=[{eval:!0,intergrity:!0,name:"json2",url:"unisignweb/framework/json2.js"},{eval:!0,intergrity:!0,name:"Blob",url:"unisignweb/framework/Blob.js"},{eval:!1,intergrity:!0,name:"FileSaver",url:"unisignweb/framework/FileSaver.js"},{eval:!1,intergrity:!0,name:"UniSignW2AUtil",url:"unisignweb/framework/UniSignW2AUtil.js"},{eval:!1,intergrity:!0,name:"UniSignW2AExtension",url:"unisignweb/framework/UniSignW2AExtension.js"},{eval:!0,intergrity:!0,name:"draggable",url:"unisignweb/framework/draggable.js"},{eval:!0,intergrity:!0,name:"jsustoolkitErrCode",url:"jsustoolkit/jsustoolkitErrCode.js"},{eval:!0,intergrity:!0,name:"asn1",url:"jsustoolkit/toolkit/asn1.js"},{eval:!0,intergrity:!0,name:"jsbn",url:"jsustoolkit/toolkit/jsbn.js"},{eval:!0,intergrity:!0,name:"oids",url:"jsustoolkit/toolkit/oids.js"},{eval:!0,intergrity:!0,name:"util",url:"jsustoolkit/toolkit/util.js"},{eval:!0,intergrity:!0,name:"unicode",url:"jsustoolkit/toolkit/unicode.js"},{eval:!0,intergrity:!0,name:"aes",url:"jsustoolkit/crypto/aes.js"},{eval:!0,intergrity:!0,name:"des",url:"jsustoolkit/crypto/des.js"},{eval:!0,intergrity:!0,name:"desofb",url:"jsustoolkit/crypto/desofb.js"},{eval:!0,intergrity:!0,name:"seed",url:"jsustoolkit/crypto/seed.js"},{eval:!0,intergrity:!0,name:"rc2",url:"jsustoolkit/crypto/rc2.js"},{eval:!0,intergrity:!0,name:"hmac",url:"jsustoolkit/crypto/hmac.js"},{eval:!0,intergrity:!0,name:"md5",url:"jsustoolkit/crypto/md5.js"},{eval:!0,intergrity:!0,name:"sha1",url:"jsustoolkit/crypto/sha1.js"},{eval:!0,intergrity:!0,name:"sha256",url:"jsustoolkit/crypto/sha256.js"},{eval:!0,intergrity:!0,name:"rsa",url:"jsustoolkit/crypto/rsa.js"},{eval:!0,intergrity:!0,name:"prng",url:"jsustoolkit/crypto/prng.js"},{eval:!0,intergrity:!0,name:"random",url:"jsustoolkit/crypto/random.js"},{eval:!0,intergrity:!0,name:"pki",url:"jsustoolkit/toolkit/pki.js"},{eval:!0,intergrity:!0,name:"pkcs5",url:"jsustoolkit/toolkit/pkcs5.js"},{eval:!0,intergrity:!0,name:"pkcs8",url:"jsustoolkit/toolkit/pkcs8.js"},{eval:!0,intergrity:!0,name:"pkcs7",url:"jsustoolkit/toolkit/pkcs7.js"},{eval:!0,intergrity:!0,name:"pkcs7asn1",url:"jsustoolkit/toolkit/pkcs7asn1.js"},{eval:!0,intergrity:!0,name:"pkcs12",url:"jsustoolkit/toolkit/pkcs12.js"},{eval:!0,intergrity:!0,name:"x509Certificate",url:"jsustoolkit/toolkit/x509Certificate.js"},{eval:!0,intergrity:!0,name:"cmpasn1",url:"jsustoolkit/toolkit/cmpasn1.js"},{eval:!0,intergrity:!0,name:"cmp",url:"jsustoolkit/toolkit/cmp.js"},{eval:!0,intergrity:!0,name:"usWebCMPXMLHttp",url:"jsustoolkit/webcmp/usWebCMPXMLHttp.js"},{eval:!0,intergrity:!0,name:"usWebCMP",url:"jsustoolkit/webcmp/usWebCMP.js"}];"Enabled"===Q&&(T.push({eval:!1,intergrity:!0,name:"unicrs_nimservice",url:"unicrsv3/js/unicrs_nimservice.js"}),T.push({eval:!1,intergrity:!0,name:"unicrsv3client",url:"unicrsv3/js/unicrsv3client.js"}),T.push({eval:!1,intergrity:!0,name:"unicrsv3",url:"unicrsv3/js/unicrsv3.js"}));var Ja=[{eval:!1,intergrity:!0,name:"npkicacerts",url:"unisignweb/js/storage/ins/npkicacerts.js"},{eval:!1,intergrity:!0,name:"encryptstorage",url:"unisignweb/js/storage/enc/encryptstorage.js"},{eval:!1,intergrity:!0,name:"localstorage",url:"unisignweb/js/storage/ls/localstorage.js"},{eval:!1,intergrity:!0,name:"localstoragehandler",url:"unisignweb/js/storage/ls/localstoragehandler.js"},{eval:!1,intergrity:!0,name:"storagehandler",url:"unisignweb/js/storage/storagehandler.js"},{eval:!1,intergrity:!0,name:"storageerrcode",url:"unisignweb/js/storage/err/storageerrcode.js"}];new function(){for(var a=0;a<T.length;a++)0==a?"object"!==typeof JSON&&H(T[a]):1==a||2==a?document.createElementNS&&(2==a?(eval(H(T[a])),na=eval("saveAs")):H(T[a])):3==a?(H(T[3]),H(T[4]),a=4):H(T[a]);if(2&q.Mode){for(var c=null,a=0;a<Ja.length;a++)c=eval(H(Ja[a]));try{za=new StorageHandler(1,{enc_algo:q.EncAlgo,hash_algo:q.HashAlgo,pki:q.PKI,domain:document.domain,error_code:c})}catch(b){a=window.console||{log:function(){}},a.log("*** StorageHandler initializing error ***"),a.log("e.code : ",b.code,"e.message : ",b.message,"e.detail : ",b.detail),za=null}}};var E={BSUTIL:function(){}};E.BSUTIL.prototype={isKeyProtected:function(){return"touchen"==a.ESVS.SecureKeyboardType&&a.bsUtil().isTouchEnKeyUsable()||"ahnlab"==a.ESVS.SecureKeyboardType&&a.bsUtil().isAhnlabProtectorUsable()?!0:!1},GetKeyboardType:function(){if("touchen"==a.ESVS.SecureKeyboardType){if("undefined"!=typeof isInstalledTouchEnKey)return a.ESVS.SecureKeyboardType}else if("ahnlab"==a.ESVS.SecureKeyboardType&&!0==a.isSKModule)return a.ESVS.SecureKeyboardType;return""},isTouchEnKeyUsable:function(){return 2&a.ESVS.Mode||"undefined"==typeof isInstalledTouchEnKey?!1:isInstalledTouchEnKey()},ahnlabInit:function(){0<=W.indexOf("ahnlab")&&"undefined"!=typeof $ASTX2&&"undefined"!=typeof $ASTX2.init&&"undefined"!=typeof $ASTX2.initNonE2E&&!1!=a.isSKModule&&$ASTX2.initNonE2E(2522)},isAhnlabProtectorUsable:function(){return 2&a.ESVS.Mode||"undefined"==typeof $ASTX2||"undefined"==typeof $ASTX2.init||"undefined"==typeof $ASTX2.initNonE2E?!1:a.isSKModule},GetAhnlabEncInputInfo:function(a){return{type:3,value:{pageID:$ASTX2.getE2EPageID()+"",inputID:$ASTX2.getE2EInputID(document.getElementById(a))}}},AhnlabClearText:function(d){"ahnlab"==a.ESVS.SecureKeyboardType&&this.isAhnlabProtectorUsable()&&$ASTX2.clearE2EText(document.getElementById(d))},SetSecurityStatus:function(d){d=document.getElementById(d);"touchen"==a.ESVS.SecureKeyboardType&&this.isTouchEnKeyUsable()?d.setAttribute("data-enc","on"):d.setAttribute("data-enc","off")},SetReScan:function(){"touchen"==a.ESVS.SecureKeyboardType&&this.isTouchEnKeyUsable()&&TouchEnKey_ReScan()},GetEncryptPwd:function(d,c){return null==a.pubkey||0>=a.pubkey.length?"":GetEncDataFun(a.pubkey,d,c)},GetDecryptPwd:function(d,c){var b=GetEncDataFun("-----BEGIN CERTIFICATE-----MIIDZzCCAk+gAwIBAgIBATANBgkqhkiG9w0BAQsFADBKMQswCQYDVQQGEwJLUjESMBAGA1UEChMJQ3Jvc3NDZXJ0MQ4wDAYDVQQLEwVTVExhYjEXMBUGA1UEAxMOQ3Jvc3NDZXJ0V2ViVjMwHhcNMTQwNjI1MDAwMDAwWhcNMjkxMjMxMjM1OTAwWjBKMQswCQYDVQQGEwJLUjESMBAGA1UEChMJQ3Jvc3NDZXJ0MQ4wDAYDVQQLEwVTVExhYjEXMBUGA1UEAxMOQ3Jvc3NDZXJ0V2ViVjMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDIm9p0HiCrpFVSfRVdnC3V4kEC75F8bUWV/Ewa7TmuirbVOYsdtSpz+Yceh+Tindducrf6zGNlhhNpyhFQ6+4/f0qLdwALapojECOUQg/lISRD2FO88hEhBj/rOjZiVzHYyHm8K2bTtBJXNauBBCb1yUKNdHuAvw4xub/jcgZ2PRtWORrQwuStcGBSSnqCIHZcGb5KKdHtY15ppcZoZBXB75kKKdK8qJm/6A/bBW0S+o3ooN+oaGrFFEVH61AHi45sBHGO4e1oyRT8dfIgKUzUQOKSZ1r3Wln4CSqQR8tZOd/T+LzzSB7r4N/rzNo3T4oO5O6lkQBw3NZg25nMXBj7AgMBAAGjWDBWMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFJ7NboZBgBMwRmav8MSGpsMab+NjMA4GA1UdDwEB/wQEAwIGwDAXBgNVHSAEEDAOMAwGCiqDGoyaRAUEAQEwDQYJKoZIhvcNAQELBQADggEBAIU2d1CH6vsZaTAeSCdBM1tKcl/8YpnUSqt3w6DB45E9akGCODgEI1K/KPtRIhrjBBYopQJN9Z3F411xiw2Te0LJQKA9snAtRZCEbL/1FzjyUXKEv5QB9Zgch4KvbqhOdVb1bJsztJH1kV/lbeNbil2TI1NntWbKyPWDKlzdPsGbSAgaFkUtbt7fxcGJBoXAEsaohtNiDM3chfJWv4d0dlDito5isOMIMDN+bfLcBp745T+wEpig6bfbVZnDjzGbXhJJjVvFKydQrZfrLBnVLCpElD1xN1Ipw+6UGJXEuxqXS51drnG9jVU1FL9JDtDE7BNByXV2V9y9b1/6PSeSYMw=-----END CERTIFICATE-----",d,c);if(0>=b.length)return"";var b=a.usWebToolkit.util.decode64(b),e=b.substr(0,256),b=b.substr(256,b.length),g=a.usWebToolkit.pki.privateKeyFromBase64("MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDIm9p0HiCrpFVSfRVdnC3V4kEC75F8bUWV/Ewa7TmuirbVOYsdtSpz+Yceh+Tindducrf6zGNlhhNpyhFQ6+4/f0qLdwALapojECOUQg/lISRD2FO88hEhBj/rOjZiVzHYyHm8K2bTtBJXNauBBCb1yUKNdHuAvw4xub/jcgZ2PRtWORrQwuStcGBSSnqCIHZcGb5KKdHtY15ppcZoZBXB75kKKdK8qJm/6A/bBW0S+o3ooN+oaGrFFEVH61AHi45sBHGO4e1oyRT8dfIgKUzUQOKSZ1r3Wln4CSqQR8tZOd/T+LzzSB7r4N/rzNo3T4oO5O6lkQBw3NZg25nMXBj7AgMBAAECggEATCIZ/geRDpMHbo7aFPS40HtVgO+6nyY5Snq9x1pQkdVDHhkAmv2uZuVESmn4i6irodcXy67V6inAJF3zxGpFuQNuHw/CjJKgfL4bQqDvt12kjbsDzKlxpr7gcz1cdmXxHPy4dpliJOYqL77Gn+gbgRwojdavKGVZ1bVRBdi4axaImRM8khRckQnQbypLuFAIoptbKLo940P/LC3lFmVZDvDW0I4CG/gvTpxdDo58y7jeMngeklJDJ+aKv1Ji6Cqo0eSNhjz1hBm6Go1eob/7JxyZ07Vykr9y718SoHhjGMDlX6zoR1NV0/bYDuwRhddcokvJxGvFKudSNgZI7tVpQQKBgQD/IT8wPbbwyftCZsYdnqCLKhyoxg492ci5aLKfHZNVhOatFlIPKCqvWDVAQPqMIisFk1X7PNajEK8y2SOwy6rhy36fqrAf9WC8yYpUiInf4SdItHoQiCKDq0vmae/Jua4Rwmiut2L4soLyTTXvQ7b51Hv+ZkcuDHqewvGca1YZLQKBgQDJSwEasIPwNbvANIajgsrB6jpegtEn58dpzF0dM9ErEts+xhf2h3VRglbhRm3mroy72Dul+urmUD/9tGNOmF9ON3teVmBzmvB5QZUlDaHtfoHA5MTL35f0Hpt8T7sGzIu97HxLSbD5WuoIPSMO/1yX3m4Vi7oJfgctWfojso8DxwKBgQCS7yLlNaXWp3z9kRMom+L6QxaeXPJ2zKa9oX6+BNqFtjTkGqbH8+ohcju49bNWYZdFbsVmHHPBFirQrh3QBHw17mzOqA8nWLqN/8SbSsedGJ73UHm8a6r1CgJ8gSaIl1eZAs4nUZa+hJDF25HkaqtG1wlSSrVT3/v+02czHt5HQQKBgQC6klKLsmAYHTXQiN7iXzAfXEKNpyLFogcrAMitcIHHMssT+/fqANO0oOJ2GxlyXwcCdQGUbmWa43bsaG5DQufTT4mBfv4XKN0LBsZ+eYxE3KTXbTMa5DurgVMMfboUKzK67p6mCb+G38VbrY75L6da/Ed8oO3mLnHojyVSQQZdsQKBgAar8TGlK5fe+TKFa81jR5n8pD9rVHpLoagsjK3ueA7tnRHwXHxVTItGU/S9HyZxPuA1EA9VVSol73a924Q569sFd/sd9rJCF5Z3EUmM3IXKpfEhA5E5lJ9ZkqjjWVgNiu2cJG4MDdAB3FSJ0tB+WjAHUrXWkQrF7D+Av0XUP0uB").decrypt(e);if(32>g.length)return"";e=g.substr(0,16);g=g.substr(16,g.length);e=a.usWebToolkit.cipher.algorithms.seed.startDecrypting(e,g);e.update(a.usWebToolkit.util.createBuffer(b));e.finish();return e.output.getBytes()},GetEnvelopedPwd:function(d){if(null==d||0>=d.length)return"";var c=a.usWebToolkit.pki.certificateFromBase64(a.ESVS.CertforKeyboard),b=a.usWebToolkit.pkcs7.createEnvelopedData();b.addRecipient(c);b.encContent.algorithm=a.usWebToolkit.pki.oids["seed-CBC"];b.content=a.usWebToolkit.util.createBuffer(d);b.encrypt();return a.usWebToolkit.pkcs7.messageToBase64(b)}};E.UI=function(){this._errormsglang=eval(eval(function(){return H({eval:!1,intergrity:!1,name:"errormsg_"+q.Language,url:"unisignweb/rsrc/lang/"+q.Language+"/errormsg_"+q.Language+".js"})})())};E.UI.prototype={isValidDevice:function(d){for(var c in a.CONST.medias)if(a.CONST.medias[c].device===d)return!0;return!1},getMediaName:function(d){var c="",b;for(b in a.CONST.medias)if(a.CONST.medias[b].device===d){c=a.CONST.medias[b].name;break}return c},getMediaDevice:function(d){var c=-1,b;for(b in a.CONST.medias)if(a.CONST.medias[b].name===d){c=a.CONST.medias[b].device;break}return c},isItPortableDevice:function(){return"android"===a.osName||"ios"===a.osName?!0:!1},isItLGAndroidBrowser:function(){return"android lg"===a.browserName?!0:!1},isItSamsungAndroidBrowser:function(){return"android samsung"===a.browserName?!0:!1},isItSupportingPFCertBackUp:function(){if(!(2&a.ESVS.Mode))return!1;if(this.isItPortableDevice())return"android samsung"===a.browserName||"android lg"===a.browserName||"android browser"===a.browserName||"android chrome"===a.browserName||"ios safari"===a.browserName||"ios chrome"===a.browserName?!0:!1;if("chrome"===a.browserName)return!0;if("msie"===a.browserName){if(10<=parseInt(a.browserVersion))return!0}else{if("firefox"===a.browserName)return parseInt(a.browserVersion),!0;if("safari"===a.browserName){if(6.1<=parseFloat(a.browserVersion))return!0}else if("opera"===a.browserName)return parseInt(a.browserVersion),!0}return!1},isItPFDevice:function(d){switch(d){case a.CONST.__PF_M_SS.device:case a.CONST.__PF_M_LS.device:case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:case a.CONST.__PF_M_CLOUDSIGN.device:return!0}return!1},isItSupportingThisStorage:function(d){if(!d)return!1;var c=!1;if(1===(255&a.ESVS.Mode)||4===a.ESVS.Mode)switch(d.device){case a.CONST.__USFB_M_DISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__USFB_M_MOBILE.device:case a.CONST.__USFB_M_HDD.device:case a.CONST.__USFB_M_MOBILETOKEN.device:case a.CONST.__USFB_M_SECUREDISK.device:c=this.isItPortableDevice()?!1:!0;break;default:c=!1}else if(2===(255&a.ESVS.Mode))switch(d.device){case a.CONST.__PF_M_LS.device:case a.CONST.__PF_M_SS.device:case a.CONST.__PF_M_CLOUDSIGN.device:c=!0;break;case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:c=this.isItPortableDevice()?!1:!0;break;default:c=!1}else if(3===(255&a.ESVS.Mode)||6===(255&a.ESVS.Mode))switch(d.device){case a.CONST.__USFB_M_DISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__USFB_M_MOBILE.device:case a.CONST.__USFB_M_HDD.device:case a.CONST.__USFB_M_MOBILETOKEN.device:case a.CONST.__USFB_M_SECUREDISK.device:c=this.isItPortableDevice()?!1:!0;break;case a.CONST.__PF_M_SS.device:case a.CONST.__PF_M_LS.device:case a.CONST.__PF_M_CLOUDSIGN.device:c=!0;break;case a.CONST.__PF_M_TOUCHSIGN.device:case a.CONST.__PF_M_SMARTSIGN.device:case a.CONST.__PF_M_WEBSECTOKEN.device:case a.CONST.__PF_M_WEBSOFTTOKEN.device:c=this.isItPortableDevice()?!1:!0;break;default:c=!1}return c},getScrollTop:function(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop},getScrollLeft:function(){return self.pageXOffset?self.pageXOffset:document.documentElement&&document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft},getViewportHeight:function(){return window.undefined!=window.innerHeight?window.innerHeight:"CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body?document.body.clientHeight:window.undefined},getViewportWidth:function(){return window.undefined!=window.innerWidth?window.innerWidth:"CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body?document.body.clientWidth:window.undefined},getStyle:function(a,c,b){if(!a||!c||!b)return null;var e=null;return e=a.currentStyle?a.currentStyle[c]:window.getComputedStyle?window.getComputedStyle(a,"").getPropertyValue(b):null},getNumSize:function(a){if(!a)return-1;a=a.toLowerCase();var c="";if(-1<a.indexOf("px"))c=a.substring(0,a.indexOf("px"));else return-1;return parseInt(c)},getOverlay:function(a){if(0>a||!a)return null;var c=document.createElement("div");c.style.zIndex=a;c.style.backgroundImage="none";c.style.margin="0px";c.style.cursor="auto";c.style.display="none";c.onclick=null;c.style.position="fixed";c.style.width="100%";c.style.height="100%";c.style.top="0";c.style.left="0";c.style.filter="alpha(opacity=50)";c.style.backgroundColor="#000";c.style.opacity="0.5";return c},loadingBox:function(d,c,b){if(null==c||""==c)c="us-div-list-load";c=document.getElementById(c);if(null!=c){document.getElementById("us-cert-processing-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/processing-img.gif",0);null==b&&(b=0);var e=document.getElementById("us-cert-processing-text");e.innerHTML="";e.appendChild(document.createTextNode(this._errormsglang.IDS_CERT_LOADING_MSG[b]));c.style.display=d?"":"none"}},createLoadingBox:function(d,c,b){if(null==c||""==c)c="us-div-loading-dialog";null==document.getElementById(c)?"hide"!=d&&(d=ma+1,a.ESVS.TargetObj.innerHTML='<div id="us-div-loading-dialog" style="z-index:'+d+'" class="us-layout-loading-o"></div><div style="z-index:'+d+'" class="us-layout-loading"><span class="us-layout-cert-processing-img"><img id="us-div-loading-dialog-img" class="us-layout-cert-processing-img"></span><span id="us-div-loading-dialog-text" class="us-layout-cert-processing-text"></span></div>',document.getElementById("us-div-loading-dialog-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/processing-img.gif",0),d=document.getElementById("us-div-loading-dialog-text"),d.innerHTML="",d.appendChild(document.createTextNode(b))):"change"==d?(d=document.getElementById("us-div-loading-dialog-text"),d.innerHTML="",d.appendChild(b)):a.ESVS.TargetObj.innerHTML=""},addCapsLockEvent:function(a,c,b,e){a=document.getElementById(a);var g=document.getElementById(c);if(!g||!a)return null;c=document.getElementById(c+"-text");""!=b&&c.appendChild(document.createTextNode(b));var f=function(){g&&(g.style.display="block")},h=!1,l=!1;a.onkeyup=function(a){a=a||event;a.which&&16==a.which&&(h=!1)};a.onkeydown=function(a){a=a||event;var d=0;a.which&&16==a.which&&(h=!0);window.event?d=a.keyCode:a.which&&(d=a.which);d&&20==d?l?(l=!1,g&&(g.style.display="none")):(l=!0,f()):d&&13==d&&e&&e(a?a:event)};a.onkeypress=function(a){a=a||event;var d=0,b=!1;window.event?(d=a.keyCode,b=a.shiftKey):a.which&&(d=a.which,b=h);65<=d&&90>=d&&!b?(l=!0,f()):97<=d&&122>=d&&b?(l=!0,f()):(l=!1,g&&(g.style.display="none"))};try{-1!=navigator.appVersion.toLowerCase().indexOf("win")&&(document.msCapsLockWarningOff=!0)}catch(m){}},offsetResize:function(a,c){if(a){var b=this.getViewportHeight()/2-a.offsetHeight/2,e=this.getViewportWidth()/2-a.offsetWidth/2;0>b&&(b=0);0>e&&(e=0);a.style.position="fixed";!c||"center"!=c&&"center"!=c.split(",")[0]?c&&"center"!=c?(a.style.top=c.split(",")[0]+"px",a.style.left=c.split(",")[1]+"px"):(a.style.top="30px",a.style.left=e+"px"):(a.style.top=b+"px",a.style.left=e+"px")}},setCookie:function(a){localStorage.setItem("cookie",JSON.stringify(a))},getCookie:function(){var a=localStorage.getItem("cookie");return a?JSON.parse(a):null},msgBox:function(a){a&&alert(a)},setFirstFocus:function(a){a&&("string"==typeof a&&(a=document.getElementById(a)),a&&(a.focus(),setTimeout(function(){a.focus()},10)))},setRotationTabFocus:function(a,c,b){function e(a){return"string"==typeof a?document.getElementById(a):a}a&&c&&b&&(a=e(a),c=e(c),b=e(b),a.onkeydown=function(e){var f=e||window.event;9==(f.which||f.keyCode)&&(a.onblur=function(){setTimeout(function(){(f.shiftKey?c:b).focus()},10)})})},flagAlert:function(a){a&&!1!=I&&alert(a)},errMsgBox:function(a,c){a&&alert(a+"\n\nError Code [ "+c+" ]")},getErrorMessageLang:function(){return this._errormsglang},getUserCancelErrCodeNMsg:function(d){11003!=a.ERROR.Code&&21002!=a.ERROR.Code&&31001!=a.ERROR.Code&&(a.ERROR.Code=999,a.ERROR.Message=this._errormsglang.IDS_ERROR_USER_CANCEL);d&&(d.resultCode=a.ERROR.Code,d.resultMessage=a.ERROR.Message)},CheckPwdPattern:function(d,c){var b=!0;if(4&a.ESVS.Mode&&a.bsUtil().isKeyProtected())a.nimservice().CheckPasswdCombination(d,a.ESVS.LimitMinNewPWLen,a.ESVS.LimitMaxNewPWLen,a.ESVS.LimitNewPWPattern,function(a,d){0!=a?c(!1):c(!0)});else{a.ESVS.LimitMinNewPWLen>d.length&&(b=!1);a.bsUtil().isKeyProtected()&&c(b);if("NPKI"===a.ESVS.PKI||2===a.ESVS.LimitNewPWPattern){var e=/^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[^a-zA-Z0-9])/g;e.exec(d)||(b=!1)}else 1===a.ESVS.LimitNewPWPattern&&(e=/^(?=.*[a-zA-Z])(?=.*[0-9])/g,e.exec(d)||(b=!1));if("NPKI"===a.ESVS.PKI&&(e=/['"\\|]/g,e.exec(d)&&(b=!1),2<d.length)){for(e=0;e<d.length-2;e++)if(d.charAt(e)===d.charAt(e+1)&&d.charAt(e)===d.charAt(e+2)){b=!1;break}for(e=0;e<d.length-2;e++)if(d.charCodeAt(e)===d.charCodeAt(e+1)-1&&d.charCodeAt(e)===d.charCodeAt(e+2)-2){b=!1;break}}c(b)}}};E.CERT=function(){var a=eval(eval(function(){return H({intergrity:!1,name:"errormsg_"+q.Language,url:"unisignweb/rsrc/lang/"+q.Language+"/certlist_"+q.Language+".js"})})());this._certOidNameTable={};this._certOidNameTable["1.2.410.200004.5.1.1.5"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.1.1.7"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.1"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.2"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.1"]=a.IDS_AGENCY_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.3.1.9"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.4.1.3"]=a.IDS_SERVER_CERTIFICATE;this._certOidNameTable["1.2.410.200004.5.5.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.5.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200005.1.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200005.1.1.5"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200012.1.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200012.1.1.3"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.2.1.7.1"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.2.1.7.2"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.2.1.7.3"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.1.1.9"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.1.1.9.2"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200005.1.1.4"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200005.1.1.6.2"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.4.1.101"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.4.1.102"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200004.5.4.1.103"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.4.1.104"]=a.IDS_PERSON_ELECTRONIC_CIVIL_APPEAL;this._certOidNameTable["1.2.410.200012.1.1.101"]=a.IDS_PERSON_BANKING_N_INSURANCE;this._certOidNameTable["1.2.410.200012.1.1.103"]=a.IDS_PERSON_STOCKTRADING_N_INSURANCE;this._certOidNameTable["1.2.410.200012.1.1.105"]=a.IDS_PERSON_CREDITCARD;this._certOidNameTable["1.2.410.200004.5.5.1.1"]=a.IDS_PERSON_GENERAL_PURPOSE;this._certOidNameTable["1.2.410.200004.5.5.1.2"]=a.IDS_CORPORATION_GENERAL_PURPOSE;this._certOidNameTable["1.1.1.1.1.1.1.1.1.1"]=a.IDS_VERISIGN;this._certOidNameTable.restriction=a.IDS_RESTRICTION;this._certCAOidTable={};this._certCAOidTable.crosscert="1.2.410.200004.5.4";this._certCAOidTable.yessign="1.2.410.200005.1.1";this._certCAOidTable.koscom="1.2.410.200004.5.1";this._certCAOidTable.ktnet="1.2.410.200012.1.1";this._certCAOidTable.kica="1.2.410.200004.5.2";this._certCAOidTable.inipass="1.2.410.200004.5.5";this._certCAOidTable.verisign="1.1.1.1.1.1";this._certCANameTable={};this._certCANameTable.crosscert=a.IDS_CA_CROSSCERT;this._certCANameTable.yessign=a.IDS_CA_YESSIGN;this._certCANameTable.koscom=a.IDS_CA_KOSCOM;this._certCANameTable.ktnet=a.IDS_CA_KTNET;this._certCANameTable.kica=a.IDS_CA_KICA;this._certCANameTable.inipass=a.IDS_CA_INIPASS;this._certValidState={};this._certValidState.valid=a.IDS_CERT_STATE_VALID;this._certValidState.invalid=a.IDS_CERT_STATE_INVALID;this._certValidState.notice1=a.IDS_CERT_STATE_NOTICE_1;this._certValidState.notice2=a.IDS_CERT_STATE_NOTICE_2;this.certDNAttribute=[];this.certDNAttribute[0]="cn";this.certDNAttribute[1]="c";this.certDNAttribute[2]="l";this.certDNAttribute[3]="s";this.certDNAttribute[4]="st";this.certDNAttribute[5]="street";this.certDNAttribute[6]="o";this.certDNAttribute[7]="ou";this.certDNAttribute[8]="dnqualifier";this.certDNAttribute[9]="dc";this.certDNAttribute[10]="serialnumber";this.certDNAttribute[11]="e"};E.CERT.prototype={getCN:function(a){if(!a)return"undefined";var c=null,b=a.replace(/(^\s*)|(\s*$)/gi,"").split("="),e=b.length,g=[],f=0;if(1<e){for(var h=0;h<e;h++)if(-1!=b[h].indexOf(","))for(var l=b[h].split(","),m=l.length,n=0;n<m;n++)g[f++]=l[n];else g[f++]=b[h];for(b=0;b<f;b++)if(this.certDNAttribute[0]==g[b].toLowerCase()){c=g[++b];break}if(f<=b+1)return null===c?this.getOU(a):c;a=this.certDNAttribute.length;do{++b;for(n=1;n<a;n++)if(this.certDNAttribute[n]==g[b].toLowerCase())return c;c=c+", "+g[b]}while(b<f)}return"undefined"},getO:function(a){if(!a)return"undefined";var c=null,b=a.replace(/\s/g,"").replace(/(^\s*)|(\s*$)/gi,"").split("="),e=b.length;a=[];var g=0;if(1<e){for(var f=0;f<e;f++)if(-1!=b[f].indexOf(","))for(var h=b[f].split(","),l=h.length,m=0;m<l;m++)a[g++]=h[m];else a[g++]=b[f];for(b=0;b<g;b++)if(this.certDNAttribute[6]==a[b].toLowerCase()){c=a[++b];break}if(g<=b+1)return null===c?"undefined":c;e=this.certDNAttribute.length;do{++b;for(m=0;m<e;m++)if(this.certDNAttribute[m]==a[b].toLowerCase())return c;c=c+", "+a[b]}while(b<g)}return"undefined"},getOU:function(a){if(!a)return"undefined";var c=null,b=a.replace(/(^\s*)|(\s*$)/gi,"").split("="),e=b.length;a=[];var g=0;if(1<e){for(var f=0;f<e;f++)if(-1!=b[f].indexOf(","))for(var h=b[f].split(","),l=h.length,m=0;m<l;m++)a[g++]=h[m];else a[g++]=b[f];for(b=0;b<g;b++)if(this.certDNAttribute[7]==a[b].toLowerCase()){c=a[++b];break}if(g<=b+1)return null===c?"undefined":c;e=this.certDNAttribute.length;do{++b;for(m=0;m<e;m++)if(this.certDNAttribute[m]==a[b].toLowerCase())return c;c=c+", "+a[b]}while(b<g)}return"undefined"},getLocalDate:function(a){if(!a)return"undefined";var c=new Date(a);a=c.getFullYear();var b=c.getMonth()+1,c=c.getDate();10>b&&(b="0"+b);10>c&&(c="0"+c);return a+"-"+b+"-"+c},getLocalDateNTime:function(a){if(!a)return"undefined";var c=new Date(a);a=c.getFullYear();var b=c.getMonth()+1,e=c.getDate(),g=c.getHours(),f=c.getMinutes(),c=c.getSeconds();10>b&&(b="0"+b);10>e&&(e="0"+e);10>g&&(g="0"+g);10>f&&(f="0"+f);10>c&&(c="0"+c);return a+"-"+b+"-"+e+" "+g+":"+f+":"+c},getCertType:function(d){if("MPKI"==a.ESVS.PKI)return"Symantec";if(!d)return"undefined";d=this._certOidNameTable[d];return null==d||""==d?this._certOidNameTable.restriction:d},getIssuerName:function(a){if(!a)return"undefined";var c=null;return c=-1!=a.indexOf(this._certCAOidTable.crosscert)?this._certCANameTable.crosscert:-1!=a.indexOf(this._certCAOidTable.yessign)?this._certCANameTable.yessign:-1!=a.indexOf(this._certCAOidTable.koscom)?this._certCANameTable.koscom:-1!=a.indexOf(this._certCAOidTable.ktnet)?this._certCANameTable.ktnet:-1!=a.indexOf(this._certCAOidTable.kica)?this._certCANameTable.kica:-1!=a.indexOf(this._certCAOidTable.inipass)?this._certCANameTable.inipass:-1!=a.indexOf(this._certCAOidTable.verisign)?this._certCANameTable.verisign:"undefined"},getIssuerEnName:function(a){if(!a)return"undefined";var c=null;return c=-1!=a.indexOf(this._certCAOidTable.crosscert)?"crosscert":-1!=a.indexOf(this._certCAOidTable.yessign)?"yessign":-1!=a.indexOf(this._certCAOidTable.koscom)?"SignKorea":-1!=a.indexOf(this._certCAOidTable.ktnet)?"ktnet":-1!=a.indexOf(this._certCAOidTable.kica)?"kica":-1!=a.indexOf(this._certCAOidTable.inipass)?"inipass":-1!=a.indexOf(this._certCAOidTable.verisign)?"verisign":"undefined"},getExpirationState:function(a){if(!a)return"undefined";a=new Date(a);var c=(new Date).getTime();a=a.getTime()-c;return 0<a?2592E6<=a?this._certValidState.valid:this._certValidState.notice1+parseInt(a/1E3/60/60/24)+this._certValidState.notice2:this._certValidState.invalid},getExpirationStateValue:function(a){if(!a)return-1;a=new Date(a);var c=(new Date).getTime();a=a.getTime()-c;return 0<a?2592E6<=a?0:1:2},getTheCertAttributes:function(d,c){if(!d||!c)return{};a.usWebToolkit.x509Certificate.parser(d,c);var b=null;try{b=a.usWebToolkit.x509Certificate.getVersion()}catch(e){}var g=null;try{g=a.usWebToolkit.x509Certificate.getSerialNumber()}catch(f){}var h=null;try{h=a.usWebToolkit.x509Certificate.getSignAlgo()}catch(l){}var m=null;try{m=a.usWebToolkit.x509Certificate.getIssuerName()}catch(n){}var k=null;try{k=a.usWebToolkit.x509Certificate.getNotBefore()}catch(p){}var r=null;try{r=a.usWebToolkit.x509Certificate.getNotAfter()}catch(t){}var u=null;try{u=a.usWebToolkit.x509Certificate.getSubjectName()}catch(w){}var y=null;try{y=a.usWebToolkit.x509Certificate.getPublickey()}catch(J){}var L=null;try{L=a.usWebToolkit.x509Certificate.getAuthorityKeyIndentifier()}catch(fa){}var C=null;try{C=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier()}catch($){}var oa=null;try{oa=a.usWebToolkit.x509Certificate.getKeyUsage()}catch(q){}var Ka=null;try{Ka=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid()}catch(Ta){}var La=null;try{La=a.usWebToolkit.x509Certificate.getSubjectAltName()}catch(x){}var v=null;try{v=a.usWebToolkit.x509Certificate.getAuthorityInfoAccess()}catch(z){}var A=null;try{A=a.usWebToolkit.x509Certificate.getcRLDistributionPoints()}catch(D){}var B=null;try{B=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS()}catch(F){}var E=null;try{E=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(H){}var G=null;try{G=a.usWebToolkit.x509Certificate.getSignature()}catch(I){}return{version:b,serialNumber:g,signAlgo:h,issuerName:m,validateFrom:k,validateTo:r,subjectName:u,publicKey:y,authorityKeyIndentifier:L,subjectKeyIndentifier:C,keyUsage:oa,policiesOid:Ka,subjectAltName:La,authorityInfoAccess:v,crlDistributionPoints:A,policiesCps:B,policiesUserNotice:E,signature:G}}};E.FORGERY=function(){this._lang=eval(eval(function(){return H({eval:!1,intergrity:!1,name:"forgery_"+q.Language,url:"unisignweb/rsrc/lang/"+q.Language+"/forgery_"+q.Language+".js"})})());this._md=a.usWebToolkit.md.algorithms.sha256.create();this._integrityList=[];var d=H({eval:!1,intergrity:!1,name:"unisign",url:"unisignweb/integrity/unisign.js"}),c=null;if(!(1&a.ESVS.Mode)){var b=window.console||{log:function(){}};null!=d||11<d.length?a.logger(" >>>> SignData : ["+d.length+"] "+d.substring(0,10)+"..."+d.substring(d.length-10,d.length)):a.logger(" >>>> SignData ERROR : "+d);var e=null,g,f;try{g=d,e=a.usWebToolkit.pkcs7.messageFromBase64(d),f=d,e.verify()}catch(h){a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : "+h.code);I=!1;a.logger(I+" >> signdata :: ("+(g==f)+") "+this._lang.IDS_MSGBOX_ERROR_VERIFY_SIGNED_DATA_OF_MD_TABLE+"\nerror code : "+h.code+"\nerror msg : "+h.message+"\na:"+g+"\nb:"+f);D&&b.log("error code : ",h.code,"\nerror msg : ",h.message);return}G("verify result : "+e.verifyResult);if(!0==e.verifyResult)a.intergrity.data=e.content;else if(-1<navigator.userAgent.indexOf("compatible"))a.nimservice()?a.nimservice().VerifySignedData(null,d,function(d,b,c){0!=d?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1368"),I=!1):a.intergrity.data=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(c))}):(a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1509"),I=!1);else{a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1513");I=!1;a.logger(">> verifyResult :: "+this._lang.IDS_MSGBOX_ERROR_VERIFY_SIGNED_DATA_OF_MD_TABLE);return}try{c=a.usWebToolkit.pki.certificateToBase64(e.certificates[0])}catch(l){a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : "+l.code);I=!1;a.logger(">> certificate error :: "+this._lang.IDS_MSGBOX_ERROR_GET_THE_CERT_FROM_SIGNED_DATA);D&&b.log("error code : ",l.code,"\nerror msg : ",l.message);return}}a.usWebToolkit.x509Certificate.parser(c,"Base64");Aa();d=a.usWebToolkit.x509Certificate.getSubjectName();if(!d||0>=d.length||"cn=crosscertwebv3,ou=stlab,o=crosscert,c=kr"!==d.toLowerCase())a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1401"),I=!1,a.logger(">> get dn : "+this._lang.IDS_MSGBOX_ERROR_VERIFY_THE_CERT);else if(d=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier(),!d||0>=d.length||"9ecd6e86418013304666aff0c486a6c31a6fe363"!==d)a.uiUtil().flagAlert(this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE+"\nErrCode : 1411"),I=!1,a.logger(">> get ski : "+this._lang.IDS_MSGBOX_ERROR_VERIFY_THE_CERT)};E.FORGERY.prototype={verify:function(d,c){Aa();var b=a.intergrity.getList();if(!b||0>=b.length)return null;if(!d||!c)return this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE;var e=null;this._md.start();this._md.update(c);for(var e=this._md.digest().toHex(),g=0;g<b.length;g++)if(b[g].name==d){if(b[g].data==e)return"success";a.logger("*** Suspicion Forgery ***\nintergrity file name : "+b[g].name+"\nintergrity file md data : "+b[g].data+"\ndownloaded file name : "+d+"\ndownloaded file md data : "+e+"\n"+this._lang.IDS_MSGBOX_WARNING_SUSPICION_FORGERY);G("*** Suspicion Forgery ***");G("intergrity file name : ",b[g].name,"\nintergrity file md data : ",b[g].data);G("downloaded file name : ",d,"\ndownloaded file md data : ",e);break}return this._lang.IDS_MSGBOX_ERROR_NEW_MESSAGE}};CheckIntergrity=function(){Aa();var d=null,c=null;G("==================================== CheckIntergrity START");for(var b=0;b<O.length;b++)if(d=O[b].name,c=O[b].data,rstr=a.forgeryUtil().verify(d,c),"success"===rstr)O[b].name=null,O[b].data=null,O[b]=null;else if(rstr){O[b].name=null;O[b].data=null;O[b]=null;a.uiUtil().flagAlert(rstr);I=!1;break}else return!1;return!0};String.prototype.endsWith=function(a){return this.length<a.length?!1:this.lastIndexOf(a)+a.length==this.length};String.prototype.startsWith=function(a){return this.length<a.length?!1:0==this.indexOf(a)};ArrayBuffer.prototype.toBase64=function(){var a=new Uint8Array(this),c,b=a.length,e="";for(c=0;c<b;c+=3)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a[c]>>2],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(a[c]&3)<<4|a[c+1]>>4],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(a[c+1]&15)<<2|a[c+2]>>6],e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a[c+2]&63];2===b%3?e=e.substring(0,e.length-1)+"=":1===b%3&&(e=e.substring(0,e.length-2)+"==");return e};String.prototype.toArrayBuffer=function(){var a=0.75*this.length,c=this.length,b=0,e,g,f,h;"="===this[this.length-1]&&(a--,"="===this[this.length-2]&&a--);for(var l=new ArrayBuffer(a),m=new Uint8Array(l),a=0;a<c;a+=4)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(this[a]),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(this[a+1]),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(this[a+2]),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(this[a+3]),m[b++]=e<<2|g>>4,m[b++]=(g&15)<<4|f>>2,m[b++]=(f&3)<<6|h&63;return l};E.FILE=function(){};E.FILE.prototype={save:function(a,c){if(a&&!(0>=a.length)&&c){var b=new Blob([c],{type:"application/octet-stream"});na(b,a)}}};var v=Q=null,K=0,z=null,P=navigator.platform,A=navigator.userAgent,Q=0<=P.indexOf("Win")?"win":0<=P.indexOf("Mac")?"mac":0<=P.indexOf("Linux")?"linux":0<=P.indexOf("iPhone")||0<=P.indexOf("iPad")||0<=P.indexOf("iPod")?"ios":"unknown";0<=A.indexOf("Android")&&(Q="android");"android"===Q?0<=A.indexOf("SAMSUNG")?(v="android samsung",z=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("OPR")?(v="android opera",z=/OPR\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Opera")?(v="android opera classic",z=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Firefox")?(v="android firefox",z=/Firefox\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("NAVER")?v="android naver":0<=A.indexOf("DaumApps")?(v="android daum",z=/DaumApps\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("nate_app")?v="android nate":0<=A.indexOf("UCBrowser")?(v="android uc",z=/UCBrowser\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Chrome")?0<=A.indexOf("Version")?(v=0<=A.indexOf("LG")?"android lg":"android browser",z=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("LG")?((z=/Chrome\/([0-9]{1,}[.0-9]{0,})/)&&z.exec(A)&&(K=parseFloat(RegExp.$1)),v=39>K?"android lg":"android chrome"):(v="android chrome",z=/Chrome\/([0-9]{1,}[.0-9]{0,})/):(v="unknown",K=0):"ios"===Q?0<=A.indexOf("CriOS")?(v="ios chrome",z=/CriOS\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("NAVER")?v="ios naver":0<=A.indexOf("DaumApps")?(v="ios daum",z=/DaumApps\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Coast")?(v="ios opera coast",z=/Coast\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Safari")?(v="ios safari",z=/Version\/([0-9]{1,}[.0-9]{0,})/):(v="unknown",K=0):0<=A.indexOf("MSIE")?(v="msie","BackCompat"==document.compatMode?K=5:document.documentMode?K=document.documentMode:z=/MSIE ([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Chrome")?(v="chrome",z=/Chrome\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Firefox")?(v="firefox",z=/Firefox\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Safari")?(v="safari",z=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("Opera")?(v="opera",z=/Version\/([0-9]{1,}[.0-9]{0,})/):0<=A.indexOf("rv:11.")?(v="msie",z=/rv:([0-9]{1,}[.0-9]{0,})/):(v="unknown",K=0);z&&z.exec(A)&&(K=parseFloat(RegExp.$1));var Aa=function(){return"msie"==v?10>K:"chrome"==v?10>K:"firefox"==v?10>K:"safari"==v?6.1>K:"opera"==v?15>K:!0},V=window.console||{log:function(){}};D&&(V.log("UI ver : ",Z,"\nplatform : ",P,"\nuseragent : ",A),V.log("OS name : ",Q,"\nbrowser name : ",v,"\nbrowser version : ",K));var a={ver:Z,nimVersion:"2.0.6.1",osName:Q,browserName:v,browserVersion:K,usWebToolkit:window.crosscert,isAvailable:function(){return D?!0:null==I?!1:I},isSKModule:null,pubkey:null,intergrity:{data:null,list:null,getList:function(){null==this.list&&(this.list=this.parser(this.data));return this.list},parser:function(a){"string"!==typeof a&&(a=new String(a));var c=[];a=a.split(/\r\n|\r|\n/g);for(var b=0;b<a.length;b++){var e=a[b].split("|"),g={};g.name=e[0];g.data=e[1];c[b]=g}return c}},logger:function(a){},trace:G,nimCheckUrl:X,plugin:function(){return document.getElementById("unisignwebplugin")},nimservice:function(){return Sa},options:{img_src:null},ubiKeyEnv:{version:"1,3,0,7",siteInfo:"CROSSCERT|http://www.ubikey.co.kr/infovine/download.html",securityInfo:"CROSSCERT|NULL",downloadURL:"http://www.ubikey.co.kr/infovine/download.html"},usimEnv:{sitecode:"303010001",modecode:"0003",siteURL:document.location.hostname,serviceIP:"service.smartcert.kr",servicePort:"443",downloadURL:"http://download.smartcert.kr"},uiUtil:function(){return __UIUtil},certUtil:function(){return __CertUtil},forgeryUtil:function(){return __ForgeryUtil},fileUtil:function(){return __FileUtil},bsUtil:function(){return __BSUtil},uiLayerLevel:ma,certsList:null,reInitialize:Pa,loadUI:Qa,CCPFSH:function(){return Ma},ActiveUI:null,ESVS:q,STATUS:{HadCheckedLicense:!1},PFSH:za,PFUC:null,ERROR:{Code:0,Message:null},CONST:{__USFB_M_DISK:{device:1,name:"removable"},__USFB_M_HSMKEY:{device:2,name:"sectoken"},__USFB_M_SMARTCARD:{device:3,name:"savetoken"},__USFB_M_MOBILE:{device:4,name:"mobilephone"},__USFB_M_HDD:{device:5,name:"harddisk"},__USFB_M_MOBILETOKEN:{device:6,name:"mobiletoken"},__USFB_M_SECUREDISK:{device:7,name:"securedisk"},__USFB_M_ETC:{device:9,name:"USFB_M_ETC"},__PF_M_LS:{device:11,name:"webstorage"},__PF_M_SS:{device:21,name:"sharestorage"},__PF_M_TOUCHSIGN:{device:12,name:"touchsign"},__PF_M_SMARTSIGN:{device:13,name:"smartsign"},__PF_M_WEBSECTOKEN:{device:14,name:"websectoken"},__PF_M_WEBSOFTTOKEN:{device:15,name:"websofttoken"},__PF_M_CLOUDSIGN:{device:16,name:"cloudsign"},__PF_M_ETC:{device:19,name:"PF_M_ETC"},medias:{}},SELECTINFO:{index:0,pw:null,curdevice:5,cert:null,certattrs:null}};__UIUtil=new E.UI;__CertUtil=new E.CERT;__ForgeryUtil=new E.FORGERY;__FileUtil=new E.FILE;__BSUtil=new E.BSUTIL;var Sa=Na(a),Ma=null;-1!=F.list.indexOf("sharestorage")&&(Ma=Oa(a));"ahnlab"==a.ESVS.SecureKeyboardType&&(a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_KS_INSTALL_CHECK),$ASTX2.init(function(){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");a.isSKModule=!0},function(){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");a.isSKModule=!1;$ASTX2.getLastError()}));a.CONST.medias={removable:a.CONST.__USFB_M_DISK,sectoken:a.CONST.__USFB_M_HSMKEY,savetoken:a.CONST.__USFB_M_SMARTCARD,mobilephone:a.CONST.__USFB_M_MOBILE,harddisk:a.CONST.__USFB_M_HDD,mobiletoken:a.CONST.__USFB_M_MOBILETOKEN,securedisk:a.CONST.__USFB_M_SECUREDISK,webstorage:a.CONST.__PF_M_LS,sharestorage:a.CONST.__PF_M_SS,touchsign:a.CONST.__PF_M_TOUCHSIGN,smartsign:a.CONST.__PF_M_SMARTSIGN,websectoken:a.CONST.__PF_M_WEBSECTOKEN,websofttoken:a.CONST.__PF_M_WEBSOFTTOKEN,cloudsign:a.CONST.__PF_M_CLOUDSIGN};VerifyLicense=function(){var d=location.href;D&&V.log("current url : ",d);d="";null!=a.ESVS.License&&"undefined"!==typeof a.ESVS.License&&(d=H({eval:!1,intergrity:!1,name:"License",url:a.ESVS.License}));if("touchen"==a.ESVS.SecureKeyboardType&&a.bsUtil().isTouchEnKeyUsable())a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_KS_INSTALL_CHECK),a.nimservice().GetCertForKeyboardEncrypt(document.domain,d,function(d,b,e){0==d?a.pubkey=e:a.ESVS.SecureKeyboardType="";a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");return!0});else return!0};VerifyPFLicense=function(){return!0};if(4&a.ESVS.Mode&&a.nimservice())VerifyLicense(function(a){!1==a&&D&&V.log("It stop to load unisignweb module.")});else if(!VerifyPFLicense()){D&&V.log("It stop to load unisignweb module.");return}X=function(){CheckIntergrity()?(O=null,!1==D&&null==I&&(I=!0)):G("## It couldnt check intergrity of files.")};null!=a.intergrity.data?X():setTimeout(X,1E3);D&&V.log("Is this Browser supporting plugin free cert backup? ",a.uiUtil().isItSupportingPFCertBackUp());4<=R&&ga();return{Available:function(){return a.isAvailable()},IsValidity:function(){return!1==a.isAvailable()?(a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE),!1):a.nimservice()?!0:!1},GetLastError:function(d){!1==a.isAvailable()?a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE):(d(a.ERROR.Code,a.ERROR.Message),a.ERROR.Code=0,a.ERROR.Message=null)},SetEmbeddedUI:function(d){!1==a.isAvailable()?a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE):a.ESVS.Embedded=d?!0:!1},SignDataP1:function(d,c,b){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||!b||document.getElementById("us-div-cert-select"))return!1;ga();var e=k(),g=function(a){1==b.length?b(a):(null==a&&(a=k()),b(a.signedData,a.theCert,a.theDN))};a.reInitialize();var f=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:c},onConfirm:function(b,c,m,n,s,p){e.theCert=b;e.theDN=c;if("undefined"!==typeof n&&"undefined"!==typeof s){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(p))a.nimservice()?(m=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)),a.nimservice().GetSignDataP1(n,s,m,null,!1,function(d,c,n,r,l,m){0!=d?(a.ERROR.Code=e.resultCode=d,a.ERROR.Message=e.resultMessage=c,a.uiUtil().errMsgBox(c,d)):(null==b&&a.CONST.__USFB_M_MOBILETOKEN.device==p&&(_certAttrs=a.certUtil().getTheCertAttributes(l,"Base64"),e.theCert=l,e.theDN=_certAttrs.subjectName),e.signedData=n,e.tokenlabel=m);g(e);a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){f.dispose()},10)})):(a.ERROR.Code=e.resultCode=-1,a.ERROR.Message=e.resultMessage=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_NIM_ERROR_UNLOAD,g(e),setTimeout(function(){f.dispose(!0)},10));else if(p==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGenSignNonVerifyPin(n,a.usWebToolkit.util.encodeUtf8(d),"Y",function(d,b,c){0!=d&&(a.ERROR.Code=d,a.ERROR.Message=b,setTimeout(function(){f.dispose()},10),g(k(d,b)));e.signedData=c;setTimeout(function(){f.dispose()},10);g(e)});else{try{var r=window.console||{log:function(){}};D&&(r.log("b64 cert : ",a.PFUC[n].signcert),r.log("b64 pri : ",a.PFUC[n].signpri));var t=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[n].signcert),u=a.usWebToolkit.pkcs8.decryptRsaPrivateKeyFromBase64(a.PFUC[n].signpri,s);n=null;switch(a.usWebToolkit.pki.oids[t.signatureOid]){case "sha1WithRSAEncryption":n=crosscert.md.algorithms.sha1.create();break;case "kcdsaWithSHA1":t.md=crosscert.md.algorithms.sha1.create();break;case "md5WithRSAEncryption":n=crosscert.md.algorithms.md5.create();break;case "sha256WithRSAEncryption":n=crosscert.md.algorithms.sha256.create();break;case "RSASSA-PSS":n=crosscert.md.algorithms.sha256.create()}n.update(a.usWebToolkit.util.encodeUtf8(d));var w=u.sign(n);e.signedData=a.usWebToolkit.util.encode64(w);g(e)}catch(y){a.ERROR.Code=y.code,a.ERROR.Message=y.message,a.uiUtil().errMsgBox(m,a.ERROR.Code),g(k(a.ERROR.Code,a.ERROR.Message))}setTimeout(function(){f.dispose()},10)}n=s=t=pri=null}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg(e);g(e);f.dispose(!0)}});f.show();return!0}},VerifySignedDataP1:function(d,c,b,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(d&&c&&b||e(-1),a.reInitialize(),4&a.ESVS.Mode&&a.ESVS.chkEXESetup)a.nimservice()&&(d=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)),a.nimservice().VerifyP1SignData(d,c,b,function(d,b){0!=d&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());e(d);a.uiUtil().loadingBox(!1,"us-div-list-load")}));else{c=a.usWebToolkit.util.decode64(c);b=a.usWebToolkit.pki.certificateFromBase64(b);var g="1.2.840.113549.1.1.5"==b.signatureOid||"1.2.410.200004.1.9"==b.signatureOid?a.usWebToolkit.md.sha1.create():"1.2.840.113549.1.1.4"==b.signatureOid?a.usWebToolkit.md.md5.create():"1.2.840.113549.1.1.11"==b.signatureOid||"1.2.840.113549.1.1.10"==b.signatureOid?a.usWebToolkit.md.sha256.create():null;g.update(d);var f;try{f=b.publicKey.verify(g.digest().getBytes(),c)}catch(h){f=!1}return f?0:-1}},SignDataP7:function(d,c,b,e,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||!g||document.getElementById("us-div-cert-select"))return!1;ga();var f=k(),h=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.signedData,a.curDevice,a.certAttrs,a.b64RValue))};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:c},onConfirm:function(c,g,s,p,r,t){var u=s;if("undefined"!==typeof p&&"undefined"!==typeof r)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))a.nimservice()?(setTimeout(function(){l.dispose()},10),a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_CERT_LOADING_MSG[1]),c=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)),a.nimservice().GetSignDataP7(p,r,c,"utf8",b,e,a.ESVS.multiuse,function(d,b,c,e,l,m){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0!=d?(a.ERROR.Code=f.resultCode=d,a.ERROR.Message=f.resultMessage=b):(null==u&&a.CONST.__USFB_M_MOBILETOKEN.device==t?(u=a.certUtil().getTheCertAttributes(l,"Base64"),B(p,r,t,l,u)):B(p,r,t,g,u),f.certAttrs=u,f.signedData=c,f.curDevice=t,f.b64RValue=e,f.tokenLabel=m);h(f);p=r=g=y=null})):(a.ERROR.Code=f.resultCode=-1,a.ERROR.Message=f.resultMessage=a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER,h(f),setTimeout(function(){l.dispose(!0)},10));else if(t==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGetCertR(p,function(b,c,e){0!=b&&(f.resultCode=b,f.resultMessage=c,setTimeout(function(){l.dispose()},10),h(k(b,c)));reqGenSignNonVerifyPin(p,a.usWebToolkit.util.encodeUtf8(d),"Y",function(b,c,m){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,h(k(b,c))):(B(p,r,t,g,u),b=a.usWebToolkit.util.decode64(m),c=a.usWebToolkit.pki.certificateFromBase64(g),m=crosscert.pkcs7.createSignedData(),m.signWithP1(b,d,c,null,null),f.signedData=a.usWebToolkit.pkcs7.messageToBase64(m),f.curDevice=t,f.b64RValue=e,h(f));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.dispose()},10);p=r=g=y=null})});else{try{var w=window.console||{log:function(){}};D&&(w.log("b64 cert : ",a.PFUC[p].signcert),w.log("b64 pri : ",a.PFUC[p].signpri));g=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[p].signcert);var y=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[p].signpri),J=a.usWebToolkit.pkcs7.createSignedData();J.sign(d,g,y,r,null,null);var L=a.usWebToolkit.pkcs8.decryptPrivateKeyInfo(y,r),fa=a.usWebToolkit.pkcs8.getPrivateKeyAttributesRandom(L);f.signedData=a.usWebToolkit.pkcs7.messageToBase64(J);f.b64RValue=a.usWebToolkit.util.encode64(fa);f.curDevice=t;h(f)}catch(C){a.ERROR.Code=C.code,a.ERROR.Message=C.message,112047==C.code&&(a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_MATTCHED_PWD),a.uiUtil().errMsgBox(a.ERROR.Message,a.ERROR.Code),h(k(C.code,C.message))}setTimeout(function(){l.dispose()},10);p=r=g=y=null}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg(f);h(f);l.dispose(!0)}});l.show();return!0}},VerifySignedDataP7:function(d,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d)return null;var b=null;a.reInitialize();if(2&a.ESVS.Mode){b=null;try{b=a.usWebToolkit.pkcs7.messageFromBase64(d),b.verify()}catch(e){if(a.ERROR.Code=e.code,a.ERROR.Message=e.message,c)c(null);else return null}if(b.verifyResult)if(b=b.content,c)c(b);else return b}else if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELECTINFO.curdevice))a.nimservice()&&a.nimservice().VerifySignedData(null,d,function(b,d,e){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),c(null)):c(a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(e)));a.uiUtil().loadingBox(!1,"us-div-list-load")});else{b=null;try{b=a.usWebToolkit.pkcs7.messageFromBase64(d),b.verify()}catch(g){return a.ERROR.Code=g.code,a.ERROR.Message=g.message,null}if(b.verifyResult)return b=b.content}}},SignDataP7Ext:function(d,c,b,e,g,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c&&!b||document.getElementById("us-div-cert-select")||!g)return!1;var h=k();d||(d="DIGITAL_SIGNATURE_P7_EXT");a.reInitialize();var l=a.loadUI("certselect")({type:d,args:{dn:e},onConfirm:function(d,c,e,f,r){4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(r)&&(a.nimservice()?a.nimservice().GetSignDataP7(c,e,b,"utf8",!0,null,!0,function(b,d,m,k,J,L){0!=b?(a.ERROR.Code=h.resultCode=b,a.ERROR.Message=h.resultMessage=d,a.uiUtil().errMsgBox(d,a.ERROR.Code)):(h.signedData=m,h.certIndex=c,h.password=e,h.curDevice=f,h.curDrive=r,h.tokenLabel=L);g(h);a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.dispose()},10)}):(setTimeout(function(){l.dispose(!0)},10),g(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER))))},onCancel:function(){l.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg(h);g(h)}});l.show();return!0}},SelectMediaForCertImporting:function(d,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d)return!1;var b=k();a.reInitialize();Dialog=a.loadUI("storageselect")({type:"CERT_STORAGE",args:null,onConfirm:function(e,g){Dialog.dispose();2===e||3===e?(PWDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(f){PWDialog.dispose();var h=null,h=2===e?"PIN_SECURITY_TOKEN":"PIN_SAVE_TOKEN";PINDialog=a.loadUI("pin")({type:h,args:null,onConfirm:function(a){PINDialog.dispose();b.curDevice=e;b.curDrive=g;b.password=f;b.pin=a;d(b);f=null},onCancel:function(){PINDialog.dispose();f=null;a.uiUtil().getUserCancelErrCodeNMsg();c&&c()}});PINDialog.show()},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();c&&c()}}),PWDialog.show()):(b.curDevice=e,b.curDrive=g,b.password=null,b.pin=null,d(b))},onCancel:function(){Dialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();c&&c()}});Dialog.show()}},ExportCert:function(d,c,b,e,g,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d)return null;var h=k();a.reInitialize();if(-1==d){var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN",args:{dn:null},onConfirm:function(b,d,c,g,r){4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(r)&&(a.nimservice()?a.nimservice().ExportCertEx(g,r,d,e,c,function(a,b,d){h.resultCode=a;h.resultMessage=b;h.pfx=d;f(h)}):f(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)));setTimeout(function(){l.dispose()},10)},onCancel:function(){l.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg(h);f(h)}});l.show()}else 4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(c)&&(a.nimservice()?a.nimservice().ExportCertEx(c,b,d,e,g,function(a,b,d){h.resultCode=a;h.resultMessage=b;h.pfx=d;f(h)}):f(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)))}},ImportCert:function(d,c,b,e,g,f,h){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(1>b||0>e)return-1;a.reInitialize();4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(b)&&(a.nimservice()?a.nimservice().ImportCertEx(b,e,g,f,d,c,function(a,b){h(k(a,b))}):h(k(-1,a.uiUtil().getErrorMessageLang().IDS_MSGBOX_NIM_ERROR_UNLOAD)));return-1}},IssueCert:function(d,c,b){function e(b,d,c,e,g){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(b))if(a.nimservice()){var f=a.loadUI("certprocessing");IssuingDialog=f({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null});IssuingDialog.show();setTimeout(function(){a.nimservice().IssueCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,h,l,c,e,b,d,g,function(b,c){if(0!=b)return a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),IssuingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,!1,function(){m(k(b,c))}),!1;IssuingDialog.dispose(b,0,null,!1,function(){m(k(b))});return!0})},1E3)}else m(k(-1)),c=g=null;else if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(b)){f=a.loadUI("certprocessing");IssuingDialog=f({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null});IssuingDialog.show();f=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");f.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certbackup_"+a.ESVS.Language+".js?version="+a.ver,!1);f.send(null);var n=eval(f.responseText);setTimeout(function(d){if(b==a.CONST.__PF_M_LS.device){if(!a.PFSH)return m(null),!1;try{a.PFSH.LoadAllCerts(document.domain)}catch(e){301E5===e.code?(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain)):(d=window.console||{log:function(){}},D&&(d.log("***** Plugin Free LoadAllCerts error *****"),d.log("e.code : ",e.code,"e.message : ",e.message,"e.detail : ",e.detail)))}try{a.usWebToolkit.usWebCMP.issueCert(h,l,c,document.domain,"",a.PFSH,function(b,d,e){1===b?IssuingDialog.dispose(0,0,null,!0,function(){var b=a.loadUI("confirm")({type:null,args:{msg:n.IDS_CONFIRMBOX_WILL_YOU_BACKUP_CERT},onConfirm:function(){b.dispose();a.uiUtil().isItPortableDevice()?Ea():Da(c);c=null;m(resultObject)},onCancel:function(){b.dispose();c=null;a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});b.show()}):(2===b?(a.ERROR.Code=-1,a.ERROR.Message=d,IssuingDialog.dispose(-1,a.ERROR.Code,a.ERROR.Message,!0,function(){m(k(a.ERROR.Code,a.ERROR.Message))})):(a.ERROR.Code=e.code,a.ERROR.Message=e.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){m(k(a.ERROR.Code,a.ERROR.Message))})),c=null)})}catch(f){a.ERROR.Code=f.code,a.ERROR.Message=f.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!1,function(){m(k(a.ERROR.Code,a.ERROR.Message))}),c=null}}else if(b==a.CONST.__PF_M_SS.device)try{var g=function(b,d,c,e){a.CCPFSH().SaveUserCert(c,d,!0,function(a,b){e(a)})},t=function(b,d,e){1==b?IssuingDialog.dispose(0,0,null,!0,function(){var b=a.loadUI("confirm")({type:null,args:{msg:n.IDS_CONFIRMBOX_WILL_YOU_BACKUP_CERT},onConfirm:function(){b.dispose();a.uiUtil().isItPortableDevice()?Ga():Fa(c);c=null;m(resultObject)},onCancel:function(){b.dispose();c=null;a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});b.show()}):2==b?IssuingDialog.dispose(b,b,d,!0,function(){m(k(b,d))}):3==b&&(b=e.code,IssuingDialog.dispose(b,b,e.message,!0,function(){m(k(e.code,e.message))}))};a.CCPFSH().GetCCStorageHandler(q.EncAlgo,q.HashAlgo,q.PKI,function(b,d){a.usWebToolkit.usWebCMP.issueCert(h,l,c,document.domain,"",d,t,null,null,g)})}catch(p){a.ERROR.Code=p.code,a.ERROR.Message=p.message,IssuingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){m(k(p.code,p.message))}),c=null}},1E3)}}function g(b,d,c){6===b?e(b,d,"",c):(PWDialog=a.loadUI(2===b?"pin":"newpassword")({type:null,args:null,onConfirm:function(a,f){PWDialog.dispose();e(b,d,a,f,c)},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message));PWDialog.dispose()}}),PWDialog.show())}function f(){n=a.loadUI("storageselect")({type:"CERT_STORAGE",args:null,onConfirm:function(b,d,c){n.dispose();!1==a.ESVS.IssueCertInBIOToken&&b==a.CONST.__USFB_M_HSMKEY.device&&-1!=c.indexOf("BIO_")?(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_CANT_ISSUECERT_BIOTOKEN,m(k(a.ERROR.Code,a.ERROR.Message))):3===b?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(a){PINDialog.dispose();g(b,d,a)},onCancel:function(){PINDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}}),PINDialog.show()):g(b,d,"")},onCancel:function(){n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});n.show()}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b)return!1;var h=d,l=c,m=b;a.reInitialize();if(h&&l)f();else{var n=a.loadUI("certissue")({type:null,args:null,onConfirm:function(a,b){h=a;l=b;n.dispose();f()},onCancel:function(){n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();m(k(a.ERROR.Code,a.ERROR.Message))}});n.show()}return!0}},IssueKMCert:function(d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(d&&!document.getElementById("us-div-cert-select")){var c=k();a.reInitialize();var b=a.loadUI("certselect")({type:"CERT_RENEWAL_KMCERT",args:{dn:null},onConfirm:function(e,g,f,h,l,m){b.dispose();if(confirm(g)){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(f))return a.nimservice()?(RenewingDialog=a.loadUI("certprocessing")({type:"CERT_ISSUE",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),a.nimservice().IssueKMCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,l,m,function(b,e){0==b?RenewingDialog.dispose(0,0,null,!0,function(){d(c)}):(a.ERROR.Code=b,a.ERROR.Message=e,RenewingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,!1,function(){d(k(b,e))}))})):d(k(-1)),!1}else a.uiUtil().getUserCancelErrCodeNMsg(),d(k(a.ERROR.Code,a.ERROR.Message))},onCancel:function(){b.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();d(k(a.ERROR.Code,a.ERROR.Message))}});b.show();return!0}},RevocateCert:function(d){function c(d,c,e,l){var m=a.loadUI("certrevoke")({type:null,args:null,onConfirm:function(l){m.dispose();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(e))if(a.nimservice()){var s=a.loadUI("certprocessing");RevokingDialog=s({type:"CERT_REVOCATION",args:null,onConfirm:null,onCancel:null});RevokingDialog.show();a.nimservice().RevokeCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,d,c,l,1,function(a,d){0===a?RevokingDialog.dispose(0,null,null,!0,function(){b(k(0))}):RevokingDialog.dispose(a,a,d,!1,function(){b(k(a,d))})})}else S(),b(k(-1));else if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(e)){s=a.loadUI("certprocessing");RevokingDialog=s({type:"CERT_REVOCATION",args:null,onConfirm:null,onCancel:null});RevokingDialog.show();var p=function(){if(e==a.CONST.__PF_M_LS.device)return a.PFSH;if(e==a.CONST.__PF_M_SS.device)return a.CCPFSH()};setTimeout(function(){G("b64 cert : ",a.PFUC[d].signcert);G("b64 pri : ",a.PFUC[d].signpri);var e=a.usWebToolkit.usWebCMP.revReason.keyCompromise;switch(l){case 1:e=a.usWebToolkit.usWebCMP.revReason.keyCompromise;G("cause : keyCompromise");break;case 3:e=a.usWebToolkit.usWebCMP.revReason.afilationChanged;G("cause : afilationChanged");break;case 5:e=a.usWebToolkit.usWebCMP.revReason.superseded,G("cause : superseded")}try{a.usWebToolkit.usWebCMP.revocation(a.PFUC[d].signcert,a.PFUC[d].signpri,a.PFUC[d].kmcert,c,document.domain,e,p(),function(e,h,l){d=0;c=null;1===e?RevokingDialog.dispose(0,0,null,!0,function(){b(resultObject)}):2===e?(a.ERROR.Code=-1,a.ERROR.Message=h,resultObject.resultCode=a.ERROR.Code,resultObject.resultMessage=a.ERROR.Message,RevokingDialog.dispose(-1,a.ERROR.Code,a.ERROR.Message,!0,function(){b(resultObject)})):(a.ERROR.Code=l.code,a.ERROR.Message=l.message,resultObject.resultCode=a.ERROR.Code,resultObject.resultMessage=a.ERROR.Message,RevokingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){b(resultObject)}))})}catch(h){d=0,c=null,a.ERROR.Code=h.code,a.ERROR.Message=h.message,resultObject.resultCode=a.ERROR.Code,resultObject.resultMessage=a.ERROR.Message,RevokingDialog.dispose(-2,a.ERROR.Code,a.ERROR.Message,!0,function(){b(resultObject)})}},1E3)}},onCancel:function(){S();m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();b(k(a.ERROR.Code,a.ERROR.Message))}});m.show()}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(d&&!document.getElementById("us-div-cert-select")){var b=d;a.reInitialize();var e=a.loadUI("certselect")({type:"CERT_REVOCATION",args:{dn:null},onConfirm:function(d,f,h,l,m){e.dispose();var n=a.loadUI("confirm")({type:null,args:{msg:d},onConfirm:function(){n.dispose();c(f,h,l,m)},onCancel:function(){S();n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();b(k(a.ERROR.Code,a.ERROR.Message))}});n.show()},onCancel:function(){e.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();b(k(a.ERROR.Code,a.ERROR.Message))}});e.show();return!0}},SOECert:function(d){function c(d,c,e,l){4<=a.ESVS.Mode&&(a.nimservice()?(RevokingDialog=a.loadUI("certprocessing")({type:"CERT_SOE",args:null,onConfirm:null,onCancel:null}),RevokingDialog.show(),a.nimservice().RevokeCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,d,c,6,0,function(a,d){0===a?RevokingDialog.dispose(0,null,null,!0,function(){b(k(0))}):RevokingDialog.dispose(a,a,d,!1,function(){b(k(a,d))})})):(S(),b(k(-1))))}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||document.getElementById("us-div-cert-select"))return!1;var b=d;a.reInitialize();var e=a.loadUI("certselect")({type:"CERT_SOE",args:{dn:null},onConfirm:function(d,f,h,l,m){e.dispose();var n=a.loadUI("confirm")({type:null,args:{msg:d},onConfirm:function(){n.dispose();c(f,h,l,m)},onCancel:function(){S();n.dispose();a.uiUtil().getUserCancelErrCodeNMsg();b(k(a.ERROR.Code,a.ERROR.Message))}});n.show()},onCancel:function(){e.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();b(k(a.ERROR.Code,a.ERROR.Message))}});e.show();return!0}},VerifyVID:function(d,c){function b(b,d,c,g,n,s,p){if("PFS"==p)try{var r=window.console||{log:function(){}};D&&(r.log("b64 cert : ",a.PFUC[c].signcert),r.log("b64 pri : ",a.PFUC[c].signpri));var t=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[c].signcert),u=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),w=a.usWebToolkit.pkcs8.verifyVID(u,g,d,t);g=d="";w?e(k(0)):e(null)}catch(y){g=d="",a.ERROR.Code=y.code,a.ERROR.Message=y.message,e(k(y.code,y.message))}else"NIM"==p&&(a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE),a.nimservice().VerifyVID(c,g,b,d,function(b,c){4305E4==b&&(b=14208);a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==b?e(k(0)):(a.ERROR.Code=b,a.ERROR.Message=c,e(k(b,a.uiUtil().getErrorMessageLang().IDS_ERROR_VERIFY_ID)));g=d=""}))}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||document.getElementById("us-div-cert-select"))return!1;k();var e=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.resultCode,a.resultMessage))};a.reInitialize();var g=a.loadUI("certselect")({type:"VID_VERIFICATION",args:{dn:null},onConfirm:function(c,h,l,m,n){g.dispose();if(d)b(0,d,c,h,l,m,n);else{var s=a.loadUI("ssn")({type:null,onConfirm:function(a){b(1,a,c,h,l,m,n);s.dispose()},onCancel:function(){S();s.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});s.show()}},onCancel:function(){g.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}});g.show();return!0}},ManageCert:function(){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{a.reInitialize();var d=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",onConfirm:null,onCancel:function(){d.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg()}});d.show();return!0}},ManageCertByType:function(d,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(4&a.ESVS.Mode){a.reInitialize();var b=null,e=k();c&&(b=c);var g=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",args:{type:d},onConfirm:function(a,d){g.dispose(!0);b&&(e.certAttrs=d,e.driveName=a,b(e))},onCancel:function(){g.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg()}});g.show();return!0}a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_FUC_NOT_SUPPORT)}},ImportCertFromMobileApp:function(d,c,b){function e(){try{try{a.PFSH.SelectStorage(1)}catch(b){G("***** Plugin Free SelectStorage error *****"),G("e.code : ",b.code,"e.message : ",b.message,"e.detail : ",b.detail),alert("error : "+b.detail),h(k(b.code,b.message))}try{a.PFSH.LoadAllCerts(document.domain)}catch(e){301E5===e.code?(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain)):(G("***** Plugin Free LoadAllCerts error *****"),G("e.code : ",e.code,"e.message : ",e.message,"e.detail : ",e.detail),alert("error : "+e.detail),h(k(e.code,e.message)))}var g=a.PFSH.SetP12HexOnMemory(d,c),s=g.aluc[g.index];a.usWebToolkit.x509Certificate.parser(s.signcert,"Base64");var p=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),r=a.certUtil().getIssuerEnName(p);a.PFSH.SaveUserCert(r,s,document.domain,!0);h(f)}catch(t){G("***** Plugin Free MobileImportCert error *****"),G("e.code : ",t.code,"e.message : ",t.message,"e.detail : ",t.detail),alert("error : "+t.detail),h(null)}}function g(){a.CCPFSH().SetP12HexOnMemory(d,c,function(d,c,e){0==d?(d=e.aluc[e.index],a.usWebToolkit.x509Certificate.parser(d.signcert,"Base64"),c=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),c=a.certUtil().getIssuerEnName(c),a.CCPFSH().SaveUserCert(c,d,!0,function(a){h(k(a))})):b(k(d,c))})}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{c&&d||h(null);var f=k();a.PFSH||h(null);var f=k(),h=function(a){1==b.length?b(a):(null==a&&(a=k(-1)),b(a.resultCode,a.resultMessage))};if(0==d.indexOf("MI")){for(d=d.replace(/_/g,"/").replace(/-/g,"+");0!=d.length%4;)d+="=";d=a.usWebToolkit.util.bytesToHex(a.usWebToolkit.util.decode64(d))}a.reInitialize();SSDialog=a.loadUI("storageselect")({type:"CERT_STORAGE",args:null,onConfirm:function(b,d){SSDialog.dispose();b==a.CONST.__PF_M_LS.device?e():b==a.CONST.__PF_M_SS.device&&a.CCPFSH().IsCCPFSHAvailable(function(b){0==b?g():a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(a,b){0==a?g():SSDialog.dispose()})})},onCancel:function(){SSDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});SSDialog.show()}},SetSelectedDevice:function(d){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var c="",b;for(b in a.CONST.medias)if(a.CONST.medias[b].device===d){c=a.CONST.medias[b].name;break}a.ESVS.Media.defaultdevice=c}},NimServiceLoaded:function(){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else return a.nimservice()?a.nimservice().GetIframeLoaded():null},SecureMail:function(d,c,b,e,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if("seed"!=c&&(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_SUPPORT_ALGORITHM,g(k(a.ERROR.Code,a.ERROR.Message))),null==b||""==b||1>b.length)alert(a.uiUtil().getErrorMessageLang().IDS_NOT_ENCRYPTED_DATA);else{a.reInitialize();var f=0,h=a.loadUI("securemail")({type:"SECURE_MAIL",args:{algorithm:c,data:b,decryptData:this.DecryptFileData,mode:d},onConfirm:function(b,c,n,s){if(3<f)null!=document.getElementById("html_encripted")&&(document.getElementById("html_encripted").innerHTML=""),alert(n.IDS_KEY_TYPE[d]+n.IDS_PASSWORD_WRONG),h.dispose();else{var p=document.getElementById("us-input-secure-mail-password");b=s(b,p.value,c,e);if(-10===b)return a.ERROR.Code=-10,a.ERROR.Message=n.IDS_ALGORITHM_ALERT,h.dispose(),g(k(a.ERROR.Code,a.ERROR.Message));if(-11===b){a.ERROR.Code=-11;a.ERROR.Message=n.IDS_KEY_TYPE[d]+n.IDS_PASSWORD_WRONG;if(4<f)return h.dispose(),g(k(a.ERROR.Code,a.ERROR.Message));f+=1;alert(n.IDS_KEY_TYPE[d]+n.IDS_DISCORDANCE_PASSWORD.replace("@",f));p.value=""}else{if(-12===b)return h.dispose(),g(k(-12));if(-13===b){a.ERROR.Code=-13;a.ERROR.Message=n.IDS_KEY_TYPE[d]+n.IDS_PASSWORD_WRONG;if(4<f)return h.dispose(),g(k(-13));f+=1;alert(n.IDS_KEY_TYPE[d]+n.IDS_DISCORDANCE_PASSWORD.replace("@",f));p.value=""}else h.dispose(),n=k(),n.decryptedData=b,g(n)}}},onCancel:function(){h.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});h.show()}},DecryptFileData:function(d,c,b,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var g,f=c;g=0;for(c=c.length;16>c;c++)f+="abcdefghijklmnopqrstuvwxyz".substr(g++,1);g=f+"0123450123456789";c=d.toLowerCase();if("seed"==c)f=g.substring(0,16),g=g.substring(16,32);else if("3des"==c)f=g.substring(0,24),g=g.substring(24,32);else if("rc2"==c)f=g.substring(0,5),g=g.substring(5,13);else if("des"==c)f=g.substring(0,8),g=g.substring(8,16);else return-10;b=a.usWebToolkit.util.decode64(b);"3des"==c&&(d="des");c=null;try{var h=a.usWebToolkit.cipher.algorithms[d].startDecrypting(f,g);h.update(a.usWebToolkit.util.createBuffer(b));if(!1==h.finish())return-11;0==e||null==e?c=h.output.toHex():1==e&&(c=h.output.getBytes())}catch(l){return a.ERROR.Code=l.code,a.ERROR.Message=l.message,-12}if(0==e||null==e)try{c=a.usWebToolkit.unicode.hex2UTF8(c)}catch(k){return-13}return c}},getFileDownload:function(d,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if("function"==typeof na){if(null==c||""==c||1>c.length){var b=document.location.href.split("/");c=b[b.length-1]}b=new Blob([d],{type:"application/otect-stream"});try{na(b,c)}catch(e){alert(a.uiUtil().getErrorMessageLang().IDS_ERROR_BROWSER_NOT_SUPPORT)}}else alert(a.uiUtil().getErrorMessageLang().IDS_ERROR_BROWSER_NOT_SUPPORT)},SignData_noConWithHash:function(d,c,b,e,g,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||document.getElementById("us-div-cert-select")||!f)return!1;k();var h=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.jsonSignedData,a.b64RValue,a.certAttrs))};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:c},onConfirm:function(a,c,f,k,r,t){qa(d,b,a,k,r,t,e,l,g,h)},onCancel:function(){l.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();h(null)}});l.show();return!0}},SignData_noConWithHashEx:function(d,c,b,e,g,f,h){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||!h)return!1;a.reInitialize();if(!1==d){var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:b},onConfirm:function(a,b,d,k,r,t){qa(c,e,a,k,r,t,g,l,f,h)},onCancel:function(){l.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});l.show()}else qa(c,e,a.SELECTINFO.cert,a.SELECTINFO.index,a.SELECTINFO.pw,a.SELECTINFO.curdevice,g,null,f,h)}},SignDataP7NVID_noConWithHash:function(d,c,b,e,g,f,h){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||document.getElementById("us-div-cert-select")||!h)return!1;a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION",args:{dn:c},onConfirm:function(c,e,s,p,r,t){var u={};if("undefined"!==typeof c&&"undefined"!==typeof e)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))if(a.nimservice()){s=0;p=[];if(d)for(var w in d)p[s]=d[w],s++;a.nimservice().GetSignDataP7WithHash(c,e,b,p,"utf8",!1,null,!0,f,function(b,f,p,s,w,q){if(0!=b)a.ERROR.Code=b,a.ERROR.Message=f,a.uiUtil().errMsgBox(f,a.ERROR.Code),h(k(b,f));else{b=0;if("object"==typeof p)for(var oa in d)u[oa]=p[b++];else u=p;null==r&&a.CONST.__USFB_M_MOBILETOKEN.device==t&&(r=a.certUtil().getTheCertAttributes(w,"Base64"));ea(g,c,e,u,r,t,q,h)}e=g="";a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.dispose()},10)})}else h(null),setTimeout(function(){l.dispose(!0)},10);else setTimeout(function(){l.dispose(!0)},10);else h(null),setTimeout(function(){l.dispose(!0)},10)},onCancel:function(){l.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});l.show();return!0}},VerifySignData_noConWithHash:function(d,c,b,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||!c)return!1;a.reInitialize();b=null;try{var g=a.usWebToolkit.util.decode64(d);b=a.usWebToolkit.pkcs7.messageFromBase64(c);b.verifyWithHash(g);!0==b.verifyResult?e(0):e(-1)}catch(f){a.ERROR.Code=f.code,a.ERROR.Message=f.message,e(f.code)}}},SignMultiDataP7:function(d,c,b,e,g,f){if(!d&&!c||!f||document.getElementById("us-div-cert-select"))return!1;var h=k(),l=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.jsonSignedData,a.b64RValue,a.certAttrs,a.curDevice))};a.reInitialize();var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:b},onConfirm:function(b,f,p,r,t,u){var w={},y=p;if("undefined"!==typeof r&&"undefined"!==typeof t)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(u))if(a.nimservice()){b=0;f=[];if(d)if("object"==typeof d)for(var J in d)f[b++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d[J]));else f=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d));else if("object"==typeof jsonPlainData)for(J in jsonPlainData)f[b++]=c[J];else f=c;a.nimservice().GetSignDataP7(r,t,f,"utf8",e,g,!1,function(b,e,f,g,n,p){if(0!=b)a.ERROR.Code=b,a.ERROR.Message=e,l(k(a.ERROR.Code,a.ERROR.Message));else{b=0;e=d;c&&(e=c);if("object"==typeof f)for(var s in e)w[s]=f[b++];else w=f;null==y&&a.CONST.__USFB_M_MOBILETOKEN.device==u&&(y=a.certUtil().getTheCertAttributes(n,"Base64"));h.jsonSignedData=w;h.b64RValue=g;h.certAttrs=y;h.curDevice=u;h.tokenLabel=p;l(h)}r=t=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");m.dispose()})}else l(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)),m.dispose(!0);else m.dispose(),r=t=pri=null},onCancel:function(){m.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});m.show();return!0},SignMultiDataP7NVerifyVID:function(d,c,b,e,g,f){if(!d&&!c||!f||document.getElementById("us-div-cert-select"))return!1;k();var h=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.signedData,a.certAttrs,a.curDevice))};a.reInitialize();var l=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:b},onConfirm:function(b,f,s,p,r,t){var u={},w=s;if("undefined"!==typeof p&&"undefined"!==typeof r)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(t))if(a.nimservice()){b=0;f=[];if(d)if("object"==typeof d)for(var y in d)f[b++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d[y]));else f=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d));else if("object"==typeof d)for(y in jsonPlainData)f[b++]=c[y];else f=c;a.nimservice().GetSignDataP7(p,r,f,"utf8",e,null,!0,function(b,e,f,n,m,s){if(0!=b)a.ERROR.Code=b,a.ERROR.Message=e,h(k(a.ERROR.Code,a.ERROR.Message));else{b=0;e=d;c&&(e=c);if("object"==typeof f)for(var y in e)u[y]=f[b++];else u=f;null==w&&a.CONST.__USFB_M_MOBILETOKEN.device==t&&(w=a.certUtil().getTheCertAttributes(m,"Base64"));ea(g,p,r,u,w,t,s,h)}p=r=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");l.dispose()})}else h(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)),l.dispose(!0);else p=r=pri=null,l.dispose(!0);else h(null),l.dispose(!0)},onCancel:function(){l.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}});l.show();return!0},Base64Encoding:function(d){d=a.usWebToolkit.util.encodeUtf8(d);return(d=a.usWebToolkit.util.encode64(d))?d:null},Base64Decoding:function(d){d=a.usWebToolkit.util.decode64(d);return(d=a.usWebToolkit.util.decodeUtf8(d))?d:null},SignPersonInfoReqP7:function(d,c,b,e,g){if(!d||!c||4>c.length||!g||document.getElementById("us-div-cert-select"))return!1;var f=k();a.reInitialize();e=null;try{e=a.usWebToolkit.util.encodeUtf8(d)}catch(h){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT UTIL ERROR] during encoding utf8 character set.\ndetail : "+h;g(k(a.ERROR.Code,a.ERROR.Message));return}d=null;try{d=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.UTF8,!1,e)}catch(l){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating useragreement asn.1 struct.\ndetail : "+l;g(k(a.ERROR.Code,a.ERROR.Message));return}e=0;"1"===c.charAt(0)&&(e|=128);"1"===c.charAt(1)&&(e|=64);"1"===c.charAt(2)&&(e|=32);"1"===c.charAt(3)&&(e|=16);c=String.fromCharCode(4);var m=String.fromCharCode(e);e=null;try{e=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.BITSTRING,!1,c+m)}catch(n){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating useragree asn.1 struct.\ndetail : "+n;g(k(a.ERROR.Code,a.ERROR.Message));return}c=null;try{c=a.usWebToolkit.asn1.create(a.usWebToolkit.asn1.Class.UNIVERSAL,a.usWebToolkit.asn1.Type.SEQUENCE,!0,[d,e])}catch(s){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during creating personinforeq asn.1 struct.\ndetail : "+s;g(k(a.ERROR.Code,a.ERROR.Message));return}d=null;try{d=a.usWebToolkit.asn1.toDer(c)}catch(p){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT ASN.1 ERROR] during converting object to der format.\ndetail : "+p;g(k(a.ERROR.Code,a.ERROR.Message));return}var r=null;try{r=a.usWebToolkit.util.encode64(d.getBytes())}catch(t){a.ERROR.Code=1E7;a.ERROR.Message="[TOOLKIT UTIL ERROR] during encoding base64 string.\ndetail : "+t;g(k(a.ERROR.Code,a.ERROR.Message));return}var u=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:b},onConfirm:function(b,d,c,e,h,l){"undefined"!==typeof e&&"undefined"!==typeof h&&4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(l)&&(a.nimservice()?a.nimservice().GetSignDataP7(e,h,r,"utf8",!0,null,!1,function(b,d,e){0!=b?(a.ERROR.Code=b,a.ERROR.Message=d,g(k(a.ERROR.Code,a.ERROR.Message))):(f.signedData=e,f.certAttrs=c,g(f));a.uiUtil().loadingBox(!1,"us-div-list-load");u.dispose()}):(g(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)),u.dispose(!0)))},onCancel:function(){u.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});u.show();return!0},SignMultiDataP1:function(d,c,b){if(!d||!b||document.getElementById("us-div-cert-select"))return!1;var e=k(),g=function(a){1==b.length?b(a):(null==a&&(a=k(-1)),b(a.jsonSignedData,a.theCert,a.theDN))};a.reInitialize();var f=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:c},onConfirm:function(b,c,m,n,s,p){var r={};if("undefined"!==typeof n&&"undefined"!==typeof s)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(p))if(a.nimservice()){m=0;var t=[];if(d)if("object"==typeof d)for(var u in d)t[m++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d[u]));else t=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d));a.nimservice().GetSignDataP1(n,s,t,null,!1,function(n,t,m,u,s,q){if(0!=n)a.ERROR.Code=n,a.ERROR.Message=t,a.uiUtil().errMsgBox(t,a.ERROR.Code),g(k(n,t));else{n=0;if("object"==typeof m)for(var $ in d)r[$]=m[n++];else r=m;null==b&&a.CONST.__USFB_M_MOBILETOKEN.device==p&&(m=a.certUtil().getTheCertAttributes(s,"Base64"),b=s,c=m.subjectName);e.jsonSignedData=r;e.theCert=b;e.theDN=c;e.tokenLabel=q;g(e)}a.uiUtil().loadingBox(!1,"us-div-list-load");f.dispose()})}else g(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)),f.dispose(!0);else n=s=cert=pri=null,f.dispose()},onCancel:function(){f.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});f.show();return!0},VerifySignedDataP7ExcludedContent:function(d,c,b){if(!c)return null;a.reInitialize();if(4&a.ESVS.Mode)a.nimservice()&&(d=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)),a.nimservice().VerifySignedData(d,c,function(d,c,e){0!=d&&(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage());b(d);a.uiUtil().loadingBox(!1,"us-div-list-load")}));else{var e=null;try{e=a.usWebToolkit.pkcs7.messageFromBase64(c),e.verify(void 0,a.usWebToolkit.util.encodeUtf8(d))}catch(g){a.ERROR.Code=g.code;a.ERROR.Message=g.message;_rvCallback(g.code);return}if(!0==e.verifyResult)return _rvCallback(0),0;_rvCallback(-1);return-1}},SignDataP7AndVerifyVID:function(d,c,b,e){if(!d&&!plainB64Text||!e||document.getElementById("us-div-cert-select"))return!1;ga();var g=k(),f=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.signedData,a.certAttrs,a.curDevice))};a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION",args:{dn:c},onConfirm:function(c,e,n,s,p,r){var t=p;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(r))n=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)),a.nimservice().GetSignDataP7(c,e,n,"utf8",!0,null,!0,function(d,g,n,p,u,w){0!=d?(a.ERROR.Code=d,a.ERROR.Message=g,f(k(d,g))):(null==t&&a.CONST.__USFB_M_MOBILETOKEN.device==r?(t=a.certUtil().getTheCertAttributes(u,"Base64"),B(c,e,r,u,t)):B(c,e,r,s,t),ea(b,c,e,n,t,r,w,f));e=b="";a.uiUtil().loadingBox(!1,"us-div-list-load");h.dispose()});else if(r==a.CONST.__PF_M_CLOUDSIGN.device){a.uiUtil().loadingBox(!0,"us-div-list-load",1);var u=function(b,c,r,n,p,l){reqVerifyVID(b,c,function(c,n,u){0==c?u?reqGetCertR(b,function(c,n,u){0!=c&&(g.resultCode=c,g.resultMessage=n,setTimeout(function(){h.dispose()},10),l(k(c,n)));reqGenSignNonVerifyPin(b,a.usWebToolkit.util.encodeUtf8(d),"Y",function(c,d,n){0!=c?(a.ERROR.Code=c,a.ERROR.Message=d,f(k(c,d))):(B(b,e,p,s,t),c=a.usWebToolkit.util.decode64(n),d=a.usWebToolkit.pki.certificateFromBase64(s),n=crosscert.pkcs7.createSignedData(),n.signWithP1(c,r,d,null,null),g.certAttrs=t,g.signedData=a.usWebToolkit.pkcs7.messageToBase64(n),g.curDevice=p,g.b64RValue=u,f(g));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){h.dispose()},10)})}):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_ERROR_VERIFICATION,a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){h.dispose()},10),l(k(a.ERROR.Code,a.ERROR.Message))):(a.ERROR.Code=c,a.ERROR.Message=n,a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){h.dispose()},10),l(k(c,n)))})};if(b)u(c,b,d,p,r,f);else{var w=a.loadUI("ssn")({type:null,onConfirm:function(a){u(c,a,d,p,r,f);w.dispose()},onCancel:function(){f(k(-1,a.uiUtil().getUserCancelErrCodeNMsg()));w.dispose()}});w.show()}}else{try{var y=window.console||{log:function(){}};D&&(y.log("b64 cert : ",a.PFUC[c].signcert),y.log("b64 pri : ",a.PFUC[c].signpri));s=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[c].signcert);var J=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),L=a.usWebToolkit.pkcs7.createSignedData();L.sign(d,s,J,e,null,null);var q=a.usWebToolkit.pkcs7.messageToBase64(L);ea(b,c,e,q,p,r,"",f);h.dispose()}catch(C){a.ERROR.Code=C.code,a.ERROR.Message=C.message,a.uiUtil().errMsgBox(C.message,a.ERROR.Code),f(k(C.code,C.message))}setTimeout(function(){h.dispose()},10);c=e=s=J=null}},onCancel:function(){h.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}});h.show();return!0},MakeHash:function(d,c,b,e){function g(b,d){if(null==b||0>=b.length)d(0,"","");else if(4&a.ESVS.Mode)if(a.nimservice())if("FilePath"===m){var e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b));a.nimservice().MakeHash(1,e,c,function(b,c,e){0==b?d(b,c,e):(a.ERROR.Code=b,a.ERROR.Message=c,d(b,c,""))})}else e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().MakeHash(0,e,c,function(b,c,e){0==b?d(b,c,e):(a.ERROR.Code=b,a.ERROR.Message=c,d(b,c,""))});else a.ERROR.Code=-1,d(-1,"","");else if("FilePath"!==m)try{var e=a.usWebToolkit.util.encodeUtf8(h),f=crosscert.md.algorithms[l.toLowerCase()].create();f.start();f.update(e);d(0,"",a.usWebToolkit.util.encode64(f.digest().getBytes()))}catch(g){a.ERROR.Code=g.code,a.ERROR.Message=g.message,d(g.code,g.message,"")}}function f(a){g(a,function(a,b,c){0!=a?p(k(a,b)):(n[r]=c,r++,h.length==r?(s.hashValue=n,p(s)):f(h[r]))})}if(!d)return null;var h=d,l=c,m=b,n=[];l&&"undefined"!==typeof l||(l="SHA256");var s=k(),p=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.hashValue))};"string"===typeof d&&(h=[d]);var r=0;f(h[r])},EncryptData:function(d,c,b,e,g){function f(b,c,d,e,f,g,l,m){4&a.ESVS.Mode&&(a.nimservice()?(f=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(f)),a.nimservice().EnvelopData(b,c,d,e,f,!1,function(b,c,d){0==b?(h.encryptedData=d,l(h)):(a.ERROR.Code=b,a.uiUtil().errMsgBox(c,a.ERROR.Code),l(k(b,c)));m.dispose()})):(a.ERROR.Code=-1,l(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)),m&&m.dispose(!0)))}if(!d||!g||document.getElementById("us-div-cert-select"))return!1;var h=k(),l=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.resultCode,a.encryptedData))};a.reInitialize();if(b&&0<b.length)f("kmcert",-1,"",b,d,null,l,null);else{var m=a.loadUI("certselect")({type:"ENCRYPT_P7",args:{dn:c},onConfirm:function(a,c,e){f("kmcert",a,c,b,d,e,l,m)},onCancel:function(){m.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});m.show()}return!0},EncryptDatabySymm:function(d,c){if(!d)return null;var b=k();if(4&a.ESVS.Mode)if(a.nimservice()){var e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d));a.nimservice().EncryptData(e,function(d,e,h){0==d?(b.encryptedData=h,c(b)):(a.ERROR.Code=d,c(k(d,e)))})}else a.ERROR.Code=-1,c(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER))},EncryptDataWithSymmKey:function(d,c,b,e,g){if(!b||!c)return null;var f=k();if(4&a.ESVS.Mode)a.nimservice()?(b=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b)),a.nimservice().EncryptDataWithSymmKey(d,c,b,e,function(b,c,d){0==b?(f.encryptedData=d,g(f)):(a.ERROR.Code=b,g(k(b,c)))})):(a.ERROR.Code=-1,g(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)));else try{var h=crosscert.cipher.algorithms[symmAlgo].startEncrypting(key,iv);h.update(crosscert.util.createBuffer(b));h.finish();f.encryptedData=a.usWebToolkit.util.encode64(h.output.getBytes());g(f)}catch(l){a.ERROR.Code=l.code,a.ERROR.Message=l.message,g(k(a.ERROR.Code,a.ERROR.Message))}},DecryptDataWithSymmKey:function(d,c,b,e,g,f){if(!b||!c)return null;var h=k(),l=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.decryptedData))};if(4&a.ESVS.Mode)a.nimservice()?a.nimservice().DecryptDataWithSymmKey(d,c,b,e,g,function(b,c,d){0==b?("utf-8"==g.toLowerCase()?h.decryptedData=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(d)):h.decryptedData=a.usWebToolkit.util.decode64(d),l(h)):(a.ERROR.Code=b,l(k(b,c)))}):(a.ERROR.Code=-1,l(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)));else try{var m=a.usWebToolkit.util.decode64(b),n=crosscert.cipher.algorithms[symmAlgo].startDecrypting(key,iv);n.update(crosscert.util.createBuffer(m));n.finish();h.decryptedData=n.output.getBytes();l(h)}catch(s){a.ERROR.Code=s.code,a.ERROR.Message=s.message,l(k(a.ERROR.Code,a.ERROR.Message))}},SetConfigInfo:function(d){"undefined"!=typeof d.Mode&&(a.ESVS.Mode=q.Mode=R=d.Mode);"undefined"!=typeof d.SecureKeyboardType&&(a.ESVS.SecureKeyboardType=q.SecureKeyboardType=W=d.SecureKeyboardType,"ahnlab"==W&&(eval(H({eval:!1,intergrity:!1,name:"astx2.min.js",url:"unisignweb/framework/keyboard/astx2.min.js"})),eval(H({eval:!1,intergrity:!1,name:"astx2_custom.js",url:"unisignweb/framework/keyboard/astx2_custom.js"}))));"undefined"!=typeof d.Language&&("ko-kr"==d.Language.toLowerCase()?a.ESVS.Language=q.Language=aa="ko_kr":a.ESVS.Language=q.Language=aa="en_us",__FileUtil=__ForgeryUtil=__CertUtil=__UIUtil=null,__UIUtil=new E.UI,__CertUtil=new E.CERT,__ForgeryUtil=new E.FORGERY,__FileUtil=new E.FILE);if("undefined"!=typeof d.Media){var c=d.Media;c.list=c.list?c.list.toLowerCase():null;c.defaultdevice?(c.defaultdevice=c.defaultdevice.toLowerCase(),null!=c.list&&(c.defaultdevice=0>c.list.indexOf(c.defaultdevice)?c.list.split("|")[0]:c.defaultdevice)):c.defaultdevice=null;if(void 0==c.defaultdevice||null==c.defaultdevice)c.defaultdevice=2==R?"webstorage":"harddisk";a.ESVS.Media=q.Media=c}"undefined"!=typeof d.TabIndex&&(a.ESVS.TabIndex=q.TabIndex=ca=d.TabIndex);"undefined"!=typeof d.LimitNumOfTimesToTryToInputPW&&(a.ESVS.LimitNumOfTimesToTryToInputPW=q.LimitNumOfTimesToTryToInputPW=ba=d.LimitNumOfTimesToTryToInputPW);"undefined"!=typeof d.Policy&&(a.ESVS.Policy=q.Policy=ia=d.Policy);"undefined"!=typeof d.ShowExpiredCerts&&(a.ESVS.ShowExpiredCerts=q.ShowExpiredCerts=ja=d.ShowExpiredCerts);"undefined"!=typeof d.LimitMinNewPWLen&&(a.ESVS.LimitMinNewPWLen=q.LimitMinNewPWLen=M=d.LimitMinNewPWLen);"undefined"!=typeof d.LimitMaxNewPWLen&&(a.ESVS.LimitMaxNewPWLen=q.LimitMaxNewPWLen=N=d.LimitMaxNewPWLen);"undefined"!=typeof d.LimitNewPWPattern&&(a.ESVS.LimitNewPWPattern=q.LimitNewPWPattern=Y=d.LimitNewPWPattern);"undefined"!=typeof d.CertRequestPageEnable&&(a.ESVS.CertRequestPageEnable=q.CertRequestPageEnable=ka=d.CertRequestPageEnable)},SignFileP7:function(d,c,b,e,g,f){if(document.getElementById("us-div-cert-select")||!f||!d||0<b&&!e)return!1;var h=k(),l=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.signedData,a.curDevice))};a.reInitialize();var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_FILE",args:{dn:c},onConfirm:function(c,f,p,r,t,u){4&a.ESVS.Mode&&(a.nimservice()?(p=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)),r="",null!=e&&(r=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(e))),p=[p,b,r,1],a.nimservice().GetSignFileP7(c,f,p,g,null,function(d,e,g,r,p,t){0!=d?(a.ERROR.Code=d,a.ERROR.Message=e,l(k(a.ERROR.Code,a.ERROR.Message))):(h.curDevice=u,h.tokenLabel=t,h.signedData=0<b?a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(g)):g,l(h));c=f=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");m.dispose()})):(l(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)),m.dispose(!0)))},onCancel:function(){m.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});m.show();return!0},SignMultiFileP7:function(d,c,b,e,g,f){if(!d||!f||document.getElementById("us-div-cert-select"))return!1;var h=k(),l=function(a){1==f.length?f(a):(null==a&&(a=k(-1)),f(a.resultCode,a.jsonSignedData,a.curDevice))};a.reInitialize();var m=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_FILE",args:{dn:c},onConfirm:function(c,f,p,r,t,u){var w={};if(4&a.ESVS.Mode)if(a.nimservice()){p=0;r=[];t=[];if(d)if("object"==typeof d)for(var y in d)r[p++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d[y]));else r=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d));if(e)if(p=0,"object"==typeof d)for(y in e)t[p++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(e[y]));else t=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(e));y=[r,b,t,1];a.nimservice().GetSignFileP7(c,f,y,g,null,function(e,g,r,p,t,y){if(0!=e)a.ERROR.Code=e,a.ERROR.Message=g,l(k(a.ERROR.Code,a.ERROR.Message));else{e=0;if(1==b)if("object"==typeof r)for(var q in d)w[q]=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(r[e++]));else w=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(r));else if("object"==typeof r)for(q in d)w[q]=r[e++];else w=r;h.curDevice=u;h.jsonSignedData=w;h.tokenLabel=y;l(h)}c=f=cert=pri=null;a.uiUtil().loadingBox(!1,"us-div-list-load");m.dispose()})}else l(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)),m.dispose(!0);else l(null),m.dispose(!0)},onCancel:function(){m.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();l(k(a.ERROR.Code,a.ERROR.Message))}});m.show();return!0},SetUBIKeyEnvInfo:function(d,c,b,e){a.ubiKeyEnv={version:d,siteInfo:c,securityInfo:b,downloadURL:e}},SetMobileTokenEnvInfo:function(d,c,b,e,g,f){var h=f;if("undefined"!==typeof f||null==f||0>=f.length)h="http://download.smartcert.kr";a.usimEnv={sitecode:d,modecode:c,siteURL:b,serviceIP:e,servicePort:g,downloadURL:h}},DecryptData:function(d,c){function b(b,c,f,n){4&a.ESVS.Mode&&(a.nimservice()?a.nimservice().DeEnvelopData("kmcert",b,c,d,function(b,c,d){0==b?(e.decryptedData=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(d)),g(e)):(a.ERROR.Code=b,a.uiUtil().errMsgBox(c,a.ERROR.Code),g(k(b,c)));n.dispose()}):(a.ERROR.Code=-1,g(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)),n.dispose()))}if(!d||!c||document.getElementById("us-div-cert-select"))return!1;var e=k(),g=function(a){1==c.length?c(a):(null==a&&(a=k(-1)),c(a.resultCode,a.decryptedData))};a.reInitialize();var f=a.loadUI("certselect")({type:"ENCRYPT_P7",args:{dn:null},onConfirm:function(a,c,d){b(a,c,d,f)},onCancel:function(){f.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});f.show();return!0},VerifyKeyPair:function(d){function c(b,c,f,n,s,p,r){4&a.ESVS.Mode&&a.nimservice().GetSignDataP7(f,n,e,"utf8",!0,null,!0,function(b,c,e,f,h,l){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,g.errmsg=c,p&&p.dispose(!0),d(k(a.ERROR.Code,g))):a.nimservice().VerifySignedData(null,e,function(b,c,d){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),g.signcert=a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+a.uiUtil().getErrorMessageLang().IDS_VERIFY_SIGN+")"):g.signcert=a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_SIGN+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_OK;r(0)})})}function b(b,c,f,n,s,p){4&a.ESVS.Mode&&a.nimservice().EnvelopData("kmcert",f,n,null,e,!0,function(b,c,e){0==b?a.nimservice().DeEnvelopData("kmcert",f,n,e,function(b,c,e){g.kmcert=0==b?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_OK:-2==b?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_NONE:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+c+")";p&&p.dispose();d(k(0,g))}):(g.kmcert=-2==b?a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_NONE:a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_KM+" : "+a.uiUtil().getErrorMessageLang().IDS_VERIFYKEY_FAIL+"("+c+")",p&&p.dispose(),d(k(0,g)))})}if(!d)return!1;k();var e="1234",g={errmsg:"",signcert:"",kmcert:""};a.reInitialize();var f=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:null},onConfirm:function(a,d,e,g,k,p){c(a,e,g,k,p,f,function(c){b(a,e,g,k,p,f)})},onCancel:function(){f.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();g.errmsg=a.ERROR.Message;d(k(a.ERROR.Code,g))}});f.show();return!0},VerifyP7SignedFileWithFile:function(d,c,b,e,g,f){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!b||0<e&&!g)return null;a.reInitialize();if(4&a.ESVS.Mode&&a.nimservice()){var h=null;null!=d&&(h=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)));d=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(b));g=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(g));a.nimservice().VerifySignedFile(h,c,d,e,g,function(b,c,d,g){0!=b?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),f(b,null)):0<e?(c=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(d)),f(b,c,g)):f(b,d,g);a.uiUtil().loadingBox(!1,"us-div-list-load")})}}},VerifyP7SignedDataWithFile:function(d,c,b,e,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c||1==b&&!e)return null;a.reInitialize();if(4&a.ESVS.Mode&&a.nimservice()){var f=null;null!=d&&(f=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)));d=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(e));a.nimservice().VerifySignedFile(f,0,c,b,d,function(c,d,e,f){0!=c?(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),g(c,null)):1==b?(d=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(e)),g(c,d,f)):g(c,e,f);a.uiUtil().loadingBox(!1,"us-div-list-load")})}}},RenewCertNSignedSubjectDn:function(d,c,b,e,g,f,h){function l(b,c,d,h,p,l,m,q,C){b=!0;d!=a.CONST.__USFB_M_MOBILETOKEN.device&&(b=confirm(c));if(b){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(d))return a.nimservice()?(c=a.loadUI("certprocessing"),RenewingDialog=c({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null}),RenewingDialog.show(),a.nimservice().RenewCertificate(a.ESVS.CMPIP,a.ESVS.CMPPort,p,l,m,q,e,function(b,c,r){s.resultCode=b;s.resultMessage=c;s.curDevice=d;s.curDrive=h;d==a.CONST.__USFB_M_MOBILETOKEN.device&&r&&(C=a.certUtil().getTheCertAttributes(r,"Base64"));if(0==b)RenewingDialog.dispose(0,0,null,!1,function(){s.certAttrs=C;n(s)}),a.uiUtil().loadingBox(!1,"us-div-list-load");else if(a.ERROR.Code=b,a.ERROR.Message=c,a.uiUtil().loadingBox(!1,"us-div-list-load"),!0==e&&null!=C&&C.subjectName){r=1==g?"utf8":"euckr";var k=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(C.subjectName));a.nimservice().GetSignDataP7(p,q,k,r,!0,null,!1,function(e,g,h,r,k,p){RenewingDialog.dispose(b,a.ERROR.Code,a.ERROR.Message,f,function(){0==e?(null==C&&a.CONST.__USFB_M_MOBILETOKEN.device==d&&(C=a.certUtil().getTheCertAttributes(k,"Base64")),s.certAttrs=C,s.signedData=h):(s.resultMessage=c,s.certAttrs=C);n(s);a.uiUtil().loadingBox(!1,"us-div-list-load")})})}else S(),a.uiUtil().loadingBox(!1,"us-div-list-load"),RenewingDialog.dispose(b,a.ERROR.Code,c?c:a.ERROR.Message,!1,function(){s.resultCode=b;s.resultMessage=c;s.certAttrs=C;s.curDevice=d;s.curDrive=h;n(s)})})):(S(),n(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER))),!1;if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(d)){c=a.loadUI("certprocessing");RenewingDialog=c({type:"CERT_RENEWAL",args:null,onConfirm:null,onCancel:null});RenewingDialog.show();l=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");l.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certbackup_"+a.ESVS.Language+".js?version="+a.ver,!1);l.send(null);var $=eval(l.responseText);l=function(b,c,e){1==b?RenewingDialog.dispose(0,0,null,!0,function(){var b=a.loadUI("confirm")({type:null,args:{msg:$.IDS_CONFIRMBOX_WILL_YOU_BACKUP_CERT},onConfirm:function(){b.dispose();a.CONST.__PF_M_LS.device===d?a.uiUtil().isItPortableDevice()?Ea():Da(pwd):a.CONST.__PF_M_SS.device===d&&(a.uiUtil().isItPortableDevice()?Ga():Fa(pwd));pw=null;n(resultObejct)},onCancel:function(){b.dispose();pw=null;a.uiUtil().getUserCancelErrCodeNMsg();n(k(a.ERROR.Code,a.ERROR.Message))}});b.show()}):2==b?RenewingDialog.dispose(b,b,c,!0,function(){n(k(b,c))}):3==b&&(b=e.code,RenewingDialog.dispose(b,b,e.message,!0,function(){n(k(b,e.message))}))};a.CONST.__PF_M_LS.device===d?a.usWebToolkit.usWebCMP.update(a.PFUC[p].signcert,a.PFUC[p].signpri,a.PFUC[p].kmcert,a.PFUC[p].kmpri,pwd,document.domain,"",a.PFSH,l):a.CONST.__PF_M_SS.device===d&&a.usWebToolkit.usWebCMP.update(a.PFUC[p].signcert,a.PFUC[p].signpri,a.PFUC[p].kmcert,a.PFUC[p].kmpri,pwd,document.domain,"",a.CCPFSH,l,null,null,null,function(b,c,d,e){a.CCPFSH().SaveUserCert(d,c,!1,function(a,b){e(a)})})}}else S()}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else if(h&&!document.getElementById("us-div-cert-select")){var m=d;d&&a.uiUtil().isValidDevice(d)||(b=null,m=c=-1);var n=h,s=k();a.reInitialize();var p=a.loadUI("certselect")({type:"CERT_RENEWAL_SIGN",args:{device:m,drive:c,dn:b},onConfirm:function(b,c,d,e,f,g,h){p.dispose();a.CONST.__USFB_M_HSMKEY.device!=d&&a.CONST.__USFB_M_SMARTCARD.device!=d&&a.CONST.__USFB_M_MOBILETOKEN.device!=d?a.uiUtil().CheckPwdPattern(g,function(p){!0==p?l(b,c,d,e,f,"","",g,h):(PWDialog=a.loadUI("newpassword")({type:null,args:{renew:!0,pw:g},onConfirm:function(a,k){PWDialog.dispose();l(b,c,d,e,f,a,k,g,h)},onCancel:function(){S();PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();n(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}):l(b,c,d,e,f,"","",g,h)},onCancel:function(){p.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();n(k(a.ERROR.Code,a.ERROR.Message))}});p.show();return!0}},SetOptions:function(d,c){a.options[d]=c},MakeTaxXMLDSIG:function(d,c,b,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||!e||document.getElementById("us-div-cert-select"))return!1;var g=d;"string"===typeof d&&(g=[d]);var f=k();a.reInitialize();var h=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_XML",args:{dn:c},onConfirm:function(c,d,n,s,p,r){var t={};if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(p))if(a.nimservice()){var u=0;c=[];for(var w in g)c[u++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(g[w]));a.nimservice().MakeXMLDSIG(n,s,c,b,0,function(b,c,r,l,n,s){if(0!=b)a.ERROR.Code=b,a.ERROR.Message=c,e(k(a.ERROR.Code,a.ERROR.Message));else{u=0;if("object"==typeof r)for(var w in g)t[w]=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(r[u++]));else t=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(r));a.CONST.__USFB_M_MOBILETOKEN.device==p&&(d=a.certUtil().getTheCertAttributes(n,"Base64"));f.signedData=t;f.b64RValue=l;f.certAttrs=d;f.tokenLabel=s;e(f)}a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){h.dispose()},10)})}else e(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)),setTimeout(function(){h.dispose(!0)},10)},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message));h.dispose(!0)}});h.show();return!0}},MakeTaxXMLDSIGNonEnveloped:function(d,c,b,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||!e||document.getElementById("us-div-cert-select"))return!1;var g=d;"string"===typeof d&&(g=[d]);var f=k();a.reInitialize();var h=function(){var b=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7_XML",args:{dn:null},onConfirm:function(c,d,h,l,n,m){var q={};if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(n))if(a.nimservice()){var L=0;c=[];for(var fa in g)c[L++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(g[fa]));a.nimservice().MakeXMLDSIG(h,l,c,"",1,function(c,h,p,l,t,m){a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){b.dispose()},10);if(0!=c)a.ERROR.Code=c,a.ERROR.Message=h,e(k(a.ERROR.Code,a.ERROR.Message));else{L=0;if("object"==typeof p)for(var u in g)q[u]=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(p[L++]));else q=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(p));a.CONST.__USFB_M_MOBILETOKEN.device==n&&(d=a.certUtil().getTheCertAttributes(t,"Base64"));f.signedData=q;f.certAttrs=d;f.tokenLabel=m;e(f)}})}else e(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER)),setTimeout(function(){b.dispose(!0)},10)},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message));b.dispose(!0)}});b.show()};if(""==c||null==c)h();else{d=function(b,c,d){a.nimservice().GetAllUserCertListNum(b,c,"",function(c,e,f){nCertsCnt=f;if(0==c)0<nCertsCnt?a.nimservice().GetAllUserCert(f,function(b,c){0==b?a.certsList={list:c}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-cert-list-load");d(b)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-cert-list-load"),d(0));else{if(b==a.CONST.__USFB_M_MOBILE.device&&61E6==c)return a.ERROR.Code=11003,a.ERROR.Message=__lang.IDS_MSGBOX_NOT_INSTALL_MOBILE,document.getElementById("us-cls-btn").click(),"firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),a.certsList=null,d(c),!1;-1!==nCertsCnt&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());d(c);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-cert-list-load")}})};var l=function(b,c){var d={};if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELECTINFO.curdevice))if(a.nimservice()){var h=0,l=[],n;for(n in g)l[h++]=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(g[n]));a.nimservice().MakeXMLDSIG(b,c,l,"",1,function(b,c,l,p,n,m){if(0!=b)a.ERROR.Code=b,a.ERROR.Message=c,e(k(a.ERROR.Code,a.ERROR.Message));else{h=0;if("object"==typeof l)for(var u in g)d[u]=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(l[h++]));else d=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(l));b=a.SELECTINFO.certattrs;a.CONST.__USFB_M_MOBILETOKEN.device==a.SELECTINFO.curdevice&&(b=a.certUtil().getTheCertAttributes(n,"Base64"));f.signedData=d;f.certAttrs=b;f.tokenLabel=m;e(f)}})}else e(k(-1,a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER))},m=function(){for(var b=-1,d=0,e=0;e<a.certsList.list.length;e++)if(a.usWebToolkit.x509Certificate.parser(a.certsList.list[e].cert,"Base64"),c==a.usWebToolkit.x509Certificate.getSubjectName())if(0!=a.SELECTINFO.index){if(a.SELECTINFO.index==a.certsList.list[e].index){b=a.certsList.list[e].index;d++;break}}else b=a.certsList.list[e].index,d++;1<d&&(b=-1);return b};if(null==a.certsList)d(a.SELECTINFO.curdevice,0,function(c){if(0!=c)a.uiUtil().errMsgBox(__text.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c);else{var d=m();0>d?h():null!=b&&""!=b||null!=a.SELECTINFO.pw?null!=b&&""!=b||a.SELECTINFO.index!=d||null==a.SELECTINFO.pw?l(d,b):l(d,a.SELECTINFO.pw):(PWDialog=a.loadUI("password")({type:null,args:{},onConfirm:function(a){PWDialog.dispose();l(d,a)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}});else{var n=m();0>n?h():null!=b&&""!=b||null!=a.SELECTINFO.pw?null!=b&&""!=b||a.SELECTINFO.index!=n||null==a.SELECTINFO.pw?l(n,b):l(n,a.SELECTINFO.pw):(PWDialog=a.loadUI("password")({type:null,args:{},onConfirm:function(a){PWDialog.dispose();l(n,a)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();e(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}}return!0}},DecryptWithUserSymmKey:function(d,c,b,e,g){function f(b,c,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(0==d){for(;-1<c.indexOf("-");)c=c.replace("-","");if(10>c.length)return-11}else if(1==d&&6>c.length)return-11;var f,g=c;f=0;for(c=c.length;16>c;c++)g+="abcdefghijklmnopqrstuvwxyz".substr(f++,1);f=g+"0123450123456789";g=f.substring(0,16);f=f.substring(16,32);e=a.usWebToolkit.util.decode64(e);c=null;try{var h=a.usWebToolkit.cipher.algorithms[b].startDecrypting(g,f);h.update(a.usWebToolkit.util.createBuffer(e));if(!1==h.finish())return-11;c=h.output.getBytes()}catch(k){return a.ERROR.Code=k.code,a.ERROR.Message=k.message,-12}return c}}if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{var h=k();if("seed"!=c)a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_SUPPORT_ALGORITHM,g(k(a.ERROR.Code,a.ERROR.Message));else if(null==e||""==e||1>e.length)alert(a.uiUtil().getErrorMessageLang().IDS_NOT_ENCRYPTED_DATA);else{a.reInitialize();var l=0,m=a.loadUI("securemail")({type:"SECURE_MAIL",args:{algorithm:c,data:e,decryptData:f,mode:d},onConfirm:function(b,c,e,k){3<l?(null!=document.getElementById("html_encripted")&&(document.getElementById("html_encripted").innerHTML=""),alert(e.IDS_KEY_TYPE[d]+e.IDS_PASSWORD_WRONG),m.dispose()):(k=document.getElementById("us-input-secure-mail-password"),b=f(b,k.value,c),h.resultCode=b,-10===b?(a.ERROR.Code=-10,a.ERROR.Message=e.IDS_ALGORITHM_ALERT,m.dispose(),g(h)):-11===b?(a.ERROR.Code=-11,a.ERROR.Message=e.IDS_KEY_TYPE[d]+e.IDS_PASSWORD_WRONG,4<l?(m.dispose(),g(h)):(l+=1,alert(e.IDS_KEY_TYPE[d]+e.IDS_DISCORDANCE_PASSWORD.replace("@",l)),k.value="")):-12===b?(m.dispose(),g(h)):-13===b?(a.ERROR.Code=-13,a.ERROR.Message=e.IDS_KEY_TYPE[d]+e.IDS_PASSWORD_WRONG,4<l?(m.dispose(),g(h)):(l+=1,alert(e.IDS_KEY_TYPE[d]+e.IDS_DISCORDANCE_PASSWORD.replace("@",l)),k.value="")):(m.dispose(),h.resultCode=0,h.decryptedData=b,g(h)))},onCancel:function(){m.dispose();a.uiUtil().getUserCancelErrCodeNMsg();g(k(a.ERROR.Code,a.ERROR.Message))}});m.show()}}},EncryptDataWithCert:function(d,c,b){if(!d||!b)return!1;var e=k();a.reInitialize();try{var g=a.usWebToolkit.pki.certificateFromBase64(c),f=a.usWebToolkit.pkcs7.createEnvelopedData();f.addRecipient(g);f.encContent.algorithm=a.usWebToolkit.pki.oids["seed-CBC"];f.content=a.usWebToolkit.util.createBuffer(d);f.encrypt();e.encryptedData=a.usWebToolkit.pkcs7.messageToBase64(f);b(e)}catch(h){a.ERROR.Code=h.code,a.ERROR.Message=h.message,b(k(a.ERROR.Code,a.ERROR.Message))}},GetMacAddress:function(d,c){if(!c)return!1;var b=k();a.reInitialize();4&a.ESVS.Mode&&a.nimservice().GetMacAddress(d,function(d,g,f){0!=d?(a.ERROR.Code=d,a.ERROR.Message=g,c(k(a.ERROR.Code,a.ERROR.Message))):(b.mac=f,c(b))})},SetMultiUsingOpt:function(d){a.ESVS.multiuse=d},CheckConnectToCAServer:function(d,c,b){if(!b)return!1;a.reInitialize();4&a.ESVS.Mode&&a.nimservice().CheckConnectToCAServer(a.ESVS.CMPIP,a.ESVS.CMPPort,d,c,function(c,d){a.ERROR.Code=c;a.ERROR.Message=d;b(k(a.ERROR.Code,a.ERROR.Message))})},SetSystemTimeFromTimeServer:function(d,c,b){if(!b)return!1;a.reInitialize();4&a.ESVS.Mode&&a.nimservice().SetSystemTimeFromTimeServer(d,c,function(c,d){a.ERROR.Code=c;a.ERROR.Message=d;b(k(a.ERROR.Code,a.ERROR.Message))})},GetRValueFromKey:function(d,c,b){if(!b)return!1;var e=k(),g=function(b,c,d){a.nimservice().GetAllUserCertListNum(b,c,"",function(c,e,f){nCertsCnt=f;if(0==c)0<nCertsCnt?a.nimservice().GetAllUserCert(f,function(b,c){0==b?a.certsList={list:c}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-cert-list-load");d(b)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-cert-list-load"),d(0));else{if(b==a.CONST.__USFB_M_MOBILE.device&&61E6==c)return a.ERROR.Code=11003,a.ERROR.Message=__lang.IDS_MSGBOX_NOT_INSTALL_MOBILE,document.getElementById("us-cls-btn").click(),"firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),a.certsList=null,d(c),!1;-1!==nCertsCnt&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());d(c);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-cert-list-load")}})},f=function(c,d){a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_CERT_LOADING_MSG[6]);if(a.uiUtil().isItPFDevice(a.SELECTINFO.curdevice))if(a.SELECTINFO.curdevice==a.CONST.__PF_M_LS.device){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_CERT_LOADING_MSG[6]);try{a.usWebToolkit.pki.certificateFromBase64(a.PFUC[c].signcert);var f=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),g=a.usWebToolkit.pkcs8.decryptPrivateKeyInfo(f,d),h=a.usWebToolkit.pkcs8.getPrivateKeyAttributesRandom(g);e.RValue=a.usWebToolkit.util.encode64(h);b(e)}catch(m){e.resultCode=a.ERROR.Code=m.code,e.resultMessage=a.ERROR.Message=m.message,b(e)}}else a.SELECTINFO.curdevice==a.CONST.__PF_M_CLOUDSIGN.device&&(a.uiUtil().createLoadingBox("hide","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_CERT_LOADING_MSG[6]),l());else a.nimservice().GetRValueFromKey(c,d,function(c,d,f){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_CERT_LOADING_MSG[6]);0!=c?(a.ERROR.Code=c,a.ERROR.Message=d,b(k(a.ERROR.Code,d))):(e.RValue=f,b(e))})},h=function(){for(var b=-1,c=0,e=0;e<a.certsList.list.length;e++)if(a.usWebToolkit.x509Certificate.parser(a.certsList.list[e].cert,"Base64"),d==a.usWebToolkit.x509Certificate.getSubjectName())if(0!=a.SELECTINFO.index){if(a.SELECTINFO.index==a.certsList.list[e].index){b=a.certsList.list[e].index;c++;break}}else b=a.certsList.list[e].index,c++;1<c&&(b=-1);return b},l=function(){var c=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:null},onConfirm:function(d,g,h,l,m,w){var q=h;if("undefined"!==typeof l&&"undefined"!==typeof m)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(w))a.nimservice()?(setTimeout(function(){c.dispose()},10),null==q&&a.CONST.__USFB_M_MOBILETOKEN.device==w?(q=a.certUtil().getTheCertAttributes(usimCert,"Base64"),B(l,m,w,usimCert,q)):B(l,m,w,g,q),e.certAttrs=q,f(l,m)):(a.ERROR.Code=e.resultCode=-1,a.ERROR.Message=e.resultMessage=a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER,b(e),setTimeout(function(){c.dispose(!0)},10));else if(w==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGetCertR(l,function(d,f,h){0!=d&&(a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){c.dispose()},10),e.resultCode=d,e.resultMessage=f,b(k(d,f)));reqGenSignNonVerifyPin(l,a.usWebToolkit.util.encodeUtf8(plainText),"Y",function(d,f,r){a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){c.dispose()},10);0!=d?(a.ERROR.Code=d,a.ERROR.Message=f,b(k(d,f))):(B(l,m,w,g,q),e.RValue=h,b(e))})});else{try{g=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[l].signcert),B(l,m,w,g,q),e.certAttrs=q,f(l,m)}catch(J){e.resultCode=a.ERROR.Code=J.code,e.resultMessage=112047==J.code?a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_MATTCHED_PWD:a.ERROR.Message=J.message,a.uiUtil().errMsgBox(d,a.ERROR.Code),b(e)}setTimeout(function(){c.dispose()},10)}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg(e);b(e);c.dispose(!0)}});c.show()};if(null!=d&&""!=d)if(null==a.certsList)g(a.SELECTINFO.curdevice,0,function(d){if(0!=d)a.uiUtil().errMsgBox(__text.IDS_MSGBOX_COMMON_ERROR_GET_CERT,d);else{var e=h();0>e?l():null!=c&&""!=c||null!=a.SELECTINFO.pw?null!=c&&""!=c||a.SELECTINFO.index!=e||null==a.SELECTINFO.pw?f(e,c):f(e,a.SELECTINFO.pw):(PWDialog=a.loadUI("password")({type:null,args:{},onConfirm:function(a){PWDialog.dispose();f(e,a)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();b(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}});else{var m=h();0>m?l():null!=c&&""!=c||null!=a.SELECTINFO.pw?null!=c&&""!=c||a.SELECTINFO.index!=m||null==a.SELECTINFO.pw?f(m,c):f(m,a.SELECTINFO.pw):(PWDialog=a.loadUI("password")({type:null,args:{},onConfirm:function(a){PWDialog.dispose();f(m,a)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();b(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}else l();return!0},GetUserDN:function(d){if(!d)return!1;var c=k(),b=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:null},onConfirm:function(e,g,f,h,l,m){var n=f;if("undefined"!==typeof h&&"undefined"!==typeof l)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m))a.nimservice()?(setTimeout(function(){b.dispose()},10),a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_CERT_LOADING_MSG[1]),e=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8("abcdefghijklmnopqrstuvwxyz1234567890~!@#$%^&amp;*()\ud55c\uae00")),a.nimservice().GetSignDataP7(h,l,e,"utf8",!0,null,!0,function(b,e,f,k,r,p){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0!=b?(a.ERROR.Code=c.resultCode=b,a.ERROR.Message=c.resultMessage=e):(null==n&&a.CONST.__USFB_M_MOBILETOKEN.device==m?(n=a.certUtil().getTheCertAttributes(r,"Base64"),B(h,l,m,r,n)):B(h,l,m,g,n),c.userDN=n.subjectName,c.certAttrs=n);d(c)})):(a.ERROR.Code=c.resultCode=-1,a.ERROR.Message=c.resultMessage=a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER,d(c),setTimeout(function(){b.dispose(!0)},10));else if(m==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGetCertR(h,function(e,f,r){0!=e&&(c.resultCode=e,c.resultMessage=f,setTimeout(function(){b.dispose()},10),d(k(e,f)));reqGenSignNonVerifyPin(h,a.usWebToolkit.util.encodeUtf8("abcdefghijklmnopqrstuvwxyz1234567890~!@#$%^&amp;*()\ud55c\uae00"),"Y",function(e,f,r){0!=e?(a.ERROR.Code=e,a.ERROR.Message=f,d(k(e,f))):(B(h,l,m,g,n),c.userDN=n.subjectName,d(c));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){b.dispose()},10)})});else{try{var q=window.console||{log:function(){}};D&&(q.log("b64 cert : ",a.PFUC[h].signcert),q.log("b64 pri : ",a.PFUC[h].signpri));g=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[h].signcert);var p=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[h].signpri),r=a.usWebToolkit.pkcs7.createSignedData();r.sign("abcdefghijklmnopqrstuvwxyz1234567890~!@#$%^&amp;*()\ud55c\uae00",g,p,l,null,null);a.usWebToolkit.pkcs7.messageToBase64(r);B(h,l,m,g,n);c.userDN=f.subjectName;d(c)}catch(t){c.resultCode=a.ERROR.Code=t.code,c.resultMessage=112047==t.code?a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_MATTCHED_PWD:a.ERROR.Message=t.message,a.uiUtil().errMsgBox(e,a.ERROR.Code),d(c)}setTimeout(function(){b.dispose()},10)}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg(c);d(c);b.dispose(!0)}});b.show();return!0},VerifyCertVID:function(d,c,b,e){if(!e)return!1;var g=k(),f=function(a){1==e.length?e(a):(null==a&&(a=k(-1)),e(a.resultCode,a.resultMessage))};a.reInitialize();a.ESVS.multiuse=!0;var h=function(b,c,d,e,h,l,m){if("PFS"==m)try{var n=window.console||{log:function(){}};D&&(n.log("b64 cert : ",a.PFUC[d].signcert),n.log("b64 pri : ",a.PFUC[d].signpri));var p=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[d].signcert),q=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[d].signpri),s=a.usWebToolkit.pkcs8.verifyVID(q,e,c,p);e=c="";s?f(k(0)):f(null)}catch(v){e=c="",a.ERROR.Code=v.code,a.ERROR.Message=v.message,f(k(v.code,v.message))}else"NIM"==m?(a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE),a.nimservice().VerifyVID(d,e,b,c,function(b,d){4305E4==b&&(b=14208);a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==b?f(k(0)):(a.ERROR.Code=b,a.ERROR.Message=d,f(k(b,a.uiUtil().getErrorMessageLang().IDS_ERROR_VERIFY_ID)));e=c=""})):"CLOUDSIGN"==m&&reqVerifyVID(d,c,function(b,c,d){0!=b?(a.ERROR.Code=b,a.ERROR.Message=c,f(k(b,c))):d?f(g):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_VID_ERROR_VERIFICATION,f(k(-1,a.ERROR.Message)))})},l=function(b){var c=a.loadUI("certselect")({type:"VID_VERIFICATION",args:{dn:null},onConfirm:function(d,e,g,l,m,n,p,q){c.dispose();B(d,e,q,n,p);if(b)h(0,b,d,e,g,l,m);else{var s=a.loadUI("ssn")({type:null,onConfirm:function(a){h(1,a,d,e,g,l,m);s.dispose()},onCancel:function(){s.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}});s.show()}},onCancel:function(){c.dispose(!0);a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}});c.show()},m=function(b,c,d){a.nimservice().GetAllUserCertListNum(b,c,"",function(c,e,f){nCertsCnt=f;if(0==c)0<nCertsCnt?a.nimservice().GetAllUserCert(f,function(b,c){0==b?a.certsList={list:c}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-cert-list-load");d(b)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-cert-list-load"),d(0));else{if(b==a.CONST.__USFB_M_MOBILE.device&&61E6==c)return a.ERROR.Code=11003,a.ERROR.Message=__lang.IDS_MSGBOX_NOT_INSTALL_MOBILE,document.getElementById("us-cls-btn").click(),"firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),a.certsList=null,d(c),!1;-1!==nCertsCnt&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());d(c);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-cert-list-load")}})},n=function(c,d,e){if(b)a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE),a.nimservice().VerifyVID(c,d,0,b,function(b,c){4305E4==b&&(b=14208);a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==b?f(k(0)):(a.ERROR.Code=b,a.ERROR.Message=c,f(k(b,a.uiUtil().getErrorMessageLang().IDS_ERROR_VERIFY_ID)));d=""});else{var g=a.loadUI("ssn")({type:null,onConfirm:function(b){g.dispose();a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_VID_VERIFY_MESSAGE);a.nimservice().VerifyVID(c,d,1,b,function(c,e){4305E4==c&&(c=14208);a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0==c?f(k(0)):(a.ERROR.Code=c,a.ERROR.Message=e,f(k(c,a.uiUtil().getErrorMessageLang().IDS_ERROR_VERIFY_ID)));d=b=""})},onCancel:function(){g.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}});g.show()}},q=function(b){for(var c=-1,d=0,e=0;e<a.certsList.list.length;e++)if(a.usWebToolkit.x509Certificate.parser(a.certsList.list[e].cert,"Base64"),b==a.usWebToolkit.x509Certificate.getSubjectName())if(0!=a.SELECTINFO.index){if(a.SELECTINFO.index==a.certsList.list[e].index){c=a.certsList.list[e].index;d++;break}}else c=a.certsList.list[e].index,d++;1<d&&(c=-1);return c};if(""==d||null==d)l(b);else if(null==a.certsList)m(a.SELECTINFO.curdevice,0,function(e){if(0!=e)a.uiUtil().errMsgBox(__text.IDS_MSGBOX_COMMON_ERROR_GET_CERT,e);else{var g=q(d);0>g?l(b):null!=c&&""!=c||a.SELECTINFO.index==g?null!=c&&""!=c||a.SELECTINFO.index!=g||null==a.SELECTINFO.pw?n(g,c,b):n(g,a.SELECTINFO.pw,b):(PWDialog=a.loadUI("password")({type:null,args:{},onConfirm:function(a){PWDialog.dispose();n(g,a,b)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}});else{var p=q(d);0>p?l(b):null!=c&&""!=c||a.SELECTINFO.index==p?null!=c&&""!=c||a.SELECTINFO.index!=p||null==a.SELECTINFO.pw?n(p,c,b):n(p,a.SELECTINFO.pw,b):(PWDialog=a.loadUI("password")({type:null,args:{},onConfirm:function(a){PWDialog.dispose();n(p,a,b)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}return!0},SignDataP7NonEnveloped:function(d,c,b,e,g){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||!g)return!1;var f=k(),h=function(a){1==g.length?g(a):(null==a&&(a=k(-1)),g(a.signedData,a.curDevice,a.certAttrs))};a.reInitialize();var l=function(){var b=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P7",args:{dn:null},onConfirm:function(c,g,l,m,n,p){var q=l;if("undefined"!==typeof m&&"undefined"!==typeof n)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(p))a.nimservice()?(setTimeout(function(){b.dispose()},10),a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_CERT_LOADING_MSG[1]),c=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)),a.nimservice().GetSignDataP7(m,n,c,"utf8",e,"",1,function(b,c,d,e,k,l){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0!=b?(a.ERROR.Code=f.resultCode=b,a.ERROR.Message=f.resultMessage=c):(null==q&&a.CONST.__USFB_M_MOBILETOKEN.device==p?(q=a.certUtil().getTheCertAttributes(k,"Base64"),B(m,n,p,k,q)):B(m,n,p,g,q),f.certAttrs=q,f.signedData=d,f.curDevice=p,f.tokenLabel=l);h(f);m=n=g=v=null})):(a.ERROR.Code=f.resultCode=-1,a.ERROR.Message=f.resultMessage=a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER,h(f),setTimeout(function(){b.dispose(!0)},10));else if(p==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGenSign(m,n,function(c,d,e,l){0!=c?(a.ERROR.Code=c,a.ERROR.Message=d,h(k(c,d))):(B(m,n,p,g,q),f.signedData=e,f.curDevice=p,f.b64RValue=l,h(f));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){b.dispose()},10)});else{try{var s=window.console||{log:function(){}};D&&(s.log("b64 cert : ",a.PFUC[m].signcert),s.log("b64 pri : ",a.PFUC[m].signpri));g=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[m].signcert);var v=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[m].signpri),x=a.usWebToolkit.pkcs7.createSignedData();x.sign(d,g,v,n,null,null);var A=a.usWebToolkit.pkcs7.messageToBase64(x);f.certAttrs=l;f.signedData=A;f.curDevice=p;h(f)}catch(z){f.resultCode=a.ERROR.Code=z.code,f.resultMessage=112047==z.code?a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_MATTCHED_PWD:a.ERROR.Message=z.message,a.uiUtil().errMsgBox(c,a.ERROR.Code),h(f)}setTimeout(function(){b.dispose()},10);m=n=g=v=null}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg(f);setTimeout(function(){b.dispose()},10);h(f)}});b.show()};if(""==c||null==c)l();else{var m=function(b,c,d){a.nimservice().GetAllUserCertListNum(b,c,"",function(c,e,f){nCertsCnt=f;if(0==c)0<nCertsCnt?a.nimservice().GetAllUserCert(f,function(b,c){0==b?a.certsList={list:c}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-cert-list-load");d(b)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-cert-list-load"),d(0));else{if(b==a.CONST.__USFB_M_MOBILE.device&&61E6==c)return a.ERROR.Code=11003,a.ERROR.Message=__lang.IDS_MSGBOX_NOT_INSTALL_MOBILE,document.getElementById("us-cls-btn").click(),"firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),a.certsList=null,d(c),!1;-1!==nCertsCnt&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());d(c);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-cert-list-load")}})},n=function(b,c){if("undefined"!==typeof b&&"undefined"!==typeof c)if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELECTINFO.curdevice))if(a.nimservice()){a.uiUtil().createLoadingBox("show","us-div-loading-dialog",a.uiUtil().getErrorMessageLang().IDS_CERT_LOADING_MSG[1]);var g=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d));a.nimservice().GetSignDataP7(b,c,g,"utf8",e,"",1,function(d,e,g,k,n,p){a.uiUtil().createLoadingBox("hide","us-div-loading-dialog");0!=d?(a.ERROR.Code=f.resultCode=d,a.ERROR.Message=f.resultMessage=e):(d=a.SELECTINFO.certattrs,null==d&&a.CONST.__USFB_M_MOBILETOKEN.device==a.SELECTINFO.curdevice?(d=a.certUtil().getTheCertAttributes(n,"Base64"),B(b,c,a.SELECTINFO.curdevice,n,d)):B(b,c,a.SELECTINFO.curdevice,l,d),f.certAttrs=d,f.signedData=g,f.curDevice=a.SELECTINFO.curdevice,f.tokenLabel=p);h(f);b=c=l=m=null})}else a.ERROR.Code=f.resultCode=-1,a.ERROR.Message=f.resultMessage=a.uiUtil().getErrorMessageLang().IDS_ERROR_LOADING_NIMSERVIER,h(f);else if(a.SELECTINFO.curdevice==a.CONST.__PF_M_CLOUDSIGN.device)a.uiUtil().loadingBox(!0,"us-div-list-load",1),reqGenSign(b,c,function(d,e,g,n){0!=d?(a.ERROR.Code=d,a.ERROR.Message=e,h(k(d,e))):(B(b,c,device,l,a.SELECTINFO.certattrs),f.signedData=g,f.curDevice=a.SELECTINFO.curdevice,h(f));a.uiUtil().loadingBox(!1,"us-div-list-load");b=c=l=m=null});else{try{g=window.console||{log:function(){}};D&&(g.log("b64 cert : ",a.PFUC[b].signcert),g.log("b64 pri : ",a.PFUC[b].signpri));var l=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[b].signcert),m=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[b].signpri),n=a.usWebToolkit.pkcs7.createSignedData();n.sign(d,l,m,c,null,null);var p=a.usWebToolkit.pkcs7.messageToBase64(n);f.certAttrs=a.SELECTINFO.certattrs;f.signedData=p;f.curDevice=a.SELECTINFO.curdevice;h(f)}catch(q){f.resultCode=a.ERROR.Code=q.code,f.resultMessage=112047==q.code?a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_NOT_MATTCHED_PWD:a.ERROR.Message=q.message,a.uiUtil().errMsgBox(userMsg,a.ERROR.Code),h(f)}b=c=l=m=null}},q=function(){for(var b=-1,d=0,e=0;e<a.certsList.list.length;e++)if(a.usWebToolkit.x509Certificate.parser(a.certsList.list[e].cert,"Base64"),c==a.usWebToolkit.x509Certificate.getSubjectName())if(0!=a.SELECTINFO.index){if(a.SELECTINFO.index==a.certsList.list[e].index){b=a.certsList.list[e].index;d++;break}}else b=a.certsList.list[e].index,d++;1<d&&(b=-1);return b};if(null==a.certsList)m(a.SELECTINFO.curdevice,0,function(c){if(0!=c)a.uiUtil().errMsgBox(__text.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c);else{var d=q();0>d?l():null!=b&&""!=b||null!=a.SELECTINFO.pw?null!=b&&""!=b||a.SELECTINFO.index!=d||null==a.SELECTINFO.pw?n(d,b):n(d,a.SELECTINFO.pw):(PWDialog=a.loadUI("password")({type:null,args:{},onConfirm:function(a){PWDialog.dispose();n(d,a)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}});else{var p=q();0>p?l():null!=b&&""!=b||null!=a.SELECTINFO.pw?null!=b&&""!=b||a.SELECTINFO.index!=p||null==a.SELECTINFO.pw?n(p,b):n(p,a.SELECTINFO.pw):(PWDialog=a.loadUI("password")({type:null,args:{},onConfirm:function(a){PWDialog.dispose();n(p,a)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();h(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}}return!0}},SignDataP1WithPwd:function(d,c,b,e){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!d||!e||document.getElementById("us-div-cert-select"))return!1;var g=k(),f=function(a){1==e.length?e(a):(null==a&&(a=k()),e(a.signedData,a.theCert,a.theDN))};a.reInitialize();var h=function(){var b=a.loadUI("certselect")({type:"DIGITAL_SIGNATURE_P1",args:{dn:c},onConfirm:function(c,e,h,k,l,m){if("undefined"!==typeof k&&"undefined"!==typeof l){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m))a.nimservice()?(h=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d)),a.nimservice().GetSignDataP1(k,l,h,null,!0,function(d,h,n,q,s,u){0!=d?(a.ERROR.Code=g.resultCode=d,a.ERROR.Message=g.resultMessage=h,a.uiUtil().errMsgBox(h,d)):(null==c&&a.CONST.__USFB_M_MOBILETOKEN.device==m&&(_certAttrs=a.certUtil().getTheCertAttributes(s,"Base64"),c=s,e=_certAttrs.subjectName),B(k,l,m,c,a.certUtil().getTheCertAttributes(c,"Base64")),g.theCert=c,g.theDN=e,g.signedData=n,g.tokenlabel=u);f(g);a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){b.dispose()},10)})):(a.ERROR.Code=g.resultCode=-1,a.ERROR.Message=g.resultMessage=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_NIM_ERROR_UNLOAD,f(g),setTimeout(function(){b.dispose(!0)},10));else{try{var n=window.console||{log:function(){}};D&&(n.log("b64 cert : ",a.PFUC[k].signcert),n.log("b64 pri : ",a.PFUC[k].signpri));var q=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[k].signcert),s=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[k].signpri),s=crosscert.pki.privateKeyFromAsn1(crosscert.asn1.fromDer(s)),n=null;switch(oids[q.signatureOid]){case "sha1WithRSAEncryption":n=crosscert.md.algorithms[sha1].create();break;case "kcdsaWithSHA1":q.md=crosscert.md.algorithms[sha1].create();break;case "md5WithRSAEncryption":n=crosscert.md.algorithms[md5].create();break;case "sha256WithRSAEncryption":n=crosscert.md.algorithms[sha256].create();break;case "RSASSA-PSS":n=crosscert.md.algorithms[sha256].create()}n.update(d);var v=s.sign(n);a.usWebToolkit.pkcs7.messageToBase64(v);g.theCert=c;g.theDN=e;g.signedData=signedData;f(g)}catch(x){a.ERROR.Code=g.resultCode=x.code,a.ERROR.Message=g.resultMessage=x.message,a.uiUtil().errMsgBox(h,a.ERROR.Code),f(g)}setTimeout(function(){b.dispose()},10)}k=l=q=pri=null}},onCancel:function(){a.uiUtil().getUserCancelErrCodeNMsg(g);f(g);b.dispose(!0)}});b.show()};if(""==c||null==c)h();else{var l=function(b,c,d){a.nimservice().GetAllUserCertListNum(b,c,"",function(c,e,f){nCertsCnt=f;if(0==c)0<nCertsCnt?a.nimservice().GetAllUserCert(f,function(b,c){0==b?a.certsList={list:c}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-cert-list-load");d(b)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-cert-list-load"),d(0));else{if(b==a.CONST.__USFB_M_MOBILE.device&&61E6==c)return a.ERROR.Code=11003,a.ERROR.Message=__lang.IDS_MSGBOX_NOT_INSTALL_MOBILE,document.getElementById("us-cls-btn").click(),"firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),a.certsList=null,d(c),!1;-1!==nCertsCnt&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());d(c);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-cert-list-load")}})},m=function(b,e){var h=b,k=e;if("undefined"!==typeof h&&"undefined"!==typeof e){if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(a.SELECTINFO.curdevice))if(a.nimservice()){var l=a.usWebToolkit.util.encode64(a.usWebToolkit.util.encodeUtf8(d));a.nimservice().GetSignDataP1(h,e,l,null,!0,function(b,d,e,l,m,n){if(0!=b)a.ERROR.Code=g.resultCode=b,a.ERROR.Message=g.resultMessage=d,a.uiUtil().errMsgBox(d,b);else{b=c;d="";for(l=0;l<a.certsList.list.length&&(d=a.certsList.list[l].cert,h!=a.certsList.list[l].index);l++);a.CONST.__USFB_M_MOBILETOKEN.device==a.SELECTINFO.curdevice&&(d=m,b=a.SELECTINFO.certattrs.subjectName);B(h,k,a.SELECTINFO.curdevice,d,a.certUtil().getTheCertAttributes(d,"Base64"));g.theCert=d;g.theDN=b;g.signedData=e;g.tokenlabel=n}f(g);a.uiUtil().loadingBox(!1,"us-div-list-load")})}else a.ERROR.Code=g.resultCode=-1,a.ERROR.Message=g.resultMessage=a.uiUtil().getErrorMessageLang().IDS_MSGBOX_NIM_ERROR_UNLOAD,f(g);else try{var l=a.usWebToolkit.pki.certificateFromBase64(a.PFUC[b].signcert),m=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[b].signpri),m=crosscert.pki.privateKeyFromAsn1(crosscert.asn1.fromDer(m)),n=null;switch(oids[l.signatureOid]){case "sha1WithRSAEncryption":n=crosscert.md.algorithms[sha1].create();break;case "kcdsaWithSHA1":l.md=crosscert.md.algorithms[sha1].create();break;case "md5WithRSAEncryption":n=crosscert.md.algorithms[md5].create();break;case "sha256WithRSAEncryption":n=crosscert.md.algorithms[sha256].create();break;case "RSASSA-PSS":n=crosscert.md.algorithms[sha256].create()}n.update(d);var q=m.sign(n);singedData=a.usWebToolkit.pkcs7.messageToBase64(q);g.theCert=theCert;g.theDN=theDN;g.signedData=signedData;f(g)}catch(s){a.ERROR.Code=g.resultCode=s.code,a.ERROR.Message=g.resultMessage=s.message,a.uiUtil().errMsgBox(userMsg,a.ERROR.Code),f(g)}b=e=l=pri=null}},n=function(){for(var b=-1,d=0,e=0;e<a.certsList.list.length;e++)if(a.usWebToolkit.x509Certificate.parser(a.certsList.list[e].cert,"Base64"),c==a.usWebToolkit.x509Certificate.getSubjectName())if(0!=a.SELECTINFO.index){if(a.SELECTINFO.index==a.certsList.list[e].index){b=a.certsList.list[e].index;d++;break}}else b=a.certsList.list[e].index,d++;1<d&&(b=-1);return b};if(null==a.certsList)l(a.SELECTINFO.curdevice,0,function(c){if(0!=c)a.uiUtil().errMsgBox(__text.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c);else{var d=n();0>d?h():null!=b&&""!=b||null!=a.SELECTINFO.pw?null!=b&&""!=b||a.SELECTINFO.index!=d||null==a.SELECTINFO.pw?m(d,b):m(d,a.SELECTINFO.pw):(PWDialog=a.loadUI("password")({type:null,args:{},onConfirm:function(a){PWDialog.dispose();m(d,a)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}});else{var q=n();0>q?h():null!=b&&""!=b||null!=a.SELECTINFO.pw?null!=b&&""!=b||a.SELECTINFO.index!=q||null==a.SELECTINFO.pw?m(q,b):m(q,a.SELECTINFO.pw):(PWDialog=a.loadUI("password")({type:null,args:{},onConfirm:function(a){PWDialog.dispose();m(q,a)},onCancel:function(){PWDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg();f(k(a.ERROR.Code,a.ERROR.Message))}}),PWDialog.show())}}return!0}},getCertPEMType:function(d,c){if(!1==a.isAvailable())a.uiUtil().msgBox(a.uiUtil().getErrorMessageLang().IDS_ERROR_DO_NOT_AVAILABLE);else{if(!c)return!1;var b=k(),e=function(a){1==c.length?c(a):(null==a&&(a=k()),c(a.signedData,a.theCert,a.theDN))};if(""==d)return e(b),!0;var g=function(b,c,d){a.nimservice().GetAllUserCertListNum(b,c,"",function(c,e,f){nCertsCnt=f;if(0==c)0<nCertsCnt?a.nimservice().GetAllUserCert(f,function(b,c){0==b?a.certsList={list:c}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-cert-list-load");d(b)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-cert-list-load"),d(0));else{if(b==a.CONST.__USFB_M_MOBILE.device&&61E6==c)return a.ERROR.Code=11003,a.ERROR.Message=__lang.IDS_MSGBOX_NOT_INSTALL_MOBILE,document.getElementById("us-cls-btn").click(),"firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),a.certsList=null,d(c),!1;-1!==nCertsCnt&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());d(c);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-cert-list-load")}})},f=function(){for(var b="",c=0;c<a.certsList.list.length;c++)if(a.usWebToolkit.x509Certificate.parser(a.certsList.list[c].cert,"Base64"),d==a.usWebToolkit.x509Certificate.getSubjectName()){b=a.certsList.list[c].cert;break}return b};null==a.certsList?g(a.SELECTINFO.curdevice,0,function(c){0!=c?a.uiUtil().errMsgBox(__text.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c):(c=f(),""!=c&&(b.PEMCert=a.usWebToolkit.pki.certificateToPem(a.usWebToolkit.pki.certificateFromBase64(c))),e(b))}):(g=f(),""!=g&&(b.PEMCert=a.usWebToolkit.pki.certificateToPem(a.usWebToolkit.pki.certificateFromBase64(g))),e(b));return!0}},GetCertPath:function(d){if(!d)return!1;var c=k();if(1>a.SELECTINFO.index)return c.certPath="",d(c),!0;4&a.ESVS.Mode?a.nimservice().GetCertPath(a.SELECTINFO.index,function(b,e,g){0!=b?(a.ERROR.Code=b,a.ERROR.Message=e,d(k(b,e))):(c.certPath=g,d(c))}):(a.ERROR.Code=-1,a.ERROR.Message=a.uiUtil().getErrorMessageLang().IDS_ERROR_BROWSER_NOT_SUPPORT,d(k(a.ERROR.Code,a.ERROR.Message)));return!0}}}alert("Failed to initialize Unisign Core.")};
var __certselect=function(a){var K=function(e){function u(){if(!a.certsList)return null;var c=null,c=a.certsList,b=c.list.length,f=[],d=[],n=e.args.dn,h=null;null!=a.ESVS.Policy&&(-1!=a.ESVS.Policy.indexOf("|")?h=a.ESVS.Policy.split("|"):(h=[],h[0]=a.ESVS.Policy));var g=null;null!=a.ESVS.Organization&&(-1!=a.ESVS.Organization.indexOf("|")?g=a.ESVS.Organization.split("|"):(g=[],g[0]=a.ESVS.Organization));for(var l=0;l<b;l++){a.usWebToolkit.x509Certificate.parser(c.list[l].cert,"Base64");var m=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),w=a.usWebToolkit.x509Certificate.getSubjectName(),p=a.usWebToolkit.x509Certificate.getNotAfter(),q=a.usWebToolkit.x509Certificate.getNotAfter(),t=c.list[l].index,D=a.certUtil().getIssuerName(m);"undefined"==D&&(D=a.certUtil().getO(w));if(null==n||w.toLowerCase()==n.toLowerCase()){if(null!=a.ESVS.Policy){for(var v=0;v<h.length&&h[v]!=m;v++);if(h.length<=v)continue}if(null!=a.ESVS.Organization&&("CERT_RENEWAL"==e.type||"CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type||"CERT_REVOCATION"==e.type||"CERT_SOE"==e.type||"CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type)){for(v=0;v<g.length&&g[v].toLowerCase()!=a.certUtil().getO(w).toLowerCase();v++);if(g.length<=v)continue}if(a.ESVS.ShowExpiredCerts||2!==a.certUtil().getExpirationStateValue(q))v=[""],v[1]=a.certUtil().getCertType(m),v[2]=a.certUtil().getCN(w),v[3]=D,v[4]=a.certUtil().getLocalDate(p),v[5]=t,v[6]=a.certUtil().getExpirationStateValue(q),"crosscert"==a.certUtil().getO(w).toLowerCase()?f.push(v):d.push(v)}}return c={list:f.concat(d)}}function k(c,b,f,d,n){if(a.CONST.__USFB_M_DISK.device>c||0>b||!f)return-1;var h=0,g=0;q=b;a.certsList&&(a.certsList=null);if(a.CONST.__PF_M_LS.device===c&&2&a.ESVS.Mode){a.PFSH||n(-1);try{a.PFSH.SelectStorage(1)}catch(pa){}try{a.PFSH.LoadAllCerts(document.domain)}catch(Y){301E5===Y.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}b=null;try{b=a.PFSH.GetUserCerts(document.domain),a.PFUC=b}catch(w){}b&&(h=b.length-1);if(0<h){d=[];for(var p=0;p<h;p++){var k=p+1,t={};t.index=k;t.cert=b[k].signcert;d[p]=t}a.certsList={list:d}}else a.certsList=null,g=0;n(g)}else if(c==a.CONST.__PF_M_SS.device&&a.CCPFSH())a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(b,c){0==b&&a.CCPFSH().GetCertificateList(function(b,c){if(0==b){var d=0;(a.PFUC=c)&&(d=c.length-1);if(0<d){for(var f=[],g=0;g<d;g++){var h=g+1,e={};e.index=h;e.cert=c[h].signcert;f[g]=e}a.certsList={list:f}}}n(b)})});else if(c==a.CONST.__PF_M_CLOUDSIGN.device){if(e.CS_phoneNumber)v(e.CS_phoneNumber);else{var D=a.loadUI("phoneNumber")({type:"phoneNumber",args:null,onConfirm:function(a){__PhoneNumber=a;v(a);D.dispose()},onCancel:function(){D.dispose()}});D.show()}var v=function(b){a.uiUtil().loadingBox(!0,"us-div-list-load",0);reqMemberInfo(b,function(c,d,g){if(0!=c)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),alert(d+"\n\nError Code [ "+c+" ]"),!1;c=parseInt(g.split("|")[0]);0<c?s(b):(-1==c?(a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.ERROR.Code=11004,a.ERROR.Message=f.IDS_MSGBOX_DOUBLE):(a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.ERROR.Code=11005,a.ERROR.Message=f.IDS_MSGBOX_JOIN),n(a.ERROR.Code))})},s=function(b){reqGetCert(b,"LOGIN",function(b,c,d){if(0!=b)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.uiUtil().errMsgBox(c,b),!1;if(0<d.length){b=[];for(c=0;c<d.length;c++){var f={};f.index=c+1;f.cert=d[c];b[c]=f}a.certsList={list:b}}(d=u())?m.redrawList(d.list,d.list.length):m.redrawList(null,0);a.uiUtil().loadingBox(!1,"us-div-list-load",0);return!0})}}else!a.uiUtil().isItPFDevice(c)&&4&a.ESVS.Mode?a.nimservice()?a.nimservice().GetAllUserCertListNum(c,b,d,function(b,d,g){if(l!=c)return!1;h=g;if(0==b)0<h?a.nimservice().GetAllUserCert(g,function(b,c){0==b?a.certsList={list:c}:win&&"none"!=win.style.display&&a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-list-load");n(b)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),n(0));else{if(c==a.CONST.__USFB_M_MOBILE.device&&61E6==b)return a.ERROR.Code=11003,a.ERROR.Message=f.IDS_MSGBOX_NOT_INSTALL_MOBILE,confirm(f.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)?(document.getElementById("us-cls-btn").click(),d="firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),null==d&&a.uiUtil().msgBox(f.IDS_MSGBOX_BLOCK_POPUP_WINDOW),a.certsList=null):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),n(0)),!1;if(c==a.CONST.__USFB_M_SECUREDISK.device&&8005E4==b)return a.ERROR.Code=31001,a.ERROR.Message=f.IDS_MSGBOX_NOT_INSTALL_SD,confirm(f.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(d="firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"),null==d&&a.uiUtil().msgBox(f.IDS_MSGBOX_BLOCK_POPUP_WINDOW)),a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),n(b),!1;-1!==h&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());n(b);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD),n(-1)):n(g)}function z(c,b){if(!c||!b)return!1;if(!a.certsList||0>m.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var f=a.loadUI("certverify")({type:null,args:{idx:parseInt(m.selectedIndex())},onConfirm:function(){f.dispose();c.focus()},onCancel:function(){f.dispose();c.focus()}});f.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function A(c,b){if(!c||!b)return!1;if(!a.certsList||0>m.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var f=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(m.selectedIndex()),cert:a.certsList.list[parseInt(m.selectedIndex())-1].cert},onConfirm:function(){f.dispose();c.focus()},onCancel:function(){f.dispose();c.focus()}});f.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function Z(c){if(!c)return!1;var b=document.getElementById("us-div-cert-select");b.style.display="none";var f=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",args:{style:"child"},onCancel:function(){f.dispose();b.style.display="block";var d=document.getElementById("us-div-cert-select");switch(l){case a.CONST.__USFB_M_DISK.device:L(d,y);break;case a.CONST.__USFB_M_MOBILE.device:M(d,y);break;case a.CONST.__USFB_M_HDD.device:N(d,y);break;case a.CONST.__PF_M_LS.device:E(d,y);break;case a.CONST.__PF_M_SS.device:O(d,y);break;case a.CONST.__USFB_M_MOBILETOKEN.device:case a.CONST.__USFB_M_SECUREDISK.device:case a.CONST.__USFB_M_HSMKEY.device:case a.CONST.__USFB_M_SMARTCARD.device:case a.CONST.__PF_M_CLOUDSIGN.device:break;default:F(d,y)}c.focus()}});f.show()}function $(c,b,f,d){if(a.CONST.__USFB_M_DISK.device>c||!b||!f||!d)return!1;var n=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:b,onConfirm:function(b){0<b&&k(c,b,d,"",function(b){0!=b?(a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),m.redrawList(null,0)):(b=u())?m.redrawList(b.list,b.list.length):m.redrawList(null,0);a.ESVS.Embedded?setTimeout(function(){n.dispose()},10):n.dispose();f.focus();a.uiUtil().loadingBox(!1,"us-div-list-load")})},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");n.dispose();f.focus()}});n.show()}function aa(c,b,f,d){if(a.CONST.__USFB_M_DISK.device>c||!f||!d)return!1;var n=a.loadUI("sectokenselect")({type:c,args:b,onConfirm:function(h){var g=b.list[h-1].name;if(!1==a.ESVS.IssueCertInBIOToken&&("CERT_RENEWAL_KMCERT"===e.type||"CERT_RENEWAL"===e.type||"CERT_RENEWAL_SIGN"===e.type||"CERT_REVOCATION"===e.type||"CERT_SOE"===e.type)&&c==a.CONST.__USFB_M_HSMKEY.device&&-1!=g.indexOf("BIO_"))return a.uiUtil().errMsgBox(d.IDS_CANT_ISSUECERT_BIOTOKEN,-1),!1;0<h&&(a.ESVS.Embedded?setTimeout(function(){n.dispose()},10):n.dispose(),k(c,h,d,"",function(b){if(0!=b){switch(b){case 4812E4:case 4813E4:a.uiUtil().msgBox(d.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b)}m.redrawList(null,0)}else(b=u())?m.redrawList(b.list,b.list.length):m.redrawList(null,0);f.focus()}))},onCancel:function(){n.dispose();f.focus()}});n.show()}function ba(c,b,f,d){if(a.CONST.__USFB_M_DISK.device>c||!b||!f||!d)return!1;var n=a.loadUI("driveselect")({type:"DEVICE_SAVE_TOKEN",args:b,onConfirm:function(b){n.dispose();a.nimservice()?a.nimservice().CheckSCardConnected(function(b,n){0===b?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(b){a.ESVS.Embedded?setTimeout(function(){PINDialog.dispose()},10):PINDialog.dispose();a.nimservice().CheckSCardPin(b,function(g,n){if(0!=g){switch(g){case 4904E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN,g)}m.redrawList(null,0);setTimeout(function(){f.focus()},10)}else k(c,0,d,b,function(b){0!=b?(a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),m.redrawList(null,0)):(b=u())?m.redrawList(b.list,b.list.length):m.redrawList(null,0);setTimeout(function(){f.focus()},10)})})},onCancel:function(){PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){f.focus()},10)}}),PINDialog.show()):(a.uiUtil().msgBox(d.IDS_MSGBOX_SMART_CARD_UNCONNECTED),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){f.focus()},10))}):(a.uiUtil().msgBox(d.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){f.focus()},10))},onCancel:function(){n.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");f.focus()}});n.show()}function O(c,b){if(!c||!b)return!1;l=a.CONST.__PF_M_SS.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);k(a.CONST.__PF_M_SS.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),m.redrawList(null,0),!1;(c=u())?m.redrawList(c.list,c.list.length):m.redrawList(null,0)})}function E(c,b){if(!c||!b)return!1;l=a.CONST.__PF_M_LS.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);C(b);x();a.uiUtil().loadingBox(!0,"us-div-list-load",0);setTimeout(function(){k(a.CONST.__PF_M_LS.device,0,b,"",function(c){a.uiUtil().loadingBox(!1,"us-div-list-load",0);if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),m.redrawList(null,0),!1;(c=u())?m.redrawList(c.list,c.list.length):m.redrawList(null,0)})},10)}function K(c,b){if(!c||!b)return!1;l=a.CONST.__PF_M_CLOUDSIGN.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);C(b);P("123456789012345678901234567890");k(a.CONST.__PF_M_CLOUDSIGN.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),m.redrawList(null,0),!1;(c=u())?m.redrawList(c.list,c.list.length):m.redrawList(null,0)})}function N(c,b){if(!c||!b)return!1;l=a.CONST.__USFB_M_HDD.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);C(b);x();k(a.CONST.__USFB_M_HDD.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),m.redrawList(null,0),!1;(c=u())?m.redrawList(c.list,c.list.length):m.redrawList(null,0);return!0})}function L(c,b){if(!c||!b)return!1;var f=null;l=a.CONST.__USFB_M_DISK.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);C(b);x();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(l))if(a.nimservice())a.nimservice().GetDiskList(function(d,n,h){n=0;h&&(n=h.length);if(0==d&&0<n){d=[];for(var g=0;g<n;g++){var e={};e.index=g+1;e.name=h[g];d[g]=e}f={list:d}}else return a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,!1;$(a.CONST.__USFB_M_DISK.device,f,c,b)});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ca(c,b){if(!c||!b)return!1;var f=null;l=a.CONST.__USFB_M_HSMKEY.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);da(b);x();if(4&a.ESVS.Mode)if(a.nimservice()){var d=0;if("CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type||"CERT_REVOCATION"==e.type||"CERT_SOE"==e.type)d=1;a.nimservice().GetHSMList(d,function(d,e,g){e=0;g&&(e=g.length);if(0==d&&0<e){d=0;for(var l=[],m=0;m<e;m++){var q=m+1,p={},k=g[m].split("|");p.index=q;p.name=k[0];p.driver=k[1];p.passage=k[2];p.validity=k[3];l[d++]=p}f={list:l}}else a.uiUtil().loadingBox(!1,"us-div-list-load"),a.nimservice().GetLastErrorCode();aa(a.CONST.__USFB_M_HSMKEY.device,f,c,b)})}else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ea(c,b){if(!c||!b)return!1;l=a.CONST.__USFB_M_SECUREDISK.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);C(b);x();a.nimservice().IsSDInstalled(function(c,d){a.uiUtil().loadingBox(!1,"us-div-list-load");0!=c?(a.ERROR.Code=31001,a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_SD,confirm(b.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW))):k(a.CONST.__USFB_M_SECUREDISK.device,1,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),m.redrawList(null,0),!1;(c=u())?m.redrawList(c.list,c.list.length):m.redrawList(null,0);return!0})})}function Q(c,b){if(!c||!b)return!1;l=a.CONST.__USFB_M_MOBILETOKEN.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);C(b);x();if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().IsInstalledUSIMModule(2,!1,function(c,d){a.uiUtil().loadingBox(!1,"us-div-list-load");0==c?a.nimservice().SetUSIMOptions(a.usimEnv.sitecode,a.usimEnv.modecode,a.usimEnv.siteURL,a.usimEnv.serviceIP,a.usimEnv.servicePort,a.usimEnv.downloadURL,function(a){document.getElementById("us-confirm-btn").click()}):4847E4==c?(a.ERROR.Code=21002,a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_SMARTCERT,confirm(b.IDS_CONFIRMBOX_NOT_INSTALL_SMARTCERT)?(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.usimEnv.downloadURL,"usim_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.usimEnv.downloadURL,"usim_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW)):(m.redrawList(null,-1),document.getElementById("us-div-cert-select").style.display="")):(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),a.uiUtil().errMsgBox(a.ERROR.Message,a.ERROR.Code),m.redrawList(null,-1),document.getElementById("us-div-cert-select").style.display="")});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function M(c,b){if(!c||!b)return!1;var f=[function(){Q(c,b)},function(){fa(c,b)}],d=a.loadUI("mobileselect")({type:null,args:null,onConfirm:function(a){f[a]();d.dispose()},onCancel:function(){d.dispose()}});d.show();return!0}function fa(c,b){if(!c||!b)return!1;l=a.CONST.__USFB_M_MOBILE.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);C(b);x();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(l))if(a.nimservice())k(l,q,b,"",function(c){if(0!=c){switch(c){case 61E6:case 6101E4:a.ERROR.Code=11003;a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_MOBILE;confirm(b.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)&&(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW));break;case 6102E4:a.uiUtil().errMsgBox(b.IDS_MSGBOX_UBIKEY_LOAD_LIBRARY,c);break;case 6107E4:a.uiUtil().errMsgBox(b.IDS_MSGBOX_UBIKEY_SET_ENV,c)}m.redrawList(null,0)}else(c=u())?m.redrawList(c.list,c.list.length):m.redrawList(null,0)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function F(c,b){if(!c||!b)return!1;a.uiUtil().MsgBox(b.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function C(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=y.IDS_PASSWORD_DESCRIPTION;return!0}function da(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PIN));document.getElementById("us-lbl-pw2").innerHTML="";return!0}function P(c){if(null==c||0>=c.length)return!1;var b=document.getElementById("us-pw-text");b.value=c;b.readOnly=!0;b.disabled=!0;l==a.CONST.__PF_M_CLOUDSIGN.device&&(document.getElementById("us-div-pw").style.display="none");return!0}function x(){l!=a.CONST.__PF_M_CLOUDSIGN.device&&(document.getElementById("us-div-pw").style.display="block");var c=document.getElementById("us-pw-text");c&&(c.value="",c.readOnly=!1,c.disabled=!1)}function ga(c,b,f){if(!c||!b||!f)return!1;var d=0,e={};try{var h=a.PFSH.SetP12OnMemory(c,b),d=h.index;a.PFUC=e=h.aluc}catch(g){switch(g.code){case 1E7:0<=g.detail.indexOf("115010")?a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g.detail);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g.code)}return!1}a.certsList&&(a.certsList=null);c=[];f={};h=null;f.index=d;f.cert=e[d].signcert;c[0]=f;a.certsList={list:c};if(h=u())return m.redrawList(h.list,h.list.length),P(b),!0;a.certsList=null;m.redrawList(null,-1);x();return!1}function G(){a.certsList&&(a.certsList=null);m.redrawList(null,-1);x();pw=""}function R(c,b,f,d){(null==b||0>=b.length||null==f)&&d(-1);a.certsList&&(a.certsList=null);if(0<c)a.nimservice().GetSignCertFromCertList(c,function(f,e,n){e=[];var l={},q=null;0==f?(l.index=c,l.cert=n,e[0]=l,a.certsList={list:e},(q=u())?(m.redrawList(q.list,q.list.length),b="",d(0)):(G(),d(-1))):(G(),d(-1))});else{var e=a.nimservice().GetLastErrorCode();a.nimservice().GetLastErrorMessage();switch(e){case 4301E4:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,e)}G();d(-1)}}function ha(c,b,f,d){(null==c||0>=c.length||null==b||0>=b.length||null==f)&&d(-1);a.nimservice()?a.nimservice().GetPfxCertList(1,c,b,function(c,e,g){0==c?R(g,b,f,function(c){0==c?d(0):d(-1);b="";a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().errMsgBox(e,c),G(),d(0),a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD),b="",d(-1))}function ia(c,b,f,d){(null==c||0>=c.length||null==b||0>=b.length||null==f)&&d(-1);4!=a.ESVS.Mode||a.uiUtil().isItPFDevice(l)?(rv=ga(c,b,f),b=""):a.nimservice()?a.nimservice().GetPfxCertList(0,c,b,function(c,e,g){0==c?R(g,b,f,function(c){0==c?d(0):d(-1);b="";a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().errMsgBox(e,c),G(),d(-1),a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD),d(-1))}function S(c,b){if(null==c||0>=c.length||null==b)return!1;if(0<c.length&&-1<c.indexOf(".")){var f=c.split("."),f=f[f.length-1].toLowerCase();if("pfx"!=f&&"p12"!=f)return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_NOT_PFX),!1}else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1;return!0}function ja(c,b){if(!c||!b)return!1;l=a.CONST.__USFB_M_ETC.device;q=0;var f=null,d=null,e=document.getElementById("us-confirm-btn"),h=document.getElementById("us-cert-search-btn");if("opera"==a.browserName||"safari"==a.browserName)c.style.display="none";if(window.FileReader){var g=c.files;if(0<g.length){var m=g[0];if(!0==S(m.name,b)){var k=new FileReader;k.readAsBinaryString?(k.readAsBinaryString(m),k.addEventListener("load",function(){var c=k.result,f=c.length;if(m.size===f)d=a.usWebToolkit.util.encode64(c,f);else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1})):(k.readAsArrayBuffer(m),k.addEventListener("load",function(){var c=k.result,f=null;try{var e=String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(c)));try{f=decodeURIComponent(escape(e))}catch(g){if("URIError"==g.name)f=e;else throw g;}}catch(h){return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1}c=f.length;if(m.size===c)d=a.usWebToolkit.util.encode64(f,c);else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1}))}else return setTimeout(function(){h.focus()},10),!1}else return setTimeout(function(){h.focus()},10),!1}else{if("msie"==a.browserName&&8===parseInt(a.browserVersion))g=document.getElementById("us-div-cert-select"),g.onselectstart=function(){return!0},c.select(),f=c.value,c.style.display="none",g.onselectstart=function(){return!1};else if("msie"==a.browserName&&9===parseInt(a.browserVersion)){if(f=c.value,-1<f.indexOf("fakepath"))return a.uiUtil().msgBox(b.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_IE9),setTimeout(function(){h.focus()},10),!1}else f=c.value;if(!1==S(f,b))return setTimeout(function(){h.focus()},10),!1}Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(a){null!=f?(Dialog.dispose(),ha(f,a,b,function(b){a="";0===b?setTimeout(function(){e.focus()},10):setTimeout(function(){h.focus()},10)})):(Dialog.dispose(),ia(d,a,b,function(b){a="";0===b?setTimeout(function(){e.focus()},10):setTimeout(function(){h.focus()},10)}))},onCancel:function(){Dialog.dispose();setTimeout(function(){h.focus()},10)}});Dialog.show()}function ka(a){if(!a)return!1;a=a||window.event;13==(a.which||a.keyCode)&&document.getElementById("us-confirm-btn").click();return!0}function s(){e.onConfirm=T;I=!1}function la(c){function b(){U++;U>=a.ESVS.LimitNumOfTimesToTryToInputPW?a.ESVS.Embedded?(a.bsUtil().AhnlabClearText("us-pw-text"),n.value="",setTimeout(function(){n.focus()},10)):(a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_BEFORE+a.ESVS.LimitNumOfTimesToTryToInputPW+d.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_AFTER),J()):(a.bsUtil().AhnlabClearText("us-pw-text"),n.value="",setTimeout(function(){n.focus()},10))}m.restoreOnMouseEvent();if(!c)return!1;var f=e.onConfirm;if(!1==I)T=e.onConfirm,I=!0;else return!1;e.onConfirm=function(){};var d=c,n=document.getElementById("us-pw-text"),h=n.value;if(l==a.CONST.__USFB_M_ETC.device&&("CERT_RENEWAL_KMCERT"===e.type||"CERT_RENEWAL"===e.type||"CERT_RENEWAL_SIGN"===e.type||"CERT_REVOCATION"===e.type||"CERT_SOE"===e.type))return a.uiUtil().errMsgBox(d.IDS_CANT_WORK_WITH_PFX,-1),s(),!1;h&&4&a.ESVS.Mode&&("touchen"==a.ESVS.SecureKeyboardType&&a.bsUtil().isTouchEnKeyUsable()?h=a.bsUtil().GetEncryptPwd("us-keyboard-secure-frm","us-pw-text"):"ahnlab"==a.ESVS.SecureKeyboardType&&a.bsUtil().isAhnlabProtectorUsable()&&(h=a.bsUtil().GetAhnlabEncInputInfo("us-pw-text")));if(a.CONST.__USFB_M_MOBILETOKEN.device!=l&&(!a.certsList||0>m.selectedIndex()))return a.uiUtil().msgBox(d.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),n.value="",setTimeout(function(){n.focus()},10),s(),!1;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(l)){if(!a.nimservice())return s(),!1;var g=function(){var b=parseInt(m.selectedIndex());if("DIGITAL_SIGNATURE_P7"===e.type){var g=a.certsList.list[b-1].cert;if(!g||0>=g.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;var t=a.certUtil().getTheCertAttributes(g,"Base64");f(d.IDS_MSGBOX_SIGN_ERROR,g,t,b,h,l)}else if("DIGITAL_SIGNATURE_P7_EXT"===e.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==e.type)f(d.IDS_MSGBOX_SIGN_ERROR,b,h,l,q);else if("DIGITAL_SIGNATURE_P7_XML"===e.type){g=a.certsList.list[b-1].cert;if(!g||0>=g.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;t=a.certUtil().getTheCertAttributes(g,"Base64");f(d.IDS_MSGBOX_SIGN_ERROR,t,b,h,l,g)}else if("DIGITAL_SIGNATURE_P1"===e.type){g=a.certsList.list[b-1].cert;if(!g||0>=g.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;a.usWebToolkit.x509Certificate.parser(g,"Base64");t=a.usWebToolkit.x509Certificate.getSubjectName();if(!t||0>=t.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-2),s(),!1;f(g,t,d.IDS_MSGBOX_SIGN_ERROR,b,h,l)}else if("CERT_RENEWAL"==e.type||"CERT_RENEWAL_KMCERT"==e.type){g=a.certsList.list[b-1].cert;if(!g||0>=g.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),s(),!1;a.usWebToolkit.x509Certificate.parser(g,"Base64");var k=a.usWebToolkit.x509Certificate.getNotAfter();if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),s(),!1;"CERT_RENEWAL"==e.type?f(k,c.IDS_CONFIRMBOX_CERT_RENEWAL,l,q,b,h):f(k,c.IDS_CONFIRMBOX_KMCERT_ISSUE,l,q,b,h)}else if("CERT_REVOCATION"==e.type)f(d.IDS_CONFIRMBOX_CERT_REVOCATION,b,h,l,q);else if("CERT_SOE"==e.type)f(d.IDS_CONFIRMBOX_CERT_SOE,b,h,l,q);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===e.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==e.type){k={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};g=a.certsList.list[b-1].cert;if(!g||0>=g.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;t=a.certUtil().getTheCertAttributes(g,"Base64");f(b,h,k,g,t,l);n.value=""}else if("DIGITAL_SIGNATURE_P7_FILE"===e.type){g=a.certsList.list[b-1].cert;if(!g||0>=g.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;t=a.certUtil().getTheCertAttributes(g,"Base64");f(b,h,d.IDS_MSGBOX_SIGN_ERROR,d.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,t,l)}else if("ENCRYPT_P7"==e.type)f(b,h,d.IDS_MSGBOX_ENCRYPT_ERROR);else if("VID_VERIFICATION"===e.type){g=a.certsList.list[b-1].cert;if(!g||0>=g.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;t=a.certUtil().getTheCertAttributes(g,"Base64");f(b,h,d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM",g,t,l)}else if("CERT_RENEWAL_SIGN"==e.type){g=a.certsList.list[b-1].cert;if(!g||0>=g.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),s(),!1;a.usWebToolkit.x509Certificate.parser(g,"Base64");k=a.usWebToolkit.x509Certificate.getNotAfter();if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),s(),!1;t=a.certUtil().getTheCertAttributes(g,"Base64");f(k,c.IDS_CONFIRMBOX_CERT_RENEWAL,l,q,b,h,t)}else f()};if(a.CONST.__USFB_M_MOBILETOKEN.device==l){if("DIGITAL_SIGNATURE_P7"===e.type)f(d.IDS_MSGBOX_SIGN_ERROR,null,null,-1,"",l);else if("DIGITAL_SIGNATURE_P7_EXT"===e.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==e.type)f(d.IDS_MSGBOX_SIGN_ERROR,-1,"",l,q);else if("DIGITAL_SIGNATURE_P1"===e.type)f(null,"",d.IDS_MSGBOX_SIGN_ERROR,-1,"",l);else if("CERT_RENEWAL"==e.type)f("",c.IDS_CONFIRMBOX_CERT_RENEWAL,l,q,-1,"");else if("CERT_RENEWAL_KMCERT"==e.type)f("",c.IDS_CONFIRMBOX_KMCERT_ISSUE,l,q,-1,"");else if("CERT_RENEWAL_SIGN"==e.type)f("",c.IDS_CONFIRMBOX_CERT_RENEWAL,l,q,-1,"",null);else if("CERT_REVOCATION"==e.type)f(d.IDS_CONFIRMBOX_CERT_REVOCATION,-1,"",l,q);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===e.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"===e.type){var k={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};f(-1,"",k,null,null,l)}else"DIGITAL_SIGNATURE_P7_FILE"===e.type?f(-1,"",d.IDS_MSGBOX_SIGN_ERROR,d.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,null,l):"ENCRYPT_P7"==e.type?f(-1,h,d.IDS_MSGBOX_ENCRYPT_ERROR):"VID_VERIFICATION"===e.type?f(-1,"",d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM"):"DIGITAL_SIGNATURE_P7_XML"===e.type?f(d.IDS_MSGBOX_SIGN_ERROR,null,-1,"",l,null):"CERT_SOE"==e.type?f(d.IDS_CONFIRMBOX_CERT_SOE,-1,"",l,q):"ENCRYPT_P7"==e.type?f(-1,"",d.IDS_MSGBOX_ENCRYPT_ERROR):f();n.value="";a.ESVS.Embedded&&x();return!0}var r=parseInt(m.selectedIndex());if("MPKI"==a.ESVS.PKI||l==a.CONST.__USFB_M_ETC.device||l==a.CONST.__USFB_M_HSMKEY.device||"CERT_RENEWAL"!=e.type&&"CERT_RENEWAL_SIGN"!=e.type&&"CERT_RENEWAL_KMCERT"!=e.type&&"CERT_REVOCATION"!==e.type&&"CERT_SOE"!==e.type&&"DIGITAL_SIGNATURE_P1"!==e.type&&"DIGITAL_SIGNATURE_P7"!==e.type&&"DIGITAL_SIGNATURE_P7_EXT"!=e.type&&"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"!=e.type&&"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"!==e.type&&"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"!==e.type&&"VID_VERIFICATION"!==e.type)return g(),n.value="",a.ESVS.Embedded&&x(),!0;if(!h||0>=h.length)return a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){n.focus()},10),s(),!1;a.nimservice().CheckPassword(l,q,r,h,function(c,f){if(0==c)return g(),n.value="",a.ESVS.Embedded&&x(),!0;s();"Enabled"===a.ESVS.UniCRS?a.uiUtil().errMsgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED_URS,c):a.uiUtil().errMsgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED,c);b();a.uiUtil().loadingBox(!1,"us-div-list-load")})}else if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(l)){if(!h)return a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){n.focus()},10),s(),!1;if(l==a.CONST.__PF_M_CLOUDSIGN.device)p=!0;else{if(!a.PFUC)return s(),!1;r=parseInt(m.selectedIndex());k=null;try{k=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[r].signpri)}catch(u){}var p=!1;try{p=a.usWebToolkit.pkcs8.checkUserCertPassword(k,h)}catch(B){}finally{k=""}}if(!1===p)a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),s(),b();else{p=null;l==a.CONST.__PF_M_CLOUDSIGN.device?(r=parseInt(m.selectedIndex()),p=a.certsList.list[r-1].cert):p=a.PFUC[r].signcert;if("DIGITAL_SIGNATURE_P7"===e.type){if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;var t=a.certUtil().getTheCertAttributes(p,"Base64");f(d.IDS_MSGBOX_SIGN_ERROR,p,t,r,h,l)}else if("DIGITAL_SIGNATURE_P1"===e.type){if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;t=a.certUtil().getTheCertAttributes(p,"Base64");f(p,t.subjectName,d.IDS_MSGBOX_SIGN_ERROR,r,h,l)}else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"==e.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==e.type){k={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;t=a.certUtil().getTheCertAttributes(p,"Base64");f(r,h,k,p,t,l)}else if("CERT_RENEWAL"==e.type){if(!p||0>=p.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),s(),!1;a.usWebToolkit.x509Certificate.parser(p,"Base64");k=a.usWebToolkit.x509Certificate.getNotAfter();if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),s(),!1;f(k,d.IDS_CONFIRMBOX_CERT_RENEWAL,l,q,r,h)}else"CERT_REVOCATION"===e.type?f(d.IDS_CONFIRMBOX_CERT_REVOCATION,r,h,l,q):"VID_VERIFICATION"===e.type?a.CONST.__PF_M_CLOUDSIGN.device==l?f(r,h,d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"CLOUDSIGN"):f(r,h,d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"PFS"):f();n.value="";a.ESVS.Embedded&&x();return!0}}return!1}function ma(c,b,f){if(!c||!b)return!1;V=a.loadUI("gridlist");m=V({type:"certslist",tblid:"us-tbl-list",tbltitleid:"us-tbl-list-th",titlelistid:"us-grid-head-div",titlerowid:"us-list-title-row",titleelementid:"us-list-title-element",titledividerid:"us-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-tbl-list-td",datalistid:"us-grid-body-div",datarowid:"us-list-body-row",dataelementid:"us-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row-data-selected-element",textObj:b});f=!0;"opera"==a.browserName&&(f=!1);m.drawList(c,c.length,null,0,W,f);k(l,q,b,"",function(c){0!=c?a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c):(c=u())?m.redrawList(c.list,c.list.length):m.redrawList(null,0)})}function B(c){if(!c)return!1;H(c,y,"close");for(var b=a.ESVS.Media.list.split("|"),f=0;f<b.length;f++){var d=a.CONST.medias[b[f]];if(void 0!=d&&null!=d){var e=document.getElementById("us-btn-"+d.name);if(void 0!=e&&null!=e&&"us-layout-storage-btn-none"!=e.className)if(c===e){var h=document.getElementById("us-cert-get-btn");h&&(d.device!=a.CONST.__USFB_M_HDD.device&&d.device!=a.CONST.__PF_M_LS.device&&d.device!=a.CONST.__PF_M_SS.device&&d.device!=a.CONST.__USFB_M_DISK.device?(h.style.display="none",h.style.visibility="hidden"):(h.style.display="block",h.style.visibility="visible"));e.className="us-layout-storage-btn-on"}else e.className="us-layout-storage-btn-off"}}return!0}function na(c){if(null==c||void 0==c)return!1;var b=!a.uiUtil().isItSupportingThisStorage(c);!1==b&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(c.name)&&(b=!0);if(b)return!1;var b=document.getElementById("us-storage-btn-list"),f=document.createElement("li");f.setAttribute("id","us-storage-btn-li-"+c.name,0);f.setAttribute("mediaIndex",c.mediaIndex,0);7==c.mediaIndex&&(f.className="line-first");"hidden"===c.visibility?(f.style.display="none",f.style.visibility="hidden"):(f.style.display="block",f.style.visibility="visible");var d=document.createElement("button");d.setAttribute("type","button",0);d.setAttribute("id","us-btn-"+c.name,0);d.setAttribute("tabindex",c.tabIndex,0);c.disabled?(d.onclick=function(){a.uiUtil().msgBox(y.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},d.className="us-layout-storage-btn-none"):(d.onclick=c.onclick,d.className=c.device===l?"us-layout-storage-btn-on":"us-layout-storage-btn-off");f.appendChild(d);if(!a.ESVS.chkEXESetup&&"cloudsign"!==c.name&&"webstorage"!==c.name&&"sharestorage"!==c.name){var e=document.createElement("span");e.className="us-download-select";d.appendChild(e)}e=document.createElement("span");e.className="us-img-storage";var h=document.createElement("img");h.setAttribute("id","us-img-"+c.name,0);c.disabled?h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0);e.appendChild(h);d.appendChild(e);e=document.createElement("span");e.setAttribute("id","us-lbl-"+c.name,0);e.className="us-layout-lbl-storage";e.appendChild(document.createTextNode(c.label));d.appendChild(e);f.appendChild(d);b.appendChild(f);return!0}function H(c,b,f){if("no_more"==f)a.uiUtil().msgBox(b.IDS_MSGBOX_NOT_MORE_MEDIA);else{if(c=document.getElementById("us-storage-wrap"))"open"==f?(c.className="us-layout-storage-more-wrap",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN+b.IDS_BUTTON,0),c.onclick=function(){H(this,b,"close")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(c.className="us-layout-storage-wrap",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.onclick=function(){H(this,b,"open")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));c=a.ESVS.Media.list.split("|");for(var d=0;d<c.length;d++){var e=a.CONST.medias[c[d]];if(void 0!=e&&null!=e){var h=document.getElementById("us-storage-btn-li-"+e.name);if(void 0!=h&&null!=h){var g=h.getAttribute("mediaIndex");"open"==f?(h.style.display="block",h.style.visibility="visible"):6<g?(h.style.display="none",h.style.visibility="hidden"):(h.style.display="block",h.style.visibility="visible");1==g&&document.getElementById("us-btn-"+e.name)}}}}return!0}function J(){a.ESVS._chkEXESetupCancel=!0;m.restoreOnMouseEvent();l==a.CONST.__PF_M_CLOUDSIGN.device&&closeSession();e.onCancel()}var oa=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+(a.ESVS.Embedded?"unisignweb/rsrc/layout/certselect_embedded.html?version="+a.ver:"unisignweb/rsrc/layout/certselect.html?version="+a.ver),!1);c.send(null);return c.responseText},X=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certselect_"+a.ESVS.Language+".js?version="+a.ver,!1);c.send(null);return c.responseText},y=eval(eval(X)()),V=null,m=null,U=0,r=a.ESVS.TabIndex+1,W=0,l=a.CONST.__USFB_M_HDD.device,q=0;if(null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice){l=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice);if(l==a.CONST.__USFB_M_SECUREDISK.device||l==a.CONST.__USFB_M_SMARTCARD.device||l==a.CONST.__USFB_M_DISK.device)q=1;a.SELECTINFO.curdevice=l}else 2==a.ESVS.Mode&&(l=a.CONST.__PF_M_LS.device,a.SELECTINFO.curdevice=l);var I=!1,T=null;return function(){var c=eval(oa),b=eval(eval(X)());a.ESVS.TargetObj.innerHTML=c();e.args.device&&a.uiUtil().isValidDevice(e.args.device)&&(l=e.args.device,q=e.args.drive);var f=document.getElementById("us-lbl-title");a.ESVS.Embedded?(c=document.getElementById("us-lbl-title"),c.appendChild(document.createTextNode(b.IDS_CERT_SELECTION+" "+b.IDS_CERT_SELECTION_PURPOSE_SIGN)),c.setAttribute("tabindex",r++,0),document.getElementById("us-cursor-disabled").setAttribute("tabindex",r++,0)):(f.appendChild(document.createTextNode(b.IDS_CERT_SELECTION)),f.setAttribute("tabindex",r++,0),f.setAttribute("title",b.IDS_SENSE_READER_INTRO,0),c=document.getElementById("us-cls-img-btn"),c.setAttribute("title",b.IDS_CLOSE_CERT_SELECTION_CLOSE,0),c.onclick=function(){J()},document.getElementById("us-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0),c=document.getElementById("us-logo-img"),c.setAttribute("alt",b.IDS_LOGO,0),null!=a.options.logo?c.setAttribute("src",a.options.logo,0):c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0),c=document.getElementById("us-legend-storage"),c.appendChild(document.createTextNode(b.IDS_STORAGE_SELECT)));for(var c=0,d=a.ESVS.Media.list.split("|"),k=0;k<d.length;k++){var h=d[k],g=a.CONST.medias[h];if(void 0!=g&&null!=g){switch(g.device){case a.CONST.__USFB_M_DISK.device:g.label=b.IDS_STORAGE_REMOVABLE;g.disabled=2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;L(this,b);B(this);a.SELECTINFO.curdevice=a.CONST.__USFB_M_DISK.device};break;case a.CONST.__USFB_M_HSMKEY.device:g.label=b.IDS_STORAGE_SECTOKEN;g.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;ca(this,b);B(this);a.SELECTINFO.curdevice=a.CONST.__USFB_M_HSMKEY.device};break;case a.CONST.__USFB_M_SMARTCARD.device:g.label=b.IDS_STORAGE_SAVETOKEN;g.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;if(this&&b){var c=null;l=a.CONST.__USFB_M_SMARTCARD.device;q=0;a.certsList&&(a.certsList=null);m.redrawList(null,-1);C(b);x();var c=[],d={};d.index=a.CONST.__USFB_M_SMARTCARD.device;d.name=b.IDS_SAVETOKEN_SMART_CARD;c[0]=d;c={list:c};ba(a.CONST.__USFB_M_SMARTCARD.device,c,this,b)}B(this);a.SELECTINFO.curdevice=a.CONST.__USFB_M_SMARTCARD.device};break;case a.CONST.__USFB_M_MOBILE.device:g.label=b.IDS_STORAGE_MOBILEPHONE;g.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI||e.type&&("CERT_RENEWAL"==e.type||"CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type||"CERT_REVOCATION"==e.type||"CERT_SOE"==e.type);g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;M(this,b);B(this);a.SELECTINFO.curdevice=a.CONST.__USFB_M_MOBILE.device};break;case a.CONST.__USFB_M_HDD.device:g.label=b.IDS_STORAGE_HARDDISK;g.disabled=2==a.ESVS.Mode;g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;N(this,b);B(this);a.SELECTINFO.curdevice=a.CONST.__USFB_M_HDD.device};break;case a.CONST.__USFB_M_MOBILETOKEN.device:g.label=b.IDS_STORAGE_MOBILETOKEN;g.disabled="CERT_RENEWAL"==e.type||"CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type?!0:"win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI||e.type&&("DIGITAL_SIGNATURE_P7_EXT"==e.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==e.type);g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;document.getElementById("us-div-cert-select").style.display="none";Q(this,b);B(this);a.SELECTINFO.curdevice=a.CONST.__USFB_M_MOBILETOKEN.device};break;case a.CONST.__USFB_M_SECUREDISK.device:g.label=b.IDS_STORAGE_SECUREDISK;g.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;ea(this,b);B(this);a.SELECTINFO.curdevice=a.CONST.__USFB_M_SECUREDISK.device};break;case a.CONST.__PF_M_LS.device:g.label=b.IDS_STORAGE_LS;g.disabled=1==a.ESVS.Mode;g.onclick=function(){a.ESVS._chkEXESetupCancel=!0;E(this,b);B(this);a.SELECTINFO.curdevice=a.CONST.__PF_M_LS.device};break;case a.CONST.__PF_M_SS.device:g.label=b.IDS_STORAGE_SS;g.disabled=1==a.ESVS.Mode;g.onclick=function(){a.ESVS._chkEXESetupCancel=!0;O(this,b);B(this);a.SELECTINFO.curdevice=a.CONST.__PF_M_SS.device};break;case a.CONST.__PF_M_TOUCHSIGN.device:g.label=b.IDS_STORAGE_TOUCHSIGN;g.disabled=!0;g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;F(this,b);a.SELECTINFO.curdevice=a.CONST.__PF_M_TOUCHSIGN.device};break;case a.CONST.__PF_M_SMARTSIGN.device:g.label=b.IDS_STORAGE_SMARTSIGN;g.disabled=!0;g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;F(this,b);a.SELECTINFO.curdevice=a.CONST.__PF_M_SMARTSIGN.device};break;case a.CONST.__PF_M_WEBSECTOKEN.device:g.label=b.IDS_STORAGE_WEBSECTOKEN;g.disabled=!0;g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;F(this,b);a.SELECTINFO.curdevice=a.CONST.__PF_M_WEBSECTOKEN.device};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:g.label=b.IDS_STORAGE_WEBSOFTTOKEN;g.disabled=!0;g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;F(this,b);a.SELECTINFO.curdevice=a.CONST.__PF_M_WEBSOFTTOKEN.device};break;case a.CONST.__PF_M_CLOUDSIGN.device:g.label=b.IDS_STORAGE_CLOUDSIGN;g.disabled=1==a.ESVS.Mode;g.onclick=function(){a.ESVS._chkEXESetupCancel=!0;K(this,b);B(this);a.SELECTINFO.curdevice=a.CONST.__PF_M_CLOUDSIGN.device};break;default:g.label=b.IDS_STORAGE_ETC,g.disabled=!0,g.onclick=function(){a.ESVS._chkEXESetupCancel=!1;F(this,b);a.SELECTINFO.curdevice=0}}a.ESVS.Media.option&&0>=a.ESVS.Media.option&&-1*a.ESVS.Media.option&Math.pow(2,k)&&a.ESVS.Media.defaultdevice!=h&&(g.disabled=!0);g.tabIndex=r;g.mediaIndex=c+1;g.visibility=6<g.mediaIndex?"hidden":"visible";na(g)&&(r++,c++)}}d=document.getElementById("us-storage-more-btn");null!=d&&void 0!=d&&(d.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),6<c?(d.style.display="block",d.style.visibility="visible",d.setAttribute("tabindex",r++,0),d.onclick=function(){H(this,b,"open")}):(d.setAttribute("disabled","disabled",0),d.style.display="none",d.style.visibility="hidden",d.onclick=function(){H(this,b,"no_more")}),c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));c=document.getElementById("us-tbl-list");c.style.summary=b.IDS_CERT_LIST_TABLE_SUMMARY;c.setAttribute("title",b.IDS_CERT_LIST_CAPTION);a.ESVS.Mode&2&&a.uiUtil().loadingBox(!0,"us-div-list-load",0);var s=[{title:b.IDS_CERT_STATUS},{title:b.IDS_CERT_CLASSIFY},{title:b.IDS_CERT_USER},{title:b.IDS_CERT_ISSUER},{title:b.IDS_CERT_EXPIRATION_DAY}];W=r++;setTimeout(function(){ma(s,b,e.args.list)},100);document.getElementById("us-lbl-pw").appendChild(document.createTextNode(b.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=b.IDS_PASSWORD_DESCRIPTION;document.getElementById("us-file-search-hidden").onchange=function(){ja(this,b)};c=document.getElementById("us-cert-search-btn");c.setAttribute("value",b.IDS_CERT_SEARCH,0);c.onclick=function(){if(null!=b){var c=document.getElementById("us-file-search-hidden");if("safari"==a.browserName&&6>parseFloat(a.browserVersion))a.uiUtil().msgBox(b.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_SAFARI);else{if("opera"==a.browserName||"safari"==a.browserName||"msie"==a.browserName&&8===parseInt(a.browserVersion))c.style.display="block";"safari"==a.browserName&&c.setAttribute("accept","",0);c.value="";if(""!=c.value){var d=c.onchange,f=c.parentNode;f.removeChild(c);c=document.createElement("input");c.setAttribute("type","file",0);"safari"==a.browserName?c.setAttribute("accept","",0):c.setAttribute("accept","application/x-pkcs12",0);c.setAttribute("id","us-file-search-hidden",0);c.className="us-layout-file-search-hidden";c.onchange=d;f.appendChild(c)}c.click()}}};if("CERT_RENEWAL"==e.type||"CERT_RENEWAL_SIGN"==e.type||"CERT_RENEWAL_KMCERT"==e.type)c.style.display="none",c.style.visibility="hidden";a.uiUtil().addCapsLockEvent("us-pw-text","us-err-msg-capslock",b.IDS_MSGBOX_CAPSLOCK_ON,ka);d=document.getElementById("us-pw-text");d.value="";d.setAttribute("title",b.IDS_PASSWORD_LABEL+b.IDS_PASSWORD_DESCRIPTION);a.ESVS.Embedded||(document.getElementById("enabledpw").innerHTML='<input id="us-confirm-btn" class="us-normal-btn btn-confirm h35" type="button" />');"MPKI"==a.ESVS.PKI&&(k=document.getElementById("us-lbl-pw"),h=document.getElementById("us-lbl-pw2"),k.disabled=!0,h.disabled=!0,d.readOnly=!0,d.disabled=!0);k=document.getElementById("us-confirm-btn");k.setAttribute("value",b.IDS_CONFIRM,0);k.onclick=function(){la(b)};if(h=document.getElementById("us-cert-verify-btn"))h.setAttribute("value",b.IDS_CERT_VERIFY,0),h.onclick=function(){z(this,b)};g=document.getElementById("us-cert-view-btn");g.setAttribute("value",b.IDS_CERT_VIEW,0);g.onclick=function(){A(this,b)};var u=document.getElementById("us-cert-proposal-btn");u.setAttribute("value",b.IDS_CERT_PROPOSAL,0);u.onclick=function(){this&&("firefox"==a.browserName?window.open("https://raadmin.crosscert.com/customer/tk/Main.jsp?","crosscert_url","scrollbars=1"):window.open("https://raadmin.crosscert.com/customer/tk/Main.jsp?"),this.focus())};if(0==a.ESVS.CertRequestPageEnable||"MPKI"==a.ESVS.PKI)u.readOnly=!0,u.disabled=!0;document.getElementById("us-cert-get-btn");var w=document.getElementById("us-cls-btn"),p=document.getElementById("us-cert-manage-btn");p&&(p.setAttribute("value",b.IDS_CERT_MANAGE,0),p.onclick=function(){Z(this)},p.display="block",p.visibility="visible");a.ESVS.Embedded?(d.setAttribute("tabindex",r++,0),k.setAttribute("tabindex",r++,0),c.setAttribute("tabindex",r++,0),u.setAttribute("tabindex",r++,0),g.setAttribute("tabindex",r++,0),h&&h.setAttribute("tabindex",r++,0)):(d.setAttribute("tabindex",r++,0),"none"!=document.getElementById("us-div-cert").style.display&&k.setAttribute("tabindex",r++,0),c.setAttribute("tabindex",r++,0),u.setAttribute("tabindex",r++,0),g.setAttribute("tabindex",r++,0),h&&h.setAttribute("tabindex",r++,0),"none"==document.getElementById("us-div-cert").style.display&&k.setAttribute("tabindex",r++,0),p.setAttribute("tabindex",r++,0),w.setAttribute("value",b.IDS_CLOSE,0),w.setAttribute("tabindex",r++,0),w.onclick=function(){J()},c=document.getElementById("us-lbl-notice"),c.appendChild(document.createTextNode(b.IDS_NOTICE)),"MPKI"==a.ESVS.PKI&&(c.style.visibility="hidden"));w.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(w.onblur=function(){setTimeout(function(){p.focus()},10)});9!=b||a.shiftKey||(w.onblur=function(){setTimeout(function(){f.focus()},10)})};var y=!1;f.onkeyup=function(a){a=a||window.event;9==(a.which||a.keyCode)&&a.shiftKey&&y&&(y=!1,setTimeout(function(){w.focus()},10))};f.onkeydown=function(a){a=a||window.event;if(9==(a.which||a.keyCode)&&a.shiftKey)return a.cancelBubble=!0,y=a.returnValue=!0,!1};null!=a.options.popup&&(document.getElementById("us-div-cert-select").className=document.getElementById("us-div-cert-select").className+" popup");a.ESVS.ShowGuide&&setTimeout(function(){var b=a.loadUI("guide")({onCancel:function(){b.dispose()}});b.show()},10);return document.getElementById("us-div-cert-select")}()};return function(e){function u(){function e(){0<k.value.length?k.value="":(5>u&&setTimeout(e,10),u++)}var k=document.getElementById("us-pw-text"),u=0;e();a.uiUtil().setFirstFocus("us-lbl-title");for(var z=a.ESVS.Media.list.split("|"),A=0;A<z.length;A++){var E=a.CONST.medias[z[A]];if(void 0!=E&&null!=E&&"us-layout-storage-btn-on"==document.getElementById("us-btn-"+E.name).className){a.bsUtil().SetSecurityStatus("us-pw-text");a.bsUtil().SetReScan();break}}}var k=K({type:e.type,args:e.args,onConfirm:e.onConfirm,onCancel:e.onCancel});if(!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))){e=a.uiLayerLevel;var z=a.uiUtil().getOverlay(e);k.style.zIndex=e+1;document.body.insertBefore(z,document.body.firstChild)}var A=window.onresize;return{show:function(){a.ActiveUI=this;a.ESVS.Embedded?(k.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(k,"width","width")))/2+"px",k.style.display="block"):null==a.options.popup?(draggable(k,document.getElementById("us-div-title")),z.style.display="block",a.uiUtil().offsetResize(k)):(-1<a.options.popup.indexOf("move=true")?draggable(k,document.getElementById("us-div-title")):document.getElementById("us-div-title").style.cursor="default",-1<a.options.popup.indexOf("overlay=true")&&(z.style.display="block"),a.uiUtil().offsetResize(k,a.options.popup));window.onresize=a.ESVS.Embedded?function(){k&&(k.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(k,"width","width")))/2+"px");A&&A()}:function(){k&&a.uiUtil().offsetResize(k,a.options.popup);A&&A()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;a.bsUtil().ahnlabInit();setTimeout(function(){u()},10)},hide:function(){a.ESVS.Embedded||(z.style.display="none",k.style.display="none")},dispose:function(e){!0==e&&4&a.ESVS.Mode&&a.ESVS.chkEXESetup&&a.nimservice().ClearAllUserCertList(function(a,e){});window.onresize=function(){A&&A()};!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))&&((e=k.parentNode)&&e.removeChild(k),z.parentNode&&z.parentNode.removeChild(z),a.uiLayerLevel-=10,a.ESVS.TabIndex-=30)}}}};
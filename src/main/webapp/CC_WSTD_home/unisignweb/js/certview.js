var __certview=function(a){var z=function(l){function t(a){if(!a)return alert("UI load error."),!1;var b=document.createElement("div");document.body.insertBefore(b,document.body.firstChild);b.innerHTML=a;return!0}function r(a){a=parseInt(a);var b=document.getElementById("us-view-simple"),c=document.getElementById("us-view-detail"),e=document.getElementById("us-view-certpath"),h=document.getElementById("us-view-cert-cps-btn"),k=document.getElementById("us-view-cert-confirm-btn"),g=document.getElementById("us-view-cls-img-btn");0===a?(b.style.display="block",c.style.display="none",e&&(e.style.display="none"),h.style.display="inline",v.clearList(),h.setAttribute("tabindex",m+3,0),k.setAttribute("tabindex",m+4,0),g.setAttribute("tabindex",m+5,0)):1===a?(b.style.display="none",c.style.display="block",e&&(e.style.display="none"),h.style.display="none",v.redrawList(y.list,y.list.length),h.removeAttribute("tabindex"),k.setAttribute("tabindex",m+4,0),g.setAttribute("tabindex",m+5,0)):2===a&&(b.style.display="none",c.style.display="none",e.style.display="block",h.style.display="none",k.setAttribute("tabindex",m+5,0),g.setAttribute("tabindex",m+6,0))}function p(a,b){var c=a||window.event,c=c.target||c.srcElement,e=b.getElementsByTagName("a"),h=document.getElementById("us-view-tab-simple"),k=document.getElementById("us-view-tab-detail"),g=document.getElementById("us-view-tab-certpath");for(nTab in e)if(c==e[nTab]){isNaN(nTab)&&("us-view-tab-simple"==nTab?nTab=0:"us-view-tab-detail"==nTab?nTab=1:"us-view-tab-certpath"==nTab&&(nTab=2));0==nTab?(h.className="us-view-tab-tag active",k.className="us-view-tab-tag",g&&(g.className="us-view-tab-tag")):1==nTab?(h.className="us-view-tab-tag",k.className="us-view-tab-tag active",g&&(g.className="us-view-tab-tag")):2==nTab&&(h.className="us-view-tab-tag",k.className="us-view-tab-tag",g.className="us-view-tab-tag active");r(nTab);break}}function u(f,b,c,e){var h=null;a.usWebToolkit.x509Certificate.parser(e,c);e=a.usWebToolkit.x509Certificate.getVersion();var h=a.usWebToolkit.x509Certificate.getSerialNumber(),k=a.usWebToolkit.x509Certificate.getSignAlgo(),g=a.usWebToolkit.x509Certificate.getIssuerName(),x=a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotBefore()),p=a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotAfter()),d=a.usWebToolkit.x509Certificate.getSubjectName(),F=a.usWebToolkit.x509Certificate.getPublickey(),A=a.usWebToolkit.x509Certificate.getAuthorityKeyIndentifier(),G=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier(),B=a.usWebToolkit.x509Certificate.getKeyUsage(),C=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),H=a.usWebToolkit.x509Certificate.getSubjectAltName(),l=a.usWebToolkit.x509Certificate.getAuthorityInfoAccess(),r=a.usWebToolkit.x509Certificate.getcRLDistributionPoints(),s=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS(),q=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice(),s="";try{s=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS()}catch(u){}q="";try{q=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(w){}var t=a.usWebToolkit.x509Certificate.getSignature();c=[];c[0]=e;c[1]=h;c[2]=k;c[3]=g;c[4]=x;c[5]=p;c[6]=d;c[7]=F;"MPKI"==a.ESVS.PKI?(c[8]=B,c[9]=C,c[10]=r,c[11]=t):(c[8]=A,c[9]=G,c[10]=B,c[11]=C,c[12]=H,c[13]=l,c[14]=r,c[15]=s,c[16]=q,c[17]=t);e=[];for(h=0;h<c.length;h++)k=[],k[0]=b[h].field,k[1]=c[h],e[h]=k;y=h={list:e};D=a.loadUI("gridlist");v=D({type:"detailslist",tblid:"us-view-tbl-list",tbltitleid:"us-view-tbl-list-th",titlelistid:"us-view-grid-head-div",titlerowid:"us-view-list-title-row",titleelementid:"us-view-list-title-element",titledividerid:null,titlelistcn:"us-layout-view-grid-head-div",titlerowcn:"us-layout-view-grid-head-row",titleelementcn:"us-layout-view-grid-row-title-element",titledividercn:null,tblbodyid:"us-view-tbl-list-td",datalistid:"us-view-grid-body-div",datarowid:"us-view-list-body-row",dataelementid:"us-view-list-data-element",datalistcn:"us-layout-view-grid-body-div",datarowcn:"us-layout-view-grid-body-row",dataelementcn:"us-layout-view-grid-row-data-element",dataselectcn:"us-layout-view-grid-row-data-selected-element",textboxid:"us-view-detail-text-box"});v.drawTitle(f,f.length,m+3,!1)}function s(f,b,c,e,h){if(!f||0>=b||!c||!e)return!1;var k=document.getElementById("us-view-cert-status-img"),g=document.getElementById("us-view-cert-status-msg"),x=-1;if(4==a.ESVS.Mode)a.nimservice()?a.nimservice().VerifyCertificate(b,1,function(b,c){if(0===b)q=!0,k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_valid.png",0),g.appendChild(document.createTextNode(e.IDS_CERT_STATUS_VALID));else switch(q=!1,k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),b){case 3005:g.appendChild(document.createTextNode(e.IDS_CERT_STATUS_EXPIRED));break;case 3016:case 3017:case 3900:case 3901:case 3902:case 3903:case 3904:case 3905:case 3906:case 3907:case 3908:case 3909:case 3999:g.appendChild(document.createTextNode(e.IDS_CERT_STATUS_REVOKED));__RevokedStatus=!0;break;case 4212E4:g.appendChild(document.createTextNode(e.IDS_CERT_STATUS_EXPIRED));__RevokedStatus=!0;break;default:g.appendChild(document.createTextNode(e.IDS_CERT_STATUS_INVALID))}h(0)}):(a.uiUtil().msgBox(__lang.IDS_MSGBOX_NIM_ERROR_UNLOAD),rv=-1,h(-1));else if(2&a.ESVS.Mode){b=null;try{var m=a.usWebToolkit.pki.createCaStore();b=a.PFSH.GetCACerts();for(var d in b)caCert=b[d],m.addCertificate(a.usWebToolkit.pki.certificateFromBase64(caCert));var p=a.usWebToolkit.pki.certificateFromBase64(c);a.usWebToolkit.pki.verifyCertificateChain(m,p,function(b,c,d){null!=k&&null!=g&&(!0===b?(x=0,k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_valid.png",0),g.appendChild(document.createTextNode(e.IDS_CERT_STATUS_VALID)),q=!0):(x=-1,k.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),null!=d&&void 0!=d&&0<=d.indexOf("Certificate is not valid yet or has expired")?g.appendChild(document.createTextNode(e.IDS_CERT_STATUS_EXPIRED)):null!=d&&void 0!=d&&0<=d.indexOf("no parent issuer, so certificate not trusted")?g.appendChild(document.createTextNode(e.IDS_CERT_STATUS_ISSUER_FAIL)):g.appendChild(document.createTextNode(d)),q=!1),h(x))})}catch(A){}}(function(){a.usWebToolkit.x509Certificate.parser(c,f);document.getElementById("us-view-cert-subject-name-data").appendChild(document.createTextNode(a.certUtil().getCN(a.usWebToolkit.x509Certificate.getSubjectName())));var b=document.getElementById("us-view-cert-issuer-name-data"),d=a.certUtil().getCN(a.usWebToolkit.x509Certificate.getIssuerName());if(""==d||"undefined"==d)d=a.certUtil().getO(a.usWebToolkit.x509Certificate.getIssuerName());b.appendChild(document.createTextNode(d));document.getElementById("us-view-cert-validity-date-from").appendChild(document.createTextNode(a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotBefore())));document.getElementById("us-view-cert-validity-date-to").appendChild(document.createTextNode(a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotAfter())));b=document.getElementById("us-view-cert-purpose");d=null;try{d=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(e){}null!=d&&b.appendChild(document.createTextNode(d));b=document.getElementById("us-view-cert-cps-btn");"MPKI"==a.ESVS.PKI&&(b.readOnly=!0,b.disabled=!0);b.onclick=function(){var b=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS();"firefox"==a.browserName?window.open(b,"cps_url","scrollbars=1"):window.open(b);this.focus()}})();return!0}function w(a){if(null==a||0==a.length)return"";for(var b=a.length,c="",e=0,h=b;e<b;e++,h--)0==h%4&&h!=b&&(c+=" "),c+=a.charAt(e);return c.toUpperCase()}function E(f,b,c,e,h){function k(a,b){var d=document.getElementById(a);d&&d.appendChild(document.createTextNode(b))}function g(a,b){var d=document.createElement("li");!0==a?d.setAttribute("class","valid"):!1==a?d.setAttribute("class","invalid"):null!=a?d.setAttribute("class",a):d.appendChild(document.createTextNode(b));return d}function m(b,d){var c=null;if(null==b||0>=b.length)return null;var e=a.usWebToolkit.x509Certificate.parser(b,d),e=a.usWebToolkit.asn1.fromDer(e.getExtension("authorityKeyIdentifier").value),f=a.usWebToolkit.util.bytesToHex(e.value[0].value);e.value[2]&&(f+="_"+parseInt(a.usWebToolkit.util.bytesToHex(e.value[2].value),16));caCerts=a.PFSH.GetCACerts();for(var g in caCerts)g.toUpperCase()==f.toUpperCase()&&(c=caCerts[g]);return c}function p(b,h,m){try{a.usWebToolkit.x509Certificate.parser(h,f);d.appendChild(g(!0));d.appendChild(g(null,a.usWebToolkit.x509Certificate.getSubjectName()));k("us-view-certpath-version",e.IDS_CERT_PATH_ROOTCA_VERSION);k("us-view-certpath-version-data",a.usWebToolkit.x509Certificate.getVersion());k("us-view-certpath-date",e.IDS_CERT_PATH_ROOTCA_VALIDDATE);k("us-view-certpath-date-from",a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotBefore()));k("us-view-certpath-date-to",a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotAfter()));a.usWebToolkit.x509Certificate.parser(b,f);d.appendChild(g("dot"));d.appendChild(g(!0));d.appendChild(g(null,a.usWebToolkit.x509Certificate.getSubjectName()));a.usWebToolkit.x509Certificate.parser(c,f);d.appendChild(g("dot2"));d.appendChild(g(q));d.appendChild(g(null,a.usWebToolkit.x509Certificate.getSubjectName()));var l=w(m);if(null==l||0==l.length)l="  ";k("us-view-certpath-hash",e.IDS_CERT_PATH_NOTICE);k("us-view-certpath-hash-data",l);k("us-view-certpath-tail",e.IDS_CERT_PATH_ROOTHASH_URL);k("us-view-certpath-tail",e.IDS_CERT_PATH_ROOTHASH_URL2);k("us-view-certpath-tail",e.IDS_CERT_PATH_ROOTHASH_URL3);document.getElementById("us-view-certpath-tail").onclick=function(){window.open(e.IDS_CERT_PATH_ROOTHASH_LINK,"ca_hash","scrollbars=1;width=650;height=460;")}}catch(s){a.usWebToolkit.x509Certificate.parser(c,f),d&&d.appendChild(g(q)),d&&d.appendChild(g(null,a.usWebToolkit.x509Certificate.getSubjectName()))}}"MPKI"==a.ESVS.PKI&&h();if(4&a.ESVS.Mode&&!a.nimservice())a.uiUtil().msgBox(e.IDS_MSGBOX_NIM_ERROR_UNLOAD);else{var d=document.getElementById("us-view-certpath-info-tree");if(2&a.ESVS.Mode){var l=b=null;b=m(c,f);l=m(b,f);null!=b&&null!=l?p(b,l):(a.usWebToolkit.x509Certificate.parser(c,f),d&&d.appendChild(g(q)),d&&d.appendChild(g(null,a.usWebToolkit.x509Certificate.getSubjectName())));h()}else 4&a.ESVS.Mode&&a.nimservice().GetCACertificates(b,function(b,e,k,l,m){a.uiUtil().loadingBox(!1,"us-div-list-load");null!=d&&(0==b?p(k,l,m):(a.usWebToolkit.x509Certificate.parser(c,f),d&&d.appendChild(g(q)),d&&d.appendChild(g(null,a.usWebToolkit.x509Certificate.getSubjectName()))),h())})}}var z=function(){var f;f=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");"MPKI"==a.ESVS.PKI?f.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certview_verisign.html?version="+a.ver,!1):f.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certview.html?version="+a.ver,!1);f.send(null);return f.responseText},I=function(){var f;f=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");f.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certview_"+a.ESVS.Language+".js?version="+a.ver,!1);f.send(null);return f.responseText},D=null,v=null,y=null,q=!0,m=a.ESVS.TabIndex;return function(){var f=eval(z),b=eval(eval(I)()),c=l.args.type,e=l.args.idx,h=l.args.cert;t(f());var k=document.getElementById("us-view-lbl-title");k.appendChild(document.createTextNode(b.IDS_CERT_VIEW));k.setAttribute("tabindex",m,0);f=document.getElementById("us-view-tab");f.onclick=function(a){p(a?a:event,this)};f.onkeydown=function(a){if((a=a?a:event)&&this){var b=a||window.event;13==(b.which||b.keyCode)&&p(a,this)}};var g=document.getElementById("us-view-tab-simple");g.setAttribute("tabindex",m+1,0);g.appendChild(document.createTextNode(b.IDS_CERT_SIMPLE_VIEW));document.getElementById("us-view-simple").setAttribute("tabindex",m+2,0);f=document.getElementById("us-view-tab-detail");f.appendChild(document.createTextNode(b.IDS_CERT_DETAIL_VIEW));f.setAttribute("tabindex",m+3,0);if(f=document.getElementById("us-view-tab-certpath"))f.appendChild(document.createTextNode(b.IDS_CERT_PATH_VIEW)),f.setAttribute("tabindex",m+4,0);document.getElementById("us-view-cert-info").appendChild(document.createTextNode(b.IDS_CERT_INFO));document.getElementById("us-view-cert-subject-name").appendChild(document.createTextNode(b.IDS_CERT_SUBJECT_NAME));document.getElementById("us-view-cert-issuer-name").appendChild(document.createTextNode(b.IDS_CERT_ISSUER_NAME));document.getElementById("us-view-cert-validity-date").appendChild(document.createTextNode(b.IDS_CERT_VALIDITY_DATE));f=document.getElementById("us-view-cert-cps-btn");f.setAttribute("value",b.IDS_CERT_SUPPLEMENT_INFO,0);f.style.display="none";var q=document.getElementById("us-view-cert-confirm-btn");q.setAttribute("value",b.IDS_CERT_CONFIRM,0);q.onclick=function(){v.restoreOnMouseEvent();l.onCancel()};f=document.getElementById("us-view-cls-img-btn");f.setAttribute("alt",b.IDS_CERT_VIEW_CLOSE,0);f.onclick=function(){v.restoreOnMouseEvent();l.onCancel()};f.onfocus=function(){k.focus()};document.getElementById("us-view-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/x-btn.png",0);u([{title:b.IDS_CERT_FIELD},{title:b.IDS_CERT_VALUE}],"MPKI"==a.ESVS.PKI?[{field:b.IDS_CERT_VERSION},{field:b.IDS_CERT_SERIAL_NUMBER},{field:b.IDS_CERT_SIGN_ALGOLISM},{field:b.IDS_CERT_ISSUER},{field:b.IDS_CERT_VALIDATE_FROM},{field:b.IDS_CERT_VALIDATE_TO},{field:b.IDS_CERT_SUBJECT},{field:b.IDS_CERT_PUBLIC_KEY},{field:b.IDS_CERT_KEY_USAGE},{field:b.IDS_CERT_POLICY},{field:b.IDS_CERT_CRL_DISTRIBUTE_POINTS},{field:b.IDS_CERT_SIGNATURE}]:[{field:b.IDS_CERT_VERSION},{field:b.IDS_CERT_SERIAL_NUMBER},{field:b.IDS_CERT_SIGN_ALGOLISM},{field:b.IDS_CERT_ISSUER},{field:b.IDS_CERT_VALIDATE_FROM},{field:b.IDS_CERT_VALIDATE_TO},{field:b.IDS_CERT_SUBJECT},{field:b.IDS_CERT_PUBLIC_KEY},{field:b.IDS_CERT_AUTHORITY_KEY_IDENTIFIER},{field:b.IDS_CERT_SUBJECT_KEY_IDENTIFIER},{field:b.IDS_CERT_KEY_USAGE},{field:b.IDS_CERT_POLICY},{field:b.IDS_CERT_SUBJECT_ALT_NAME},{field:b.IDS_CERT_AUTHORITY_INFO_ACCESS},{field:b.IDS_CERT_CRL_DISTRIBUTE_POINTS},{field:b.IDS_CERT_CPS},{field:b.IDS_CERT_PURPOSE},{field:b.IDS_CERT_SIGNATURE}],c,h);4&a.ESVS.Mode?s(c,e,h,b,function(a){E(c,e,h,b,function(a){})}):2&a.ESVS.Mode?s(c,e,h,b,function(a){E(c,e,h,b,function(a){})}):(s(c,e,h,b),document.getElementById("us-view-tab3").style.display="none");q.onkeydown=function(a){a=a||window.event;q.onblur=9!=(a.which||a.keyCode)||a.shiftKey?function(){setTimeout(function(){g.focus()},10)}:function(){setTimeout(function(){k.focus()},10)}};var w=!1;k.onkeyup=function(a){a=a||window.event;9==(a.which||a.keyCode)&&a.shiftKey&&w&&(w=!1,setTimeout(function(){q.focus()},10))};k.onkeydown=function(a){a=a||window.event;if(9==(a.which||a.keyCode)&&a.shiftKey)return a.cancelBubble=!0,w=a.returnValue=!0,!1};r(0);return document.getElementById("us-div-cert-view")}()};return function(l){var t=a.uiLayerLevel,r=a.uiUtil().getOverlay(t),p=z({type:l.type,args:l.args,onConfirm:l.onConfirm,onCancel:l.onCancel});p.style.zIndex=t+1;a.ESVS.TargetObj.insertBefore(r,a.ESVS.TargetObj.firstChild);var u=window.onresize;return{show:function(){a.ActiveUI=this;draggable(p,document.getElementById("us-div-view-title"));r.style.display="block";a.uiUtil().offsetResize(p);window.onresize=function(){a.uiUtil().offsetResize(p);u&&u()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;setTimeout(function(){var a=p.getElementsByTagName("p");if(0<a.length)for(var l=0;l<a.length;l++)"us-view-lbl-title"==a[l].id&&a[l].focus()},10)},hide:function(){r.style.display="none";p.style.display="none"},dispose:function(){window.onresize=function(){u&&u()};p.parentNode.parentNode.removeChild(p.parentNode);r.parentNode.removeChild(r);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}};
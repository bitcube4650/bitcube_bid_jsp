var __certmanage=function(a){var P=function(m){function t(){if(!a.certsList)return null;for(var b=null,b=a.certsList,c=b.list.length,d=[],e=[],f=0;f<c;f++){a.usWebToolkit.x509Certificate.parser(b.list[f].cert,"Base64");var l=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),p=a.usWebToolkit.x509Certificate.getSubjectName(),h=a.usWebToolkit.x509Certificate.getNotAfter(),g=a.usWebToolkit.x509Certificate.getNotAfter(),r=b.list[f].index,k=a.certUtil().getIssuerName(l);"undefined"==k&&(k=a.certUtil().getO(p));var w=[""];w[1]=a.certUtil().getCertType(l);w[2]=a.certUtil().getCN(p);w[3]=k;w[4]=a.certUtil().getLocalDate(h);w[5]=r;w[6]=a.certUtil().getExpirationStateValue(g);"crosscert"==a.certUtil().getO(p).toLowerCase()?d.push(w):e.push(w)}return b={list:d.concat(e)}}function s(b,c,d,e,f){if(a.CONST.__USFB_M_DISK.device>b||0>c||!d)return-1;var l=0,p=0;q=c;a.certsList&&(a.certsList=null);if(a.CONST.__PF_M_LS.device===b){a.PFSH||f(-1);try{a.PFSH.SelectStorage(1)}catch(h){}try{a.PFSH.LoadAllCerts(document.domain)}catch(g){301E5===g.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}c=null;try{c=a.PFSH.GetUserCerts(document.domain),a.PFUC=c}catch(r){a.uiUtil().errMsgBox(r.message,r.code)}null!=c&&void 0!=c&&void 0!=c.length&&(l=c.length-1);if(0<l){e=[];for(var D=0;D<l;D++){var w=D+1,x={};x.index=w;x.cert=c[w].signcert;x.path="webstorage";e[D]=x}a.certsList={list:e}}else a.certsList=null,p=0;f(p)}else if(b==a.CONST.__PF_M_SS.device&&a.CCPFSH())a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(c,b){0==c&&a.CCPFSH().GetCertificateList(function(c,b){if(0==c){var d=0;(a.PFUC=b)&&(d=b.length-1);if(0<d){for(var h=[],e=0;e<d;e++){var l=e+1,r={};r.index=l;r.cert=b[l].signcert;r.path="sharestorage";h[e]=r}a.certsList={list:h}}}f(c)})});else if(b==a.CONST.__PF_M_CLOUDSIGN.device){if(m.CS_phoneNumber)s(m.CS_phoneNumber);else{var n=a.loadUI("phoneNumber")({type:"phoneNumber",args:null,onConfirm:function(a){__PhoneNumber=a;s(a);n.dispose()},onCancel:function(){n.dispose()}});n.show()}var s=function(c){a.uiUtil().loadingBox(!0,"us-div-list-load",0);reqMemberInfo(c,function(b,h,e){if(0!=b)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),alert(h+"\n\nError Code [ "+b+" ]"),f(b),!1;b=parseInt(e.split("|")[0]);0<b?$(c):(-1==b?(a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.ERROR.Code=11004,a.ERROR.Message=d.IDS_MSGBOX_DOUBLE):(a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.ERROR.Code=11005,a.ERROR.Message=d.IDS_MSGBOX_JOIN),f(a.ERROR.Code))})},$=function(c){reqGetCert(c,"MANAGEMENT",function(c,b,d){if(0!=c)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.uiUtil().errMsgBox(b,c),f(c),!1;if(0<d.length){b=[];for(var h=0;h<d.length;h++){var e={};e.index=h+1;e.cert=d[h];e.path="cloud";b[h]=e}a.certsList={list:b}}f(c);a.uiUtil().loadingBox(!1,"us-div-list-load",0);return!0})}}else!a.uiUtil().isItPFDevice(b)&&4&a.ESVS.Mode?a.nimservice()?a.nimservice().GetAllUserCertListNum(b,c,e,function(c,h,e){if(k!=b)return!1;l=e;if(0==c)0<l?a.nimservice().GetAllUserCert(e,function(c,b){0==c?a.certsList={list:b}:win&&"none"!=win.style.display&&a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),c);a.uiUtil().loadingBox(!1,"us-div-list-load");f(c)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),f(0));else{if(b==a.CONST.__USFB_M_MOBILE.device&&61E6==c)return a.ERROR.Code=11003,a.ERROR.Message=d.IDS_MSGBOX_NOT_INSTALL_MOBILE,confirm(d.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)?(document.getElementById("us-cert-manage-cls-btn").click(),c="firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),null==c&&a.uiUtil().msgBox(d.IDS_MSGBOX_BLOCK_POPUP_WINDOW),a.certsList=null,f(-1)):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),f(0)),!1;if(b==a.CONST.__USFB_M_SECUREDISK.device&&8005E4==c)return a.ERROR.Code=31001,a.ERROR.Message=d.IDS_MSGBOX_NOT_INSTALL_SD,confirm(d.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(c="firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"),null==c&&a.uiUtil().msgBox(d.IDS_MSGBOX_BLOCK_POPUP_WINDOW)),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,f(-1),!1;-1!==l&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());f(-1);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(a.uiUtil().msgBox(d.IDS_MSGBOX_NIM_ERROR_UNLOAD),f(-1)):f(p)}function z(b,c){if(!b||!c)return!1;if(!a.certsList)return a.uiUtil().msgBox(c.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var d=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(g.selectedIndex()),cert:a.certsList.list[parseInt(g.selectedIndex())-1].cert},onConfirm:function(){d.dispose();b.focus()},onCancel:function(){d.dispose();b.focus()}});d.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function M(b,c){4&a.ESVS.Mode&&(SSDialog=a.loadUI("storageselect")({type:"CERT_COPY",args:{drivetype:"BACKUP_DRIVE"},onConfirm:function(d,e){SSDialog.dispose();certlistDialog=a.loadUI("certlistui")({type:"BACKUPED_CERT",args:{device:k,dn:""},onConfirm:function(d){if(0>=d)return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_RECOVER_ERROR),!1;PWDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(b){PWDialog.dispose();a.nimservice().RecoverFromUSB(1,d,b,function(d,h,e){certlistDialog.dispose();0==d?s(k,1,c,"",function(d){(d=t())?g.redrawList(d.list,d.list.length):g.redrawList(null,0);b="";a.uiUtil().loadingBox(!1,"us-div-list-load");a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_RECOVER_SUCCESS)}):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_RECOVER_ERROR))})},onCancel:function(){PWDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){b.dispose()},10)}});PWDialog.show()},onCancel:function(){certlistDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg()}});certlistDialog.show();a.uiUtil().loadingBox(!1,"us-div-cert-list-load")},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");SSDialog.dispose()}}),SSDialog.show())}function aa(b,c){function d(c,b,d){a.nimservice().BackupToUSB(c,b,d,function(c,b){0===c?a.uiUtil().msgBox(f.IDS_MSGBOX_CERT_BACKUP_SUCCESS):a.uiUtil().errMsgBox(f.IDS_MSGBOX_CERT_BACKUP_ERROR,c);d="";a.uiUtil().loadingBox(!1,"us-div-list-load")})}function e(c,b,e){PWDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(c){PWDialog.dispose();var f=parseInt(g.selectedIndex());a.nimservice().CheckPassword(k,q,f,c,function(l,p){0==l?(SSDialog=a.loadUI("storageselect")({type:"CERT_COPY",args:{drivetype:"BACKUP_DRIVE"},onConfirm:function(a,b){SSDialog.dispose();d(f,b,c)},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");SSDialog.dispose();b.focus()}}),SSDialog.show()):(c="",a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){b.dispose()},10))})},onCancel:function(){PWDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){b.dispose()},10)}});PWDialog.show()}var f=c,l=null;if(!a.certsList||0>=parseInt(g.selectedIndex()))return a.uiUtil().msgBox(f.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetBackupedDriveList(function(c,d,g){var r=g.length;if(0==c)if(0<r){c=[];for(d=0;d<r;d++){var k={};k.index=d+1;k.name=g[d];c[d]=k}l={list:c}}else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(f.IDS_MSGBOX_NO_BACKDRIVE),!1;else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(d,c),!1;e(l,b,f)});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1}function Q(b,c,d){function e(c,b,d,e,l){if(a.CONST.__USFB_M_DISK.device===b||a.CONST.__USFB_M_HDD.device===b||a.CONST.__USFB_M_MOBILE.device===b||a.CONST.__USFB_M_SECUREDISK.device===b||a.CONST.__USFB_M_MOBILETOKEN.device===b)f(c,e,b,d,0),e="";else if(a.CONST.__USFB_M_HSMKEY.device===b||a.CONST.__USFB_M_SMARTCARD.device===b){var g=null,g=a.CONST.__USFB_M_SMARTCARD.device===b?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN";PINDialog=a.loadUI("pin")({type:g,args:null,onConfirm:function(a){f(c,e,b,d,a,l);e="";PINDialog.dispose()},onCancel:function(){e="";PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load")}});PINDialog.show()}else e="",a.uiUtil().loadingBox(!1,"us-div-list-load")}function f(c,b,e,f,g,k){1>c||a.CONST.__USFB_M_DISK.device>e||0>f||null==b||0>=b.length?a.uiUtil().loadingBox(!1,"us-div-list-load"):e==a.CONST.__USFB_M_HSMKEY.device?a.nimservice().EnvelopData("kmcert",c,b,null,"abcdefghijklmnopqrstuvwxyz1234567890",1,function(m,n,q){4503E4==m&&a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_INFO_NO_KMCERT);a.nimservice().CopyCert(c,b,e,f,g,function(e,f){if(0===e)a.uiUtil().msgBox(l.IDS_MSGBOX_CERT_COPY_SUCCESS),d&&d(0,k,a.certUtil().getTheCertAttributes(a.certsList.list[c-1].cert,"Base64"));else switch(e){case 4823E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4013E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_LOW_PERFORM_MEDIA);break;case 4844E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:var g=a.nimservice().GetLastErrorMessage(),g=l.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+g;a.uiUtil().msgBox(g);break;default:g=a.nimservice().GetLastErrorCode(),a.uiUtil().errMsgBox(f?f:l.IDS_MSGBOX_CERT_COPY_ERROR,g)}b="";a.uiUtil().loadingBox(!1,"us-div-list-load")})}):a.nimservice().CopyCert(c,b,e,f,g,function(c,e){if(0===c)a.uiUtil().msgBox(l.IDS_MSGBOX_CERT_COPY_SUCCESS),d&&d(0);else switch(c){case 4823E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4013E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_LOW_PERFORM_MEDIA);break;case 4844E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:var f=a.nimservice().GetLastErrorMessage(),f=l.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+f;a.uiUtil().msgBox(f);break;default:f=a.nimservice().GetLastErrorCode(),a.uiUtil().errMsgBox(e?e:l.IDS_MSGBOX_CERT_COPY_ERROR,f)}b="";a.uiUtil().loadingBox(!1,"us-div-list-load")})}if(!b||!c)return!1;var l=c;if(!a.certsList)return a.uiUtil().msgBox(l.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;a.uiUtil().loadingBox(!0,"us-div-list-load",5);Dialog=a.loadUI("storageselect")({type:"CERT_COPY",args:{sourceDevice:k,sourceDrive:q},onConfirm:function(c,b,d){Dialog.dispose();PWDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(f){PWDialog.dispose();if(a.nimservice()){var m=parseInt(g.selectedIndex());a.CONST.__USFB_M_SMARTCARD.device!=k?a.nimservice().CheckPassword(k,q,m,f,function(g,k){0==g?e(m,c,b,f,d):(f="",a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD),a.uiUtil().loadingBox(!1,"us-div-list-load"))}):e(m,c,b,f)}else f="",a.uiUtil().msgBox(l.IDS_MSGBOX_NIM_ERROR_UNLOAD),PWDialog.dispose(),a.uiUtil().loadingBox(!1,"us-div-list-load")},onCancel:function(){PWDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load")}});PWDialog.show()},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");b.focus()}});Dialog.show();return!0}function R(b,c,d){if(!b||!c)return!1;if(!a.certsList)return a.uiUtil().msgBox(c.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;Dialog=a.loadUI("changepassword")({type:null,args:null,onConfirm:function(b,f){Dialog.dispose();if(null==b||0>=b.length||null==f||0>=f.length)return a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),!1;var l=parseInt(g.selectedIndex());if(1>l)return a.uiUtil().msgBox(c.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;if(a.uiUtil().isItPFDevice(k))try{var p=a.PFUC[l],h,m;h=m=null;var r=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(p.signpri),n=a.usWebToolkit.pkcs8.checkUserCertPassword(r,b);if(!1===n){var r=null,w={code:-1,message:c.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD};throw w;}h=a.usWebToolkit.pkcs8.changePassword(r,b,f,"Base64");r=null;if("undefined"!==typeof p.kmcert){r=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(p.kmpri);n=a.usWebToolkit.pkcs8.checkUserCertPassword(r,b);if(!1===n)throw r=null,w={code:-1,message:c.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD},w;m=a.usWebToolkit.pkcs8.changePassword(r,b,f,"Base64")}r=null;try{var x={};x.signcert=p.signcert;x.signpri=h;null!==m&&(x.kmcert=p.kmcert,x.kmpri=m);a.CONST.__PF_M_LS.device===k?(a.PFSH.SaveUserCert(p.ca,x,document.domain,!1),p=x=null,s(k,q,c,"",function(b){(b=t())?g.redrawList(b.list,b.list.length):g.redrawList(null,0);a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS)})):a.CCPFSH().SaveUserCert(p.ca,x,!1,function(b){0==b?(p=x=null,s(k,q,c,"",function(b){(b=t())?g.redrawList(b.list,b.list.length):g.redrawList(null,0);a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS)})):a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,b)})}catch(y){switch(y.code){case 1E7:0<=y.detail.indexOf("115010")?a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,y.detail);break;default:a.uiUtil().errMsgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,y.code);break}}finally{}}catch(u){a.uiUtil().errMsgBox(u.message,u.code)}finally{}else a.nimservice()?(l=parseInt(g.selectedIndex()),a.nimservice().CheckPassword(k,q,l,b,function(h,g){0===h?a.nimservice().ChangePassword(l,b,f,function(b,e){if(0===b)a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS),d&&d(0);else{var f=a.nimservice().GetLastErrorCode();a.uiUtil().errMsgBox(""==e?c.IDS_MSGBOX_CERT_CHANGE_PW_ERROR:e,f)}a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(c.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD))})):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD))},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PW_CANCEL);Dialog.dispose()}});Dialog.show()}function S(b,c,d){function e(b){a.certsList&&(a.certsList=null);s(k,q,p,"",function(a){(a=t())?g.redrawList(a.list,a.list.length):g.redrawList(null,0)});a.uiUtil().msgBox(p.IDS_MSGBOX_CERT_DELETE_SUCCESS);d&&d(0)}function f(b){var c=parseInt(g.selectedIndex());if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k))a.nimservice()?a.CONST.__USFB_M_HSMKEY.device!=k?a.nimservice().CheckPassword(k,q,c,b,function(d,e){0===d?l(c,b,null):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(p.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED,d))}):l(c,b,null):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(p.IDS_MSGBOX_NIM_ERROR_UNLOAD));else{if(a.CONST.__PF_M_LS.device===k&&!a.PFUC||a.CONST.__PF_M_SS.device===k&&!a.CCPFSH())return b="",!1;try{var d=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),e=a.usWebToolkit.pkcs8.checkUserCertPassword(d,b),d="";!1===e?a.uiUtil().msgBox(p.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):l(c,b,null)}catch(f){a.uiUtil().errMsgBox(f.message,f.code)}finally{}a.uiUtil().loadingBox(!1,"us-div-list-load")}}function l(b,c,d){if("MPKI"==a.ESVS.PKI){if(1>b)return a.uiUtil().loadingBox(!1,"us-div-list-load"),!1}else if(1>b||null==c||0>=c.length)return a.uiUtil().loadingBox(!1,"us-div-list-load"),d&&d.dispose(),!1;if(a.CONST.__PF_M_LS.device===k){try{a.PFSH.DeleteUserCertByIndex(b,document.domain),e(c),d&&d.dispose(),c=""}catch(f){return a.uiUtil().errMsgBox(p.IDS_MSGBOX_CERT_DELETE_ERROR,f.code),c="",d&&d.dispose(),!1}finally{}a.uiUtil().loadingBox(!1,"us-div-list-load")}else a.CONST.__PF_M_SS.device===k?a.CCPFSH().DeleteUserCertByIndex(b,function(b,f){0==b?e(c):a.uiUtil().msgBox(p.IDS_MSGBOX_CERT_DELETE_ERROR,b);d&&d.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load")}):a.nimservice().DeleteCert(b,c,function(b,f){a.uiUtil().loadingBox(!1,"us-div-list-load");d&&d.dispose();if(0===b)e(c);else{c="";switch(b){case 4823E4:a.uiUtil().msgBox(p.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(p.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4904E4:a.uiUtil().msgBox(p.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(p.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:var h=a.nimservice().GetLastErrorCode();a.uiUtil().errMsgBox(p.IDS_MSGBOX_CERT_DELETE_ERROR,h)}return!1}});return!0}if(!b||!c)return!1;var p=c;if(!a.certsList)return a.uiUtil().msgBox(p.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;if(confirm(p.IDS_CONFIRMBOX_WARNING_DELETE_CERT))if("MPKI"==a.ESVS.PKI)c=parseInt(g.selectedIndex()),l(c,"",null);else{c=null;c=a.CONST.__USFB_M_HSMKEY.device===k?a.loadUI("pin"):a.loadUI("password");var h=c({type:null,args:null,onConfirm:function(a){h.dispose();f(a)},onCancel:function(){h.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){b.dispose()},10)}});h.show()}else setTimeout(function(){b.dispose()},10);return!0}function T(b,c){if(null==b)return!1;a.uiUtil().loadingBox(!0,"us-div-list-load");if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else{var d=a.loadUI("importcert")({type:"importcert",args:null,onConfirm:function(b,c){"MPKI"==a.ESVS.PKI?U(a.CONST.__USFB_M_HDD.device,0,b,c):(SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:null,onConfirm:function(l,g){SSDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");d.dispose();U(l,g,b,c)},onCancel:function(){pw="";SSDialog.dispose()}}),SSDialog.show())},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_IMPORT_CANCEL);d.dispose()}});d.show()}return!0}function U(b,c,d,e){function f(){var a=t();a?g.redrawList(a.list,a.list.length):g.redrawList(null,0)}function l(b,c,d,e){0===b&&(a.uiUtil().msgBox(n.IDS_MSGBOX_CERT_IMPORT_SUCCESS),k===c&&q===d&&(a.CONST.__USFB_M_SMARTCARD.device===k&&0===q&&s(k,q,n,e,function(a){(a=t())?g.redrawList(a.list,a.list.length):g.redrawList(null,0)}),a.CONST.__PF_M_SS.device===k?GetCertAndDrawList("redraw",k,q,n,"",function(a){(a=t())?g.redrawList(a.list,a.list.length):g.redrawList(null,0)}):s(k,q,n,"",function(a){(a=t())?g.redrawList(a.list,a.list.length):g.redrawList(null,0)})))}var p=e;document.getElementById("us-cert-get-btn");if(b==a.CONST.__PF_M_LS.device){var h=0;try{a.PFSH.LoadAllCerts(document.domain)}catch(u){301E5===u.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}try{var r=a.PFSH.SetP12OnMemory(d,p),D=r.aluc[r.index];a.usWebToolkit.x509Certificate.parser(D.signcert,"Base64");var w=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),x=a.certUtil().getIssuerEnName(w);a.PFSH.SaveUserCert(x,D,document.domain,!0)}catch(y){switch(h=y.code,y.code){case 1E7:0<=y.detail.indexOf("115010")?a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(n.IDS_MSGBOX_CERT_IMPORT_ERROR,y.detail);break;default:a.uiUtil().errMsgBox(n.IDS_MSGBOX_CERT_IMPORT_ERROR,y.code)}}l(h,b,c,"")}else if(b==a.CONST.__PF_M_SS.device){var v=function(d,e){a.CCPFSH().SetP12OnMemory(d,e,function(d,f,h){if(0==d)d=h.aluc[h.index],a.usWebToolkit.x509Certificate.parser(d.signcert,"Base64"),h=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),h=a.certUtil().getIssuerEnName(h),a.CCPFSH().SaveUserCert(h,d,!0,function(d){e="";0==d?l(d,b,c,""):a.uiUtil().errMsgBox(n.IDS_MSGBOX_CERT_IMPORT_ERROR,f)});else{switch(d){case 1E7:0<=f.indexOf("115010")?a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(n.IDS_MSGBOX_CERT_IMPORT_ERROR,f);break;default:a.uiUtil().errMsgBox(n.IDS_MSGBOX_CERT_IMPORT_ERROR,d)}e=""}})};a.CCPFSH().IsCCPFSHAvailable(function(b){0==b?v(d,p):a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(a,b){0==a&&v(d,p)})})}else a.CONST.__USFB_M_HSMKEY.device===b||a.CONST.__USFB_M_SMARTCARD.device===b?(h=null,h=a.CONST.__USFB_M_SMARTCARD.device===b?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN",PINDialog=a.loadUI("pin")({type:h,args:null,onConfirm:function(h){a.nimservice().ImportCert(0,d,e,b,c,h,function(d,e){if(0==d)k==b&&q==c&&b!=a.CONST.__USFB_M_MOBILE.device?l(d,b,c,h):(f(),a.uiUtil().msgBox(n.IDS_MSGBOX_CERT_IMPORT_SUCCESS)),m.args&&3==m.args.type&&G();else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),d){case 4823E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(n.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(n.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:var g=a.nimservice().GetLastErrorMessage(),g=n.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+g;a.uiUtil().msgBox(g);break;case 4019E4:a.uiUtil().errMsgBox(e,d);break;case 4301E4:0<=e.indexOf("3509")?a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):a.uiUtil().errMsgBox(n.IDS_MSGBOX_CERT_IMPORT_ERROR,e);break;default:switch(g=0,g=a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),g){case 3509:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(e?e:n.IDS_MSGBOX_CERT_IMPORT_ERROR,g)}}});PINDialog.dispose()},onCancel:function(){p="";PINDialog.dispose()}}),PINDialog.show()):a.nimservice().ImportCert(0,d,e,b,c,"",function(d,e){if(0==d)k==b&&q==c&&b!=a.CONST.__USFB_M_MOBILE.device?l(d,b,c,""):(f(),a.uiUtil().msgBox(n.IDS_MSGBOX_CERT_IMPORT_SUCCESS)),m.args&&3==m.args.type&&G();else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),d){case 4823E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(n.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(n.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:var h=a.nimservice().GetLastErrorMessage(),h=n.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+h;a.uiUtil().msgBox(h);break;case 4019E4:a.uiUtil().errMsgBox(e,d);break;case 4301E4:0<=e.indexOf("3509")?a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):a.uiUtil().errMsgBox(n.IDS_MSGBOX_CERT_IMPORT_ERROR,e);break;default:switch(h=0,h=a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),h){case 3509:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(e?e:n.IDS_MSGBOX_CERT_IMPORT_ERROR,h)}}})}function V(b,c,d){function e(b,c){a.nimservice().ExportCert(b,c,function(b,c,e){if(0==b&&e&&0<e.length)a.uiUtil().msgBox(f.IDS_MSGBOX_CERT_EXPORT_SUCCESS+"\n\n"+e),d&&d(0);else switch(b=a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),b){case 4301E4:case 4302E4:case 4303E4:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;case 4013E4:a.uiUtil().msgBox(f.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_LOW_PERFORM_MEDIA);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_CERT_EXPORT_ERROR,b)}a.uiUtil().loadingBox(!1,"us-div-list-load")})}if(!b||!c)return!1;var f=c;if(!a.certsList)return a.uiUtil().msgBox(f.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var l=document.getElementById("us-cert-manage-put-cert-out-btn");if(4==a.ESVS.Mode||6==a.ESVS.Mode)if(a.nimservice()&&null!=a.nimservice()){var p=parseInt(g.selectedIndex());b=a.loadUI("password");Dialog=b({type:null,args:null,onConfirm:function(b){k!=a.CONST.__USFB_M_DISK.device&&k!=a.CONST.__USFB_M_SMARTCARD.device&&k!=a.CONST.__USFB_M_MOBILE.device&&k!=a.CONST.__USFB_M_HDD.device&&k!=a.CONST.__USFB_M_SECUREDISK.device&&k!=a.CONST.__USFB_M_ETC.device?(e(p,b),Dialog.dispose()):a.nimservice().CheckPassword(k,q,p,b,function(c,d){0==c?e(p,b):(a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD),a.uiUtil().loadingBox(!1,"us-div-list-load"));b="";Dialog.dispose();setTimeout(function(){l.focus()},10)})},onCancel:function(){Dialog.dispose();setTimeout(function(){l.focus()},10)}});Dialog.show()}else a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD);else 2&a.ESVS.Mode&&(b=a.loadUI("password"),Dialog=b({type:null,args:null,onConfirm:function(b){var c=parseInt(g.selectedIndex());if(!a.PFUC)return b="",!1;try{var d=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),e=a.usWebToolkit.pkcs8.checkUserCertPassword(d,b),d="";if(!1===e)a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);else if(a.uiUtil().isItPortableDevice()){var k=a.PFSH.GetP12ForBuToMo(c,"hex");a.uiUtil().ExportToBackupStore(k.p12,k.key);k=null}else{var k=a.PFSH.GetP12ForBuToPc(c,b),p=k.p12,m=k.dn,n=a.certUtil().getCN(m)+".p12";a.fileUtil().save(n,p);p=m=k=null}}catch(q){a.uiUtil().errMsgBox(q.message,q.code)}finally{}b="";Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.focus()},10)},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.focus()},10)}}),Dialog.show());return!0}function P(b){if(!b)return!1;var c=a.loadUI("swinfo")({type:null,args:null,onConfirm:function(){c.dispose();setTimeout(function(){b.focus()},10)},onCancel:function(){c.dispose();setTimeout(function(){b.focus()},10)}});c.show();return!0}function H(){var a=document.getElementById("us-cert-manage-cert-copy-btn");a.readOnly=!1;a.disabled=!1}function N(){var a=document.getElementById("us-cert-manage-cert-copy-btn");a.readOnly=!0;a.disabled=!0}function E(){var a=document.getElementById("us-cert-manage-pw-change-btn");a.readOnly=!1;a.disabled=!1}function O(){var a=document.getElementById("us-cert-manage-pw-change-btn");a.readOnly=!0;a.disabled=!0}function F(){var a=document.getElementById("us-cert-manage-put-cert-out-btn");a.readOnly=!1;a.disabled=!1}function J(){var a=document.getElementById("us-cert-manage-put-cert-out-btn");a.readOnly=!0;a.disabled=!0}function I(){var a=document.getElementById("us-cert-manage-cert-delete-btn");a.readOnly=!1;a.disabled=!1}function W(){var a=document.getElementById("us-cert-manage-cert-delete-btn");a.readOnly=!0;a.disabled=!0}function C(){var a=document.getElementById("us-cert-manage-get-cert-btn");a.readOnly=!1;a.disabled=!1}function A(b){b==a.CONST.__PF_M_LS.device?(N(),E(),a.uiUtil().isItSupportingPFCertBackUp()?F():J(),C()):b==a.CONST.__PF_M_SS.device?(N(),E(),a.uiUtil().isItSupportingPFCertBackUp()?F():J(),C()):b==a.CONST.__USFB_M_HDD.device?(H(),E(),F(),I(),C()):b==a.CONST.__USFB_M_DISK.device?(H(),E(),F(),I(),C()):b==a.CONST.__USFB_M_HSMKEY.device?(N(),O(),J(),I(),C()):b==a.CONST.__USFB_M_SMARTCARD.device?(H(),E(),F(),I(),C()):b==a.CONST.__USFB_M_MOBILE.device?(H(),O(),F(),W()):b==a.CONST.__USFB_M_SECUREDISK.device?(H(),E(),J(),I(),C()):b==a.CONST.__PF_M_CLOUDSIGN.device?(N(),O(),J(),W(),b=document.getElementById("us-cert-manage-get-cert-btn"),b.readOnly=!0,b.disabled=!0):(H(),E(),F(),I(),C())}function ba(b,c,d,e){if(a.CONST.__USFB_M_DISK.device>b||!c||!d||!e)return!1;var f=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:c,onConfirm:function(c){0<c&&s(b,c,e,"",function(c){0!=c?(a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),g.redrawList(null,0)):(c=t())?g.redrawList(c.list,c.list.length):g.redrawList(null,0);a.ESVS.Embedded?setTimeout(function(){f.focus()},10):f.dispose();d.focus();a.uiUtil().loadingBox(!1,"us-div-list-load")})},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");f.dispose();d.focus()}});f.show()}function ca(b,c,d,e){if(a.CONST.__USFB_M_DISK.device>b||!d||!e)return!1;var f=a.loadUI("sectokenselect")({type:b,args:c,onConfirm:function(c){0<c&&(a.ESVS.Embedded?setTimeout(function(){f.dispose()},10):f.dispose(),s(b,c,e,"",function(c){if(0!=c){switch(c){case 4812E4:case 4813E4:a.uiUtil().msgBox(e.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c)}g.redrawList(null,0)}else(c=t())?g.redrawList(c.list,c.list.length):g.redrawList(null,0);d.focus()}))},onCancel:function(){f.dispose();d.focus()}});f.show()}function da(b,c,d,e){if(a.CONST.__USFB_M_DISK.device>b||!c||!d||!e)return!1;a.uiUtil().loadingBox(!0,"us-div-list-load",0);var f=a.loadUI("driveselect")({type:"DEVICE_SAVE_TOKEN",args:c,onConfirm:function(c){f.dispose();a.nimservice()?a.nimservice().CheckSCardConnected(function(c,f){0===c?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(c){a.ESVS.Embedded?setTimeout(function(){PINDialog.dispose()},10):PINDialog.dispose();a.nimservice().CheckSCardPin(c,function(f,h){if(0!=f){switch(f){case 4904E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(e.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:a.uiUtil().errMsgBox(e.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN,f)}g.redrawList(null,0);setTimeout(function(){d.dispose()},10)}else s(b,1,e,c,function(a){0!=a?g.redrawList(null,0):(a=t())?g.redrawList(a.list,a.list.length):g.redrawList(null,0);setTimeout(function(){d.dispose()},10)})})},onCancel:function(){PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){d.dispose()},10)}}),PINDialog.show()):(a.uiUtil().msgBox(e.IDS_MSGBOX_SMART_CARD_UNCONNECTED),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){d.dispose()},10))}):(a.uiUtil().msgBox(e.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){d.dispose()},10))},onCancel:function(){f.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){d.dispose()},10)}});f.show()}function ea(b,c){if(!b||!c)return!1;k=a.CONST.__PF_M_SS.device;q=0;A(k);a.certsList&&(a.certsList=null);g.redrawList(null,-1);s(a.CONST.__PF_M_SS.device,0,c,"",function(b){if(0!=b)return win&&"none"!=win.style.display&&a.uiUtil().errMsgBox(c.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),g.redrawList(null,0),!1;(b=t())?g.redrawList(b.list,b.list.length):g.redrawList(null,0)})}function fa(b,c){if(!b||!c)return!1;k=a.CONST.__PF_M_LS.device;q=0;A(k);a.certsList&&(a.certsList=null);g.redrawList(null,-1);a.uiUtil().loadingBox(!0,"us-div-list-load",0);setTimeout(function(){s(a.CONST.__PF_M_LS.device,0,c,"",function(b){a.uiUtil().loadingBox(!1,"us-div-list-load",0);if(0!=b)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),g.redrawList(null,0),!1;(b=t())?g.redrawList(b.list,b.list.length):g.redrawList(null,0)})},10);return!0}function ga(b,c){if(!b||!c)return!1;k=a.CONST.__PF_M_CLOUDSIGN.device;q=0;A(k);a.certsList&&(a.certsList=null);g.redrawList(null,-1);s(a.CONST.__PF_M_CLOUDSIGN.device,0,c,"",function(b){if(0!=b)return win&&"none"!=win.style.display&&a.uiUtil().errMsgBox(c.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),g.redrawList(null,0),!1;(b=t())?g.redrawList(b.list,b.list.length):g.redrawList(null,0)})}function ha(b,c){if(!b||!c)return!1;k=a.CONST.__USFB_M_HDD.device;q=0;A(k);a.certsList&&(a.certsList=null);g.redrawList(null,-1);s(a.CONST.__USFB_M_HDD.device,0,c,"",function(b){if(0!=b)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),g.redrawList(null,0),!1;(b=t())?g.redrawList(b.list,b.list.length):g.redrawList(null,0);return!0})}function ia(b,c){if(!b||!c)return!1;var d=null;k=a.CONST.__USFB_M_DISK.device;q=0;A(k);a.certsList&&(a.certsList=null);g.redrawList(null,-1);if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k))if(a.nimservice())a.nimservice().GetDiskList(function(e,f,g){f=0;g&&(f=g.length);if(0==e&&0<f){e=[];for(var k=0;k<f;k++){var h={};h.index=k+1;h.name=g[k];e[k]=h}d={list:e}}else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,!1;ba(a.CONST.__USFB_M_DISK.device,d,b,c)});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ja(b,c){if(!b||!c)return!1;var d=null;k=a.CONST.__USFB_M_HSMKEY.device;q=0;A(k);a.certsList&&(a.certsList=null);g.redrawList(null,-1);if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetHSMList(1,function(e,f,g){f=0;g&&(f=g.length);if(0==e&&0<f){e=0;for(var k=[],h=0;h<f;h++){var m=h+1,n={},q=g[h].split("|");n.index=m;n.name=q[0];n.driver=q[1];n.passage=q[2];n.validity=q[3];k[e++]=n}d={list:k}}else a.uiUtil().loadingBox(!1,"us-div-list-load"),a.nimservice().GetLastErrorCode();ca(a.CONST.__USFB_M_HSMKEY.device,d,b,c)});else return a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ka(b,c){if(!b||!c)return!1;k=a.CONST.__USFB_M_SECUREDISK.device;q=1;A(k);a.certsList&&(a.certsList=null);g.redrawList(null,-1);a.nimservice().IsSDInstalled(function(b,e){a.uiUtil().loadingBox(!1,"us-div-list-load");0!=b?(a.ERROR.Code=31001,a.ERROR.Message=c.IDS_MSGBOX_NOT_INSTALL_SD,confirm(c.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(document.getElementById("us-cert-manage-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(c.IDS_MSGBOX_BLOCK_POPUP_WINDOW))):s(a.CONST.__USFB_M_SECUREDISK.device,1,c,"",function(b){if(0!=b)return a.uiUtil().errMsgBox(c.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),g.redrawList(null,0),!1;(b=t())?g.redrawList(b.list,b.list.length):g.redrawList(null,0);return!0})})}function la(b,c){if(!b||!c)return!1;k=a.CONST.__USFB_M_MOBILEOTKEN.device;q=0;a.certsList&&(a.certsList=null);g.redrawList(null,-1);if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().IsInstalledUSIMModule(2,!1,function(b,e){a.uiUtil().loadingBox(!1,"us-div-list-load");if(0==b)a.nimservice().SetUSIMOptions(a.usimEnv.sitecode,a.usimEnv.modecode,a.usimEnv.siteURL,a.usimEnv.serviceIP,a.usimEnv.servicePort,a.usimEnv.downloadURL,function(a){document.getElementById("us-confirm-btn").click()});else if(4847E4==b){a.ERROR.Code=21002;a.ERROR.Message=c.IDS_MSGBOX_NOT_INSTALL_SMARTCERT;var f=document.getElementById("us-cert-manage-cls-btn");f.click();null==("firefox"==a.browserName?window.open(a.usimEnv.downloadURL,"usim_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.usimEnv.downloadURL,"usim_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(c.IDS_MSGBOX_BLOCK_POPUP_WINDOW)}else a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),a.uiUtil().errMsgBox(a.ERROR.Message,a.ERROR.Code),f=document.getElementById("us-cert-manage-cls-btn"),f.click()});else return a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ma(b,c){if(!b||!c)return!1;k=a.CONST.__USFB_M_MOBILE.device;q=0;A(k);a.certsList&&(a.certsList=null);g.redrawList(null,-1);if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(k))if(a.nimservice())s(k,q,c,"",function(b){if(0!=b){switch(b){case 61E6:case 6101E4:a.ERROR.Code=11003;confirm(c.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)&&(document.getElementById("us-cert-manage-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(c.IDS_MSGBOX_BLOCK_POPUP_WINDOW));break;case 6102E4:a.uiUtil().errMsgBox(c.IDS_MSGBOX_UBIKEY_LOAD_LIBRARY,b);break;case 6107E4:a.uiUtil().errMsgBox(c.IDS_MSGBOX_UBIKEY_SET_ENV,b)}g.redrawList(null,0)}else(b=t())?g.redrawList(b.list,b.list.length):g.redrawList(null,0)});else return a.uiUtil().msgBox(c.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function K(b,c){if(!b||!c)return!1;a.uiUtil().MsgBox(c.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function na(b,c){if(!b||!c)return!1;A(k);X=a.loadUI("gridlist");g=X({type:"certslist",tblid:"us-cert-manage-tbl-list",tbltitleid:"us-cert-manage-tbl-list-th",titlelistid:"us-cert-manage-grid-head-div",titlerowid:"us-cert-manage-list-title-row",titleelementid:"us-cert-manage-list-title-element",titledividerid:"us-cert-manage-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-cert-manage-tbl-list-td",datalistid:"us-cert-manage-grid-body-div",datarowid:"us-cert-manage-list-body-row",dataelementid:"us-cert-manage-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row-data-selected-element",textObj:c});var d=!0;"opera"==a.browserName&&(d=!1);g.drawList(b,b.length,null,0,Y,d);s(k,q,c,"",function(b){0!=b?a.uiUtil().errMsgBox(c.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b):(b=t())?g.redrawList(b.list,b.list.length):g.redrawList(null,0)})}function B(b){if(!b)return!1;L(b,n,"close");for(var c=a.ESVS.Media.list.split("|"),d=0;d<c.length;d++){var e=a.CONST.medias[c[d]];void 0!=e&&null!=e&&(e=document.getElementById("us-cert-manage-btn-"+e.name),void 0!=e&&null!=e&&"us-layout-storage-btn-none"!=e.className&&(e.className=b===e?"us-layout-storage-btn-on":"us-layout-storage-btn-off"))}return!0}function oa(b){if(null==b||void 0==b)return!1;var c=!a.uiUtil().isItSupportingThisStorage(b);!1==c&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(b.name)&&(c=!0);if(c)return!1;var c=document.getElementById("us-cert-manage-storage-btn-list"),d=document.createElement("li");d.setAttribute("id","us-cert-manage-storage-btn-li-"+b.name,0);d.setAttribute("mediaIndex",b.mediaIndex,0);7==b.mediaIndex&&(d.className="line-first");"hidden"===b.visibility?(d.style.display="none",d.style.visibility="hidden"):(d.style.display="block",d.style.visibility="visible");var e=document.createElement("button");e.setAttribute("type","button",0);e.setAttribute("id","us-cert-manage-btn-"+b.name,0);e.setAttribute("title",b.label,0);e.setAttribute("tabindex",b.tabIndex,0);b.disabled?(e.onclick=function(){a.uiUtil().msgBox(n.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},e.className="us-layout-storage-btn-none"):(e.onclick=b.onclick,e.className=b.device===k?"us-layout-storage-btn-on":"us-layout-storage-btn-off");d.appendChild(e);if(!a.ESVS.chkEXESetup&&"cloudsign"!==b.name&&"webstorage"!==b.name&&"sharestorage"!==b.name){var f=document.createElement("span");f.className="us-download-select";e.appendChild(f)}f=document.createElement("span");f.className="us-img-storage";var g=document.createElement("img");g.setAttribute("id","us-cert-manage-img-"+b.name,0);g.setAttribute("alt",b.label,0);b.disabled?g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+b.name+"_d.png",0):g.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+b.name+".png",0);f.appendChild(g);e.appendChild(f);f=document.createElement("span");f.setAttribute("id","us-cert-manage-lbl-"+b.name,0);f.className="us-layout-lbl-storage";f.appendChild(document.createTextNode(b.label));e.appendChild(f);d.appendChild(e);c.appendChild(d);return!0}function L(b,c,d){if("no_more"==d)a.uiUtil().msgBox(c.IDS_MSGBOX_NOT_MORE_MEDIA);else{b=document.getElementById("us-cert-manage-storage-wrap");"open"==d?(b.className="us-layout-storage-more-wrap",b=document.getElementById("us-cert-manage-storage-more-btn"),b.setAttribute("title",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_HIDDEN+c.IDS_BUTTON,0),b.onclick=function(){L(this,c,"close")},b=document.getElementById("us-cert-manage-storage-more-btn-img"),b.setAttribute("alt",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_HIDDEN,0),b.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(b.className="us-layout-storage-wrap",b=document.getElementById("us-cert-manage-storage-more-btn"),b.setAttribute("title",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_SHOW+c.IDS_BUTTON,0),b.onclick=function(){L(this,c,"open")},b=document.getElementById("us-cert-manage-storage-more-btn-img"),b.setAttribute("alt",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_SHOW,0),b.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));b=a.ESVS.Media.list.split("|");for(var e=0;e<b.length;e++){var f=a.CONST.medias[b[e]];if(void 0!=f&&null!=f){var g=document.getElementById("us-cert-manage-storage-btn-li-"+f.name);if(void 0!=g&&null!=g){var k=g.getAttribute("mediaIndex");"open"==d?(g.style.display="block",g.style.visibility="visible"):6<k?(g.style.display="none",g.style.visibility="hidden"):(g.style.display="block",g.style.visibility="visible");1==k&&document.getElementById("us-cert-manage-btn-"+f.name)}}}}return!0}function G(){g.restoreOnMouseEvent();a.ESVS._chkEXESetupCancel=!0;if(1<=arguments.length)m.onConfirm(arguments[0],arguments[1]);else m.onCancel()}function u(a){var c=document.querySelector(".us-layout-storage-btn-on span img").alt,d=document.querySelector(".us-layout-storage-btn-on span img").src,e=document.getElementById("us-cert-manage-img-current-storage");e.setAttribute("alt",c,0);e.setAttribute("src",d,0);e=document.getElementById("us-cert-manage-lbl-current-storage");e.innerHTML=c;g&&0>g.selectedIndex()&&(document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b style='color: red;'>"+a.IDS_DETAIL_BOX_NOT_SELECTED+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-data").innerHTML="")}function pa(a,c,d){switch(m.args.type){case 1:Q(a,c,d);break;case 2:R(a,c,d);break;case 3:T(c,d);break;case 4:V(a,c,d);break;case 5:S(a,c,d);break;case 6:aa(a,c,d);break;case 7:M(a,c)}}var qa=function(){var b;b=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");b.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certmanage.html?version="+a.ver,!1);b.send(null);return b.responseText},Z=function(){var b;b=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");b.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certmanage_"+a.ESVS.Language+".js?version="+a.ver,!1);b.send(null);return b.responseText},n=eval(eval(Z)()),X=null,g=null,v=a.ESVS.TabIndex+1,Y=0,k=a.CONST.__USFB_M_HDD.device,q=0;if(null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice){k=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice);if(k==a.CONST.__USFB_M_SECUREDISK.device||k==a.CONST.__USFB_M_SMARTCARD.device)q=1;a.SELECTINFO.curdevice=k}else 2==a.ESVS.Mode&&(k=a.CONST.__PF_M_LS.device,a.SELECTINFO.curdevice=k);!m.args||6!=m.args.type&&7!=m.args.type||(k=a.CONST.__USFB_M_SECUREDISK.device,q=1,a.SELECTINFO.curdevice=k);return function(){var b=eval(qa),c=eval(eval(Z)());if(m.args&&m.args.style&&"child"==m.args.style){var d=document.createElement("div");document.body.insertBefore(d,document.body.firstChild);d.innerHTML=b()}else a.ESVS.TargetObj.innerHTML=b();var e=document.getElementById("us-cert-manage-lbl-title");e.appendChild(document.createTextNode(c.IDS_CERT_MANAGEMENT));e.setAttribute("tabindex",v++,0);b=document.getElementById("us-cert-manage-cls-img-btn");b.setAttribute("title",c.IDS_CLOSE_CERT_MANAGEMENT_CLOSE,0);b.onclick=function(){G()};document.getElementById("us-cert-manage-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0);document.getElementById("us-cursor-disabled").setAttribute("title",c.IDS_SENSE_READER_INTRO,0);b=document.getElementById("us-cert-manage-logo-img");b.setAttribute("alt",c.IDS_LOGO,0);b.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0);document.getElementById("us-cert-manage-legend-storage").appendChild(document.createTextNode(c.IDS_STORAGE_SELECT));for(var b=0,d=a.ESVS.Media.list.split("|"),f=null,l=0;l<d.length;l++){var n=d[l],h=a.CONST.medias[n];if(void 0!=h&&null!=h){switch(h.device){case a.CONST.__USFB_M_DISK.device:h.label=c.IDS_STORAGE_REMOVABLE;h.disabled=2==a.ESVS.Mode||m.args&&(6==m.args.type||7==m.args.type)||"MPKI"==a.ESVS.PKI;h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;ia(this,c);B(this);u(c);a.SELECTINFO.curdevice=a.CONST.__USFB_M_DISK.device};break;case a.CONST.__USFB_M_HSMKEY.device:h.label=c.IDS_STORAGE_SECTOKEN;h.disabled=!m.args||1!=m.args.type&&2!=m.args.type&&4!=m.args.type&&6!=m.args.type&&7!=m.args.type?"win"!=a.osName||"MPKI"==a.ESVS.PKI:!0;h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;ja(this,c);B(this);u(c);a.SELECTINFO.curdevice=a.CONST.__USFB_M_HSMKEY.device};break;case a.CONST.__USFB_M_SMARTCARD.device:h.label=c.IDS_STORAGE_SAVETOKEN;h.disabled="win"!=a.osName||m.args&&(6==m.args.type||7==m.args.type)||"MPKI"==a.ESVS.PKI;h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;if(this&&c){var b=null;k=a.CONST.__USFB_M_SMARTCARD.device;q=1;A(k);a.certsList&&(a.certsList=null);g.redrawList(null,-1);var b=[],d={};d.index=a.CONST.__USFB_M_SMARTCARD.device;d.name=c.IDS_SAVETOKEN_SMART_CARD;b[0]=d;b={list:b};da(a.CONST.__USFB_M_SMARTCARD.device,b,this,c)}B(this);u(c);a.SELECTINFO.curdevice=a.CONST.__USFB_M_SMARTCARD.device};break;case a.CONST.__USFB_M_MOBILE.device:h.label=c.IDS_STORAGE_MOBILEPHONE;h.disabled=!m.args||2!=m.args.type&&5!=m.args.type&&6!=m.args.type&&7!=m.args.type?"win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI:!0;h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;ma(this,c);B(this);u(c);a.SELECTINFO.curdevice=a.CONST.__USFB_M_MOBILE.device};break;case a.CONST.__USFB_M_HDD.device:h.label=c.IDS_STORAGE_HARDDISK;h.disabled=2==a.ESVS.Mode||m.args&&(6==m.args.type||7==m.args.type);h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;ha(this,c);B(this);u(c);a.SELECTINFO.curdevice=a.CONST.__USFB_M_HDD.device};break;case a.CONST.__USFB_M_MOBILETOKEN.device:h.label=c.IDS_STORAGE_MOBILETOKEN;h.disabled=!0;h.readOnly=!0;h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;document.getElementById("us-div-cert-manage").style.display="none";la(this,c);B(this);u(c);a.SELECTINFO.curdevice=a.CONST.__USFB_M_MOBILETOKEN.device};break;case a.CONST.__USFB_M_SECUREDISK.device:h.label=c.IDS_STORAGE_SECUREDISK;h.disabled=!m.args||1!=m.args.type&&4!=m.args.type?"win"!=a.osName||"MPKI"==a.ESVS.PKI:!0;h.readOnly=!0;h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;ka(this,c);B(this);u(c);a.SELECTINFO.curdevice=a.CONST.__USFB_M_SECUREDISK.device};break;case a.CONST.__PF_M_SS.device:h.label=c.IDS_STORAGE_SS;h.disabled=4==a.ESVS.Mode;h.onclick=function(){a.ESVS._chkEXESetupCancel=!0;ea(this,c);B(this);u(c);a.SELECTINFO.curdevice=a.CONST.__PF_M_SS.device};break;case a.CONST.__PF_M_LS.device:h.label=c.IDS_STORAGE_LS;h.disabled=4==a.ESVS.Mode;h.onclick=function(){a.ESVS._chkEXESetupCancel=!0;fa(this,c);B(this);u(c);a.SELECTINFO.curdevice=a.CONST.__PF_M_LS.device};break;case a.CONST.__PF_M_TOUCHSIGN.device:h.label=c.IDS_STORAGE_TOUCHSIGN;h.disabled=!0;h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;K(this,c);u(c);a.SELECTINFO.curdevice=a.CONST.__PF_M_TOUCHSIGN.device};break;case a.CONST.__PF_M_SMARTSIGN.device:h.label=c.IDS_STORAGE_SMARTSIGN;h.disabled=!0;h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;K(this,c);u(c);a.SELECTINFO.curdevice=a.CONST.__PF_M_SMARTSIGN.device};break;case a.CONST.__PF_M_WEBSECTOKEN.device:h.label=c.IDS_STORAGE_WEBSECTOKEN;h.disabled=!0;h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;K(this,c);u(c);a.SELECTINFO.curdevice=a.CONST.__PF_M_WEBSECTOKEN.device};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:h.label=c.IDS_STORAGE_WEBSOFTTOKEN;h.disabled=!0;h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;K(this,c);u(c);a.SELECTINFO.curdevice=a.CONST.__PF_M_WEBSOFTTOKEN.device};break;case a.CONST.__PF_M_CLOUDSIGN.device:h.label=c.IDS_STORAGE_CLOUDSIGN;h.disabled=1==a.ESVS.Mode;h.onclick=function(){a.ESVS._chkEXESetupCancel=!0;ga(this,c);B(this);u(c);a.SELECTINFO.curdevice=a.CONST.__PF_M_CLOUDSIGN.device};break;default:h.label=c.IDS_STORAGE_ETC,h.disabled=!0,h.onclick=function(){a.ESVS._chkEXESetupCancel=!1;K(this,c);u(c);a.SELECTINFO.curdevice=0}}a.ESVS.Media.option&&0>=a.ESVS.Media.option&&-1*a.ESVS.Media.option&Math.pow(2,l)&&a.ESVS.Media.defaultdevice!=n&&(h.disabled=!0);h.tabIndex=v;h.mediaIndex=b+1;h.visibility=6<h.mediaIndex?"hidden":"visible";oa(h)&&(v++,b++);null==f&&(f=h)}}d=document.getElementById("us-cert-manage-storage-more-btn");null!=d&&void 0!=d&&(d.setAttribute("title",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_SHOW+c.IDS_BUTTON,0),6<b?(d.style.display="block",d.style.visibility="visible",d.setAttribute("tabindex",v++,0),d.onclick=function(){L(this,c,"open")}):(d.setAttribute("disabled","disabled",0),d.style.display="none",d.style.visibility="hidden",d.onclick=function(){L(this,c,"no_more")}),b=document.getElementById("us-cert-manage-storage-more-btn-img"),b.setAttribute("alt",c.IDS_STORAGE_MORE_VIEW+c.IDS_STORAGE_MORE_VIEW_SHOW,0),b.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));document.getElementById("us-cert-manage-tbl-list").style.summary=c.IDS_CERT_LIST_TABLE_SUMMARY;document.getElementById("us-cert-manage-tbl-list-caption").appendChild(document.createTextNode(c.IDS_CERT_LIST_CAPTION));a.ESVS.Mode&2&&a.uiUtil().loadingBox(!0,"us-div-list-load",0);var s=[{title:c.IDS_CERT_STATUS},{title:c.IDS_CERT_CLASSIFY},{title:c.IDS_CERT_USER},{title:c.IDS_CERT_ISSUER},{title:c.IDS_CERT_EXPIRATION_DAY}];Y=v++;setTimeout(function(){na(s,c)},100);null!=m.args&&null!=m.args.type?(document.getElementById("us-div-cert-manage-btns").style.display="none",document.getElementById("us-fieldset-cert-manage-title").appendChild(document.createTextNode(c.IDS_DETAIL_BOX_TITLE)),g&&-1<g.selectedIndex()?(b=parseInt(g.selectedIndex()),d=a.certsList.list[b-1].path,a.usWebToolkit.x509Certificate.parser(a.certsList.list[b-1].cert,"Base64"),document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b>"+a.certUtil().getCN(a.usWebToolkit.x509Certificate.getSubjectName())+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-data").innerHTML=a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotBefore())+" ~ "+a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotAfter()),document.getElementById("us-layout-cert-manage-detail-box-savepath-data").innerHTML=d,document.getElementById("us-layout-cert-manage-detail-box-savepath-data").setAttribute("title",d)):document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b style='color: red;'>"+c.IDS_DETAIL_BOX_NOT_SELECTED+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-lbl").innerHTML=c.IDS_DETAIL_BOX_EXPIRE_DATE+" : ",document.getElementById("us-layout-cert-manage-detail-box-savepath-lbl").innerHTML=c.IDS_DETAIL_BOX_SAVE_PATH+" : ",b=document.getElementById("us-cert-manage-detail-view-btn"),b.setAttribute("tabindex",v++,0),b.value=c.IDS_DETAIL_BOX_BTN_VIEW,b.title=c.IDS_DETAIL_BOX_BTN_VIEW,b.onclick=function(){z(this,c)},b=document.getElementById("us-cert-manage-sw-info-btn"),b.setAttribute("tabindex",v++,0),b.setAttribute("class","btn-action"),b.value=c.IDS_DETAIL_BOX_BTN_ACTIONS[m.args.type],b.title=c.IDS_DETAIL_BOX_BTN_ACTIONS[m.args.type],b.onclick=function(){pa(this,c,function(a,b,c){0==a&&(b&&c?G(b,c):G())})},u(c)):(document.getElementById("us-div-cert-manage-detail").style.display="none",b=document.getElementById("us-cert-manage-cert-view-btn"),b.setAttribute("value",c.IDS_CERT_VIEW,0),b.setAttribute("title",c.IDS_CERT_VIEW+c.IDS_BUTTON,0),b.setAttribute("tabindex",v++,0),b.onclick=function(){z(this,c)},b=document.getElementById("us-cert-manage-pw-change-btn"),b.setAttribute("value",c.IDS_PW_CHANGE,0),b.setAttribute("title",c.IDS_PW_CHANGE+c.IDS_BUTTON,0),b.setAttribute("tabindex",v++,0),b.onclick=function(){R(this,c)},d=document.getElementById("us-cert-manage-cert-delete-btn"),d.setAttribute("value",c.IDS_CERT_DELETE,0),d.setAttribute("title",c.IDS_CERT_DELETE+c.IDS_BUTTON,0),d.setAttribute("tabindex",v++,0),d.onclick=function(){S(this,c)},d=document.getElementById("us-cert-manage-cert-copy-btn"),d.setAttribute("value",c.IDS_CERT_COPY,0),d.setAttribute("title",c.IDS_CERT_COPY+c.IDS_BUTTON,0),d.setAttribute("tabindex",v++,0),d.onclick=function(){Q(this,c)},"MPKI"==a.ESVS.PKI&&(d.readOnly=!0,d.disabled=!0,b.readOnly=!0,b.disabled=!0),b=document.getElementById("us-cert-manage-get-cert-btn"),b.setAttribute("value",c.IDS_CERT_GET,0),b.setAttribute("title",c.IDS_CERT_GET+c.IDS_BUTTON,0),b.setAttribute("tabindex",v++,0),b.onclick=function(){T(c)},b=document.getElementById("us-cert-manage-put-cert-out-btn"),b.setAttribute("value",c.IDS_CERT_PUT_OUT,0),b.setAttribute("title",c.IDS_CERT_PUT_OUT+c.IDS_BUTTON,0),b.setAttribute("tabindex",v++,0),b.onclick=function(){V(this,c)},b=document.getElementById("us-cert-manage-sw-info-btn"),b.setAttribute("value",c.IDS_SW_INFO,0),b.setAttribute("title",c.IDS_SW_INFO+c.IDS_BUTTON,0),b.setAttribute("tabindex",v++,0),b.onclick=function(){P(this)});b=document.getElementById("us-cert-manage-lbl-notice");b.appendChild(document.createTextNode(c.IDS_NOTICE));"MPKI"==a.ESVS.PKI&&(b.style.visibility="hidden");var r=document.getElementById("us-cert-manage-cls-btn");r.setAttribute("value",c.IDS_CLOSE,0);r.setAttribute("title",c.IDS_CLOSE+c.IDS_BUTTON,0);r.setAttribute("tabindex",v++,0);r.onclick=function(){G()};r.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(r.onblur=function(){setTimeout(function(){document.getElementById("us-cert-manage-sw-info-btn").focus()},10)});9!=b||a.shiftKey||(r.onblur=function(){setTimeout(function(){e.focus()},10)})};var t=!1;e.onkeyup=function(a){a=a||window.event;9==(a.which||a.keyCode)&&a.shiftKey&&t&&(t=!1,setTimeout(function(){r.focus()},10))};e.onkeydown=function(a){a=a||window.event;if(9==(a.which||a.keyCode)&&a.shiftKey)return a.cancelBubble=!0,t=a.returnValue=!0,!1};a.ESVS.ShowGuide&&setTimeout(function(){var b=a.loadUI("guide")({onCancel:function(){b.dispose()}});b.show()},10);return document.getElementById("us-div-cert-manage")}()};return function(m){var t=a.uiLayerLevel,s=a.uiUtil().getOverlay(t),z=P({type:m.type,args:m.args,onConfirm:m.onConfirm,onCancel:m.onCancel});z.style.zIndex=t+1;document.body.insertBefore(s,document.body.firstChild);var M=window.onresize;return{show:function(){draggable(z,document.getElementById("us-div-cert-manage-title"));s.style.display="block";a.uiUtil().offsetResize(z);window.onresize=function(){a.uiUtil().offsetResize(z)};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;setTimeout(function(){a.uiUtil().setFirstFocus("us-cert-manage-lbl-title")},10)},hide:function(){s.style.display="none";z.style.display="none"},dispose:function(m){!0==m&&4&a.ESVS.Mode&&a.ESVS.chkEXESetup&&a.nimservice().ClearAllUserCertList(function(a,m){});window.onresize=function(){M&&M()};z.parentNode.removeChild(z);s.parentNode.removeChild(s);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}};